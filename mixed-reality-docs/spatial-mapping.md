---
title: Пространственное сопоставление
description: Пространственное сопоставление предоставляет подробное представление поверхностей реального мира, в среде вокруг HoloLens.
author: mattzmsft
ms.author: mazeller
ms.date: 03/21/2018
ms.topic: article
keywords: Пространственные сопоставление, HoloLens, смешанной реальности, поверхности реконструкция за период, в сетке, sr
ms.openlocfilehash: 31abeca624512f1d5e721dbe879ca2243cf41345
ms.sourcegitcommit: 384b0087899cd835a3a965f75c6f6c607c9edd1b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/12/2019
ms.locfileid: "59605043"
---
# <a name="spatial-mapping"></a>Пространственное сопоставление

Пространственное сопоставление предоставляет подробное представление поверхностей реального мира, в среде вокруг HoloLens, позволяя разработчикам создавать более убедительно возможности смешанной реальности. Путем объединения реального мира, добавляя виртуальный мир, приложение может установить голограммы показаться real. Приложения можно также более естественным образом соответствуют ожиданиям пользователей, предоставляя знакомые поведение реальных и взаимодействия.

<br>

>[!VIDEO https://www.youtube.com/embed/zff2aQ1RaVo]

## <a name="device-support"></a>Поддержка устройств

<table>
<tr>
<th>Компонент</th><th style="width:150px"> <a href="hololens-hardware-details.md">HoloLens (1-го поколения)</a></th><th style="width:150px">HoloLens 2</th><th style="width:150px"> <a href="immersive-headset-hardware-details.md">Иммерсивную</a></th>
</tr><tr>
<td> Пространственное сопоставление</td><td style="text-align: center;"> ✔️</td><td style="text-align: center;"> ✔️</td><td style="text-align: center;"></td>
</tr>
</table>



## <a name="conceptual-overview"></a>Общие сведения

![Поверхности сетки, охватывающий комнаты](images/SurfaceReconstruction.jpg)<br>
*Пример сетки пространственное сопоставление, охватывающий комнаты*

Две основные типы объектов для пространственное сопоставление: «Пространственных наблюдатель область» и «Пространственных рабочей области».

Приложение предоставляет наблюдателю пространственных поверхности один или несколько томов ограничивающий, для определения областей, в которой приложение желает получать данные пространственное сопоставление пространства. Для каждого из этих томов пространственное сопоставление предоставит приложения с помощью набора пространственных поверхностей.

Эти тома возможно стационарные (фиксированного расположения по отношению к реальности) или они могут быть присоединены к HoloLens (они перемещать, но не поворачиваются, с HoloLens при их перемещении через среду). Все Пространственные поверхности описывает реальных поверхности в небольшой объем места, представленное в виде треугольника сетки, подключен к заблокирован world [Пространственные системы координат](coordinate-systems.md).

HoloLens собирает новые данные о среде, и будет отображаться по мере изменений в среду пространственных поверхности, исчезают и изменить.

## <a name="common-usage-scenarios"></a>Распространенные сценарии использования

![Иллюстрации распространенные сценарии использования пространственных сопоставления: Размещение, перекрытия, физики и навигации](images/sm-concepts-1000px.png)

### <a name="placement"></a>Размещение

Пространственное сопоставление предоставляет приложениям возможность представить естественным и знакомых форм взаимодействия для пользователя; что может быть более естественной, чем размещение телефоне вниз на в службу поддержки?

Ограничить размещение голограммы (или в более общем смысле, выделенные пространственными расположениями) для размещения на поверхности предоставляет естественное сопоставление из 3D (точки в пространстве) в двухмерные (точка на поверхности). Это уменьшает объем данных, пользователь должен указать для приложения и таким образом делает взаимодействие с пользователем быстрее, проще и точнее. Это особенно верно, так как «расстояние» не является то, что многие привыкли к физически взаимодействия другим пользователям или компьютерам. При мы точки нашей его пальцем, мы указываем направление, но не расстояние.

Важные предостережение, что при приложения определяет расстояние от направления (например выполняя raycast вдоль направления взглядом пользователя для поиска ближайшего пространственных поверхности), это должно выдавать результаты, которые пользователь может надежно прогнозировать. В противном случае пользователь потеряет их смысле элемента управления, и это может быстро стать утомительным. Один метод, который поможет с этим является выполнение нескольких raycasts вместо одного. Объединенные результаты следует плавный и предсказуемой и менее подверженным влияют на результатах временных «выброс» (как это может быть вызвано лучи пропуск tiny бреши в системе или при нажатии small биты геометрию, пользователь не учитывать). Агрегирование или сглаживания может также выполняться со временем; Например, можно ограничить скорость, с которой голограмма могут различаться по расстояние от пользователя. Просто ограничиваете число расстояние, минимальное и максимальное значение также может помочь, поэтому она перемещается внезапно сейчас столкнулись расстояние или поступать повалила лиц пользователя.

Приложения также могут использовать форму и направление поверхности для размещения голограмма руководство по. Holographic стул не должен проходить через сквозь стены и следует зафиксированных располагаются с ближайшее снизу целое даже если это немного неравномерной. Функциональность этого типа будет скорее всего зависят от использования конфликтов физики, а не просто raycasts, однако подобные же вопросы будут применяться. Если она помещается имеет много небольших многоугольники, которые выделяют, например конечностей на стула, смысл расширить физики представлением эти многоугольники на что-нибудь плавного и шире, чтобы они были более возможность передвигаться по поверхности пространственных без Очистка.

В самом крайнем ввод данных пользователем можно упростить сейчас полностью и пространственных поверхности может использоваться для выполнения полностью автоматической голограмма размещения. Например приложение может разместить holographic светло параметр где-нибудь на стене для нажатия пользователем клавиши. Предсказуемость же ограничение применяется вдвойне здесь; Если пользователь ожидает, что контроль над голограмма размещения, но приложение не всегда помещает голограммы где они ожидают (если светло коммутатор где-либо пользователь не может связаться с), это будет более расстраивающее возможности. Фактически может быть хуже, для выполнения автоматического размещения, требующую коррекции пользователя некоторое время, чем чтобы просто пользователь должен всегда выполнять размещение самостоятельно; так как является успешной функция автоматического размещения *ожидается*, вручную исправлений подчас нагрузку!

Обратите внимание, что способность приложения для использования пространственных поверхности для размещения во многом зависит от приложения [проверку качества](spatial-mapping-design.md#the-environment-scanning-experience). Если рабочей области не были проверены, его нельзя использовать для размещения. Это приложение в качестве пояснения для пользователя, таким образом, чтобы они помогают проверять новые поверхности или выбрать новое местоположение.

Визуальную обратную связь для пользователя является важнейшим во время размещения. Пользователь должен знать, где она находится по отношению к ближайшей поверхности с [заземление эффекты](spatial-mapping.md#visualization). Они понимают, почему ограниченное перемещение их голограмма (например, из-за конфликта имен с соседней surface). Если они не удается разместить голограмма в текущем расположении, визуальную обратную связь должно было ясно, почему бы не. Например если пользователь пытается поместить holographic диване находится посередине на стене, то части диване, защищенных wall следует pulsate цветом, почему-то сердиты. Или, и наоборот, если приложение не удается найти пространственных поверхности в расположении, где пользователь может видеть поверхность реального мира, затем приложение должно прояснить этот. Очевидным отсутствие эффекта заземлением в этой области могут достичь этой цели.

### <a name="occlusion"></a>Загораживание

Одно из основных применений поверхностей пространственное сопоставление — просто скрывать голограммы. Это простой имеет огромное влияние на предполагаемых реализм голограммы, помощь в создании visceral том смысле, что действительно находятся на том же физическом пространстве имени пользователя.

Перекрытия также предоставляет сведения для пользователя; Если голограмма перекрыто поверхностью реального мира, это обеспечивает дополнительную визуальную обратную связь относительно пространственное положение этого голограмма в мире. И наоборот, перекрытия можно также полезно *скрыть* сведения о пользователе; occluding голограммы за стены может загромождать visual интуитивно понятным способом. Чтобы скрыть или Показать голограмма, пользователь просто приходится перемещать их голосах.

Перекрытия можно также использовать к простым ожиданий для интуитивно понятного пользовательского интерфейса, в зависимости от знакомых физических взаимодействий; Если голограмма является перекрыто поверхностью, он обусловлено тем, которые отображаются сплошной, поэтому ожидаемых, она будет *конфликтуют* с, область и не просто передать через него.

В некоторых случаях перекрытия из голограммы нежелательно. Если пользователь должен иметь возможность взаимодействовать с голограмма, затем они должны иметь возможность см. в статье, — даже если отстает от реального мира поверхность. В таком случае обычно имеет смысл для подготовки к просмотру таких голограмма по-разному в том случае, когда он является перекрыто (например, уменьшив его яркость). Таким образом, пользователь будет иметь возможность визуально найти голограмма, но они по-прежнему будут учитывать, что это за что-то.

### <a name="physics"></a>Физика

Физическое моделирование используется другое отличие какие пространственное сопоставление может использоваться, чтобы подкрепить *присутствия* из голограммы на физическом пространстве пользователя. При моей holographic мячик выполняет накат в действительности off коробке, будет передаваться по полу в разделе диване, может оказаться непросто, мне это не действительно существует.

Физическое моделирование также дает возможность приложению использовать естественным и знакомых взаимодействия на основе физики. Перемещение holographic мебель вокруг на площадке скорее всего будет проще для пользователя, если мебели отвечает на запросы, как если бы он скользящий через floor соответствующие инерции и трудностей.

Для создания реалистичного поведения физических, вы скорее всего, понадобится для выполнения некоторых [mesh обработки](spatial-mapping.md#mesh-processing) заполнения бреши в системе, например, удаление с плавающей запятой hallucinations и сглаживание примерная поверхности.

Также необходимо учитывать как приложения [проверку качества](spatial-mapping-design.md#the-environment-scanning-experience) влияет на его физическое моделирование. Во-первых отсутствует поверхностях не конфликтуют с какой-либо; что происходит, когда мячик скатывается вниз коридор и с конец известной света? Во-вторых необходимо решить, ли вам придется продолжать реагировать на изменения в среде со временем. В некоторых случаях требуется ответить на них как возможно; Например, если пользователь использует двери и мебель как перемещаемый barricades в защиты от tempest входящих Roman стрелок. В других случаях, вы можете игнорировать новые обновления; Ваш holographic спортивный автомобиль вокруг Овальный, влияющие на вашей площадке внезапно нельзя так удобным в том случае, если ваш dog решает располагаются в середине дорожки.

### <a name="navigation"></a>Навигация

Приложения могут использовать пространственное сопоставление данных, чтобы предоставить возможность перехода на практике таким же образом, что человек holographic символов (или агенты). Это помогает усилить наличие holographic символов, ограничивая их к тому же набору естественным, знакомы поведения те пользователя и его друзей.

Возможности навигации может быть удобно для пользователей, а также. После построения карты навигации в заданной области могут использоваться совместно для обеспечения holographic направлениях для новых пользователей, которые не знакомы с этим расположением. Эта карта может быть создано для обеспечения актуальности пешеходов «трафика» плавно, или во избежание аварий в опасных городах, как мест.

Ключевые технические трудности, связанной с реализацией функции навигации будет надежных обнаружение неанализируемой поверхности (люди не стека в таблицах!) и корректное адаптации к изменениям в среде (люди не разберем закрытых двери!). Сетки может потребоваться некоторые [обработки](spatial-mapping.md#mesh-processing) до ее можно использовать для планирования пути и навигации виртуального символом. Сглаживание сетки и удаление hallucinations помогает избежать символов становится заблокирована. Вы также можете значительно упростить сетки, чтобы ускорить планирование путь линии символа и вычисления навигации. Эти трудности получили большое внимание в разработке технологии, игровая приставка, и имеется множество доступных исследовательская литература по этим темам.

Обратите внимание на то, что встроенные функции NavMesh в Unity не может использоваться с сопоставление пространственного поверхностями. Это обусловлено поверхности пространственное сопоставление не известны до приложение запускается, тогда как NavMesh файлы данных должны создаваться из источника ресурсов заранее. Также Обратите внимание, что не будет содержать система пространственное сопоставление [сведения о поверхности очень далекой галактики](spatial-mapping-design.md#the-environment-scanning-experience) из текущего расположения пользователя. Приложение должно «запомните» поверхности сам Если, например, чтобы составить карту очень большие области.

### <a name="visualization"></a>визуализации

В большинстве случаев он подходит для пространственных поверхности невидимым; Чтобы свести к минимуму загромождения и позволить реальной world говорили сами за себя. Тем не менее иногда полезно для визуализации пространственное сопоставление поверхностях, напрямую, несмотря на то, что их аналоги реальных уже отображаются.

Например, когда пользователь пытается разместить голограмма в рабочую область (предположим, что размещение holographic CAB-файл на стене,) можно использовать на землю голограмма, отбрасывающего тень на поверхность. Это предоставит пользователю гораздо более четкое представление о точное развертываемыми между голограмма и рабочей области. Это пример более общая практика визуально «Предварительный просмотр» изменение прежде чем пользователь сможет зафиксировать к нему.

Визуализируя поверхности, приложения могут совместно использовать с пользователем, его понимание среды. Например holographic настольная игра может визуализировать горизонтальной поверхности, которые он определил как «таблицы», чтобы пользователь знал, где они должны перейти для взаимодействия.

Визуализация поверхности может быть удобно для представления пользователю близлежащих пространств, которые скрыты от просмотра. Эта мера может помочь простой способ предоставить пользователю доступ к своей кухне (и все его вложенные голограммы) из своей гостиной.

Поверхности сетки, предоставляемые пространственное сопоставление не может быть особенно «очистить». Поэтому важно визуализировать их соответствующим образом. Традиционные освещения вычисления может выделить ошибки в нормали к поверхности в виде неряшливо, пока «чистой» текстуры, спроецированных на рабочей области может помочь ему более аккуратная вид. Это также можно выполнить [mesh обработки](spatial-mapping.md#mesh-processing) для повышения свойства сетки, прежде чем поверхности подготавливаются к просмотру.

## <a name="using-the-surface-observer"></a>С помощью поверхности наблюдателя

Отправной точкой для пространственное сопоставление является наблюдателем поверхности. Программы поток выглядит следующим образом:
* Создайте объект поверхности наблюдателя
   * Укажите один или несколько пространственных томов, для определения областей интересов, в которой приложение желает получать пространственное сопоставление данных. Пространственные том является просто определении части пространства, такие как сферы или поле фигуры.
   * Использование пространственных тома, в мире заблокирован системе пространственных координат для определения основного региона физического мира.
   * Использование пространственных тома, обновлены друг рамка с заблокирован для тела Пространственные системы координат, для определения области пространство, которое перемещает (но не поворачивается) с пользователем.
   * Эти Пространственные тома может быть изменен позже в любое время, как состояние приложения или изменения, внесенные пользователем.
* Использовать опроса или уведомления для получения сведений о пространственных поверхности
   * Вы может «опрос» поверхности наблюдателя для пространственных поверхности состояния в любое время. Кроме того может регистрировать для поверхности наблюдателя «изменено на поверхности» события, который сообщит приложению, при изменении пространственных поверхности.
   * Для динамического пространственных тома, например усеченная или том заблокирован для текста приложения должны выполнить опрос для изменения каждого кадра, задавая интересующую вас область и затем получения текущего набора пространственных поверхностей.
   * Для статических тома, например куб заблокирован для мира, охватывающий в одной комнате приложения могут зарегистрировать для событие «поверхности изменения» получать уведомления об изменении пространственных поверхности внутри этого тома может.
* Процесс изменения в областях
   * Итерации в указанном наборе пространственных поверхностей.
   * Классифицируйте пространственных предстает в виде добавлены, изменены или удалены.
   * Для каждого добавляемого или изменяемого пространственных рабочей области при необходимости отправьте асинхронный запрос для получения обновленных сетки, представляющий текущее состояние рабочей области на нужном уровне детализации.
* Обработать запрос асинхронной сетки (Дополнительные сведения в следующих разделах).

## <a name="mesh-caching"></a>Сетка кэширования

Пространственные поверхности, представляются высокую плотность сетки. Хранение, прорисовки и обработки этих сеток может требуют значительных ресурсов вычислений и хранения. Таким образом каждое приложение следует внедрять сетки кэширование схемы, соответствующие потребности предприятия, чтобы свести к минимуму ресурсы, используемые для обработки в сети и хранения. Эта схема следует определить, что сетки для сохранения и которого необходимо отменить, а также условия обновления сетки для каждого пространственного рабочей области.

Многие аспекты, которые в них описана непосредственно о том, как приложение должно приближаться к отметке кэширование сетки. Следует учитывать, как пользователь перемещается по среде, необходимы какие поверхности, когда будет действовать различными поверхностями и когда следует записывать изменения в среде.

При интерпретации «изменено на поверхности» события, предоставляемые поверхности наблюдатель, основные сетки логике кэширования выглядит следующим образом:
* Если приложение видит пространственных поверхности идентификатор, который имеет раньше не было, это следует интерпретировать как поверхность новых пространственных.
* Если приложение видит пространственных поверхность с известным Идентификатором, но со временем новые обновления, его следует считать это обновленный пространственных поверхности.
* Если приложение больше не видит пространственных поверхность область с известным Идентификатором, это следует интерпретировать как поверхность пространственных удален.

Это зависит каждое приложение, затем выберите следующие параметры:
* Для нового пространственного поверхностями должны запрашиваться сетки?
   * Обычно сетки должны немедленно запрашиваются новые Пространственные поверхности, которые можно найти полезные новые сведения для пользователя.
   * Тем не менее новые Пространственные поверхности рядом, а также перед пользователь должен быть дан приоритет, и сначала следует запросить их сетки.
   * Если новая сетка не требуется, если для примера приложения постоянно или временно «замороженной» его модель среды, затем он должен запрашиваться не.
* Для обновленных пространственного поверхностями должны запрашиваться сетки?
   * Обновленные пространственных поверхности рядом, а также перед пользователь должен быть дан приоритет и сначала следует запросить их сетки.
   * Возможно также обеспечивают более высокий приоритет, чтобы новые поверхности, чем обновления поверхности, особенно во время сканирования.
   * Чтобы ограничить затраты на обработку, приложения можно регулировать скорость, с которой они обрабатывают обновления пространственных поверхности.
   * Возможно, его можно определить, что изменения в рабочую область пространственных минимальны, например, если границы области, в этом случае обновление может оказаться недостаточно важные для процесса.
   * Обновления для пространственных поверхности вне текущей области интересов пользователя могут игнорироваться полностью, хотя в этом случае он может быть более эффективным изменения пространственных ограничивающий томов используется поверхности наблюдатель.
* Для удаленных пространственного поверхностями следует ли удалить сетки?
   * Обычно сетки не следует использовать немедленно для удаленных пространственного поверхностями, так что остается правильный голограмма перекрытия.
   * Тем не менее, если приложение имеет основания предполагать, что Пространственные поверхность появится вскоре (возможно в зависимости от вида взаимодействия с пользователем), возможно, будет более эффективным будет сохранить чем отбросить его сетки и создайте его заново попытку позже.
   * При разработке крупномасштабных модель пользовательской среды в приложение затем он может потребоваться отменить любые сеток вообще. По-прежнему потребуется ограничить использование ресурсов, возможно, сеток постановки в очередь на диск как исчезают пространственных поверхности.
   * Обратите внимание, что некоторые события достаточно редко, во время создания пространственных поверхности может привести к пространственных поверхности заменяется новые Пространственные поверхности в аналогичных местах, но разные идентификаторы. Следовательно приложения, не захотите отменить удален поверхности следует позаботиться не до конца вверх сеточных несколько высокой перекрывающегося пространственного поверхности охватывающий то же расположение.
* Следует ли удалить сетки для любого пространственного поверхности?
   * Даже в том случае, если поверхность пространственных существует, если он больше не полезно удобство работы пользователя, а затем она должна будет удалена. Например если приложение «заменяет» место на другом конце лазейкой с альтернативного виртуальные пространством затем пространственных поверхности в этой комнате больше не имеет значения.

Ниже приведен пример сетки стратегию кэширования, с помощью гистерезис Пространственные и временные.
* Рассмотрим приложение, которое желает использовать Пространственные тома проценты, которые следует взглядом пользователя, как они выглядели и присутствия, форме панелью видимого пространства.
* Поверхность пространственных могут исчезнуть временно из этого тома просто потому, что пользователь ищет из рабочей области или дополнительные действия от его... только для ретроспективного поиска или перемещается ближе попытку немного позже. В этом случае удаления и повторного создания сети для этой рабочей области представляет объем избыточных обработки.
* Чтобы сократить число обработанных изменений, приложение использует два пространственных наблюдателей поверхности, содержится внутри другого. Тома большего размера сферическую и привязан к пользователю «неактивно»; Перемещает только при необходимости для обеспечения его центр в метрах 2.0 пользователя.
* Новые и обновленные пространственных поверхности сетки, всегда обрабатываются с более мелкие внутреннее поверхности наблюдатель, но сеток кэшируются, пока они исчезают из большего размера внешнего наблюдателя поверхности. Это позволит приложению избежать обработки большое количество избыточных изменений из-за перемещения локального пользователя.
* Так как поверхность пространственных также могут временно исчезнуть из-за отслеживание потери, приложение также откладывает отмену удаленных поверхностях пространственных во время отслеживания потери.
* В общем случае приложения должны оценить компромисс между обработку ограниченной обновления и увеличение занимаемой памяти для определения его идеальным стратегии кэширования.

## <a name="rendering"></a>Подготовка к просмотру

Существует три основных способа, в которых обычно используются для подготовки к просмотру пространственное сопоставление сетки:
* Для поверхности визуализации
   * Часто бывает полезно для визуализации пространственных поверхности напрямую. Например приведение «shadows» из объектов на поверхности пространственных можно визуально полезные для пользователя при их размещении голограммы на поверхностях.
   * Следует иметь в виду является то, что отличается от вида сетки, которые могут быть созданы 3D исполнителя пространственных сеток. Треугольник топология не будет как «clean» и как созданные human топологии и сетки снижается из [различные ошибки](spatial-mapping-design.md#what-influences-spatial-mapping-quality).
   * Чтобы создать, используя visual эстетическим деталям, таким образом можно выполнить некоторые [mesh обработки](spatial-mapping.md#mesh-processing), например для заполнения бреши в системе или smooth нормали к поверхности. Вы также можете использовать шейдер для проекта спроектированных исполнителя текстур на Live mesh вместо непосредственно визуализация топология сетки и normals.
* Для occluding голограммы за реальных поверхности
   * Пространственные поверхности может быть отображен в только для глубины pass какие влияет только на [буфер глубины](https://msdn.microsoft.com/library/windows/desktop/bb219616(v=vs.85).aspx) и не влияет на целевые объекты отрисовки цвет.
   * Это обеспечивает буфер глубины, чтобы скрывать впоследствии к просмотру голограммы за пространственных поверхности. Точные перекрытия из голограммы улучшает том смысле, что голограммы действительно существует в физическом пространстве пользователя.
   * Чтобы включить только для глубина подготовки к просмотру, обновите состояние blend, чтобы задать [RenderTargetWriteMask](https://msdn.microsoft.com/library/windows/desktop/hh404492(v=vs.85).aspx) нулю для весь цвет целевыми объектами отрисовки.
* Для изменения внешнего вида голограммы перекрыто по поверхности реальных
   * Обычно отображаемой geometry скрыт в том случае, если он является перекрыто. Это достигается путем установки функции глубины вашей [состояние трафарета глубины](https://msdn.microsoft.com/library/windows/desktop/ff476110(v=vs.85).aspx) на «меньше или равно», чего геометрического объекта должен отображаться только там, где это **ближе** к камере, чем все ранее к просмотру Геометрия.
   * Тем не менее его можно использовать для сохранения определенных geometry даже в том случае, если он является перекрыто и изменить его внешний вид при перекрыто как способа предоставления пользователю визуальной обратной связи. Например это позволяет приложение Показать, что расположение объекта, пока что очевидно, что пользователь находится за рабочую область реального мира.
   * Чтобы добиться этого, визуализировать geometry во второй раз с разных шейдер, который создает требуемый вид «occluded». Перед отображением геометрии во второй раз, внести два изменения в вашей [состояние трафарета глубины](https://msdn.microsoft.com/library/windows/desktop/ff476110(v=vs.85).aspx). Во-первых, равным функции глубины «больше или равно», чтобы геометрии будут видны только там, где это **дальнейшей** от камеры, чем все ранее преобразованной геометрии. Во-вторых, равным DepthWriteMask нулю, таким образом, чтобы не будет изменен буфер глубины (буфер глубины должно по-прежнему представляют глубину геометрии **ближайший** к камере).

[Производительность](understanding-performance-for-mixed-reality.md) является важной задачей при подготовке к просмотру пространственное сопоставление сеток. Ниже приведены некоторые методы производительности отрисовки конкретных отчетов к просмотру пространственное сопоставление сеток.
* Настройки плотности треугольник
   * Когда запрашивающий пространственных поверхности сетки из вашей поверхности наблюдателя, запрашивает самая низкая плотность сетки, подойдет для ваших потребностей.
   * Смысл при работе для изменения плотности треугольник на основе surface, surface, в зависимости от рабочей области расстояние от пользователя и его применимости взаимодействие с пользователем.
   * Снижение количества треугольник позволяет снизить использование памяти и вычислительные затраты вершин в GPU на то, что он не повлияет на пиксель вычислительные затраты.
* Выполните визуализируемых пирамиды обзора
   * Пирамиды обзора визуализируемых пропускает графические объекты, которые не видны, так как они находятся за пределами текущей панелью видимого пространства экрана. Это сокращает затраты обработки ЦП и GPU.
   * Поскольку визуализируемых выполняется по принципу в сетке, а пространственных поверхности могут быть большими, разбиение каждого пространственного сетки поверхности на более мелкие фрагменты данных может привести эффективнее отбора (тем, что меньше вне экрана треугольники подготавливаются к просмотру). Обеспечивает компромисс, однако; Дополнительные слои взаимодействия между вами, несколько вызовов draw, необходимо внести, которых можно увеличить затраты на ЦП. В крайнем случае пирамиды обзора, визуализируемых вычисления сами даже может иметь измеримое ЦП.
* Изменить порядок отрисовки
   * Пространственные поверхности обычно бывает достаточно велик, так как они представляют всю среду заключить их. Пиксель обработки затрат на GPU таким образом может быть высокой, особенно в случаях, где имеется более одного слоя видимым геометрии (включая как пространственного поверхностями, так и других голограммы). В этом случае уровень ближайший к пользователю будет быть occluding дальнейшей все слои, поэтому теряется GPU отправкой визуализации слоями более удаленных.
   * Чтобы уменьшить этот излишней работы на GPU, полезно для подготовки к просмотру непрозрачный поверхности в порядке от передних к задним (тех, которые ближе последнее из них во-первых, более удаленных). Под «opaque» подразумевается поверхности, для которых DepthWriteMask задано значение 1 в вашей [состояние трафарета глубины](https://msdn.microsoft.com/library/windows/desktop/ff476110(v=vs.85).aspx). При подготовке к просмотру ближайшего поверхности, они будут простым буфер глубины эффективно, пропуская более удаленных поверхностях обработчиком пикселя в графическом Процессоре.

## <a name="mesh-processing"></a>Обработка сетки

Приложение может потребоваться выполнить [различные операции](spatial-mapping.md#mesh-processing) на пространственных поверхности сетки в соответствии с его потребностями. Данные индексов и вершин, в состав каждого пространственного сетки поверхности использует тот же знакомый макет, что [буферы вершин и индексов](https://msdn.microsoft.com/library/windows/desktop/bb147325%28v=vs.85%29.aspx) , которые используются для подготовки к просмотру треугольников в рендеринг всех современных интерфейсов API. Тем не менее одного ключа фактов, которые следует учитывать является то, что треугольники пространственное сопоставление **front-по часовой стрелке порядком заполнения**. Каждый треугольник представлена тремя индексами вершин в буфер индексов сетки, и эти индексы будут определять вершины треугольника в **по часовой стрелке** порядке, при просмотре треугольник из **front** сторона. Передней сторона (или внешней) пространственных поверхности сетки соответствует как можно было бы ожидать Передняя сторона (отображается) поверхностей реального мира.

Приложения должны выполнять только в том случае, упрощения сетки, если по-прежнему недостаточно грубое грубом плотность треугольник, предоставляемые поверхности наблюдатель - эта работа требует больших затрат и уже выполняется средой выполнения для создания различных предоставляются уровни детализации.

Поскольку каждого поверхности наблюдателя может дать несколько неподключенный пространственных поверхности, некоторым приложениям может потребоваться обрезать эти Пространственные поверхности сетки для каждого других, затем изображению застежки их друг с другом. В общем случае отсечения шаг является обязательным, как ближайших точек пространственных поверхности сетки часто перекрываются немного.

## <a name="raycasting-and-collision"></a>Точные точки для отслеживания и расчет столкновений

Чтобы физики API (такие как [Havok](http://www.havok.com/)) использовать приложение с функциональными возможностями точные точки для отслеживания и расчет столкновений для пространственных поверхности, приложение должно предоставить пространственных поверхности сетки для физики API. Часто используются для физики сетки имеют следующие свойства:
* Они содержат только небольшого числа треугольников. Физика операции являются дополнительные с большим объемом вычислений чем операции подготовки к просмотру.
* Они являются «воды тесной». Поверхности, должны быть сплошной не должны иметь небольшой дыр; даже слишком мал, чтобы быть видимым бреши в системе может вызвать проблемы.
* Они преобразуются в выпуклой hulls. Выпуклая hulls имеют несколько многоугольников и свободны от бреши в системе, и гораздо большего количества вычислений они эффективны для обработки, чем необработанные треугольника сетки.

При выполнение raycasts от пространственного поверхностями, имейте в виду, что эти поверхности часто сложны, полный запутанным мало сведений — просто загроможденной фигур, например службу поддержки! Это означает, что один raycast недостаточно часто дают достаточно информации о форме рабочей области и форму пустое место рядом с ней. Поэтому обычно это рекомендуется для выполнения многих raycasts в пределах небольшой области и которые используются объединенные результаты для формирования более надежным объяснение рабочей области. Например использование среднее значение 10 raycasts для размещения голограмма руководство в рабочей области даст результат гораздо гораздо более гладко и менее «перебои управления», с помощью только одного raycast.

Однако имейте в виду, что каждый raycast может иметь высокую стоимость вычислений. Таким образом в зависимости от сценария использования вы должны добиваться вычислительной стоимости дополнительных raycasts (выполняется каждый кадр) от вычислительной стоимости [mesh обработки](spatial-mapping.md#mesh-processing) smooth и удалять бреши в системе в (пространственных поверхности выполняется при обновлении пространственных сетки).

## <a name="troubleshooting"></a>Устранение неполадок
* Для поверхности сетки быть ориентированный правильно, каждый объект GameObject должен быть активными, перед отправкой SurfaceObeserver иметь его сетки создан. В противном случае будут отображаться сетки в своем пространстве, но повернуть странные углом.
* Объект GameObject, которое запускает сценарий, который обменивается данными с SurfaceObserver должно быть задано в источник. В противном случае все объекты Gameobject, создание и отправку SurfaceObserver иметь их сеток создан будет иметь смещение равно смещению игры родительского объекта. Это может сделать ваши сетки отображаются в нескольких метрах от что делает его очень сложно отлаживать происходящего.

## <a name="see-also"></a>См. также
* [Системы координат](coordinate-systems.md)
* [Пространственное сопоставление в DirectX](spatial-mapping-in-directx.md)
* [Пространственное сопоставление в Unity](spatial-mapping-in-unity.md)
* [Пространственное сопоставление конструктора](spatial-mapping-design.md)
* [Пример использования - просматривая отверстия в реальности](case-study-looking-through-holes-in-your-reality.md)
