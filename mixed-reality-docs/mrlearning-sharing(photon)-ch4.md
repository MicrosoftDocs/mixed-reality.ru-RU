---
title: Руководства по многопользовательским возможностям, часть 5. Интеграция Пространственных привязок Azure в общий интерфейс
description: В рамках этого курса вы узнаете, как реализовать многопользовательские возможности в приложении HoloLens 2.
author: jessemcculloch
ms.author: jemccull
ms.date: 02/26/2019
ms.topic: article
keywords: mixed reality, unity, tutorial, hololens
ms.localizationpriority: high
ms.openlocfilehash: c27ed7327cfe0a61f2b63e309348bdea1a535ea1
ms.sourcegitcommit: 92ff5478a5c55b4e2c5cc2f44f1588702f4ec5d1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/30/2020
ms.locfileid: "82604975"
---
# <a name="4-integrating-azure-spatial-anchors-into-a-shared-experience"></a>4. Интеграция Пространственных привязок Azure в общий интерфейс

Из этого учебника вы узнаете, как интегрировать Пространственные привязки Azure в общий интерфейс. Пространственные привязки Azure позволяют нескольким устройствам в физическом мире использовать общие ориентиры, чтобы пользователи видели друг друга в их реальном физическом расположении и использовали общий интерфейс в одном расположении.

## <a name="objectives"></a>Задачи

* Интеграция Пространственных привязок Azure в общий интерфейс для согласования среды между устройствами.
* Изучение основных принципов Пространственных привязок Azure в контексте локального общего интерфейса.

## <a name="preparing-the-scene"></a>Подготовка сцены

В окне "Иерархия" разверните объект **SharedPlayground**, затем разверните объект **TableAnchor**, чтобы предоставить его дочерние объекты.

![mrlearning-sharing](images/mrlearning-sharing/tutorial4-section1-step1-1.png)

В окне "Проект" перейдите к папке **Assets** (Активы) > **MRTK.Tutorials.MultiUserCapabilities** > **Prefabs** (Заготовки) и перетащите заготовку **Buttons** (Кнопки) поверх дочернего объекта **TableAnchor** в окне "Иерархия", чтобы добавить ее в сцену в качестве дочернего объекта TableAnchor.

![mrlearning-sharing](images/mrlearning-sharing/tutorial4-section1-step1-2.png)

## <a name="configuring-the-buttons-to-operate-the-scene"></a>Настройка кнопок для управления сценой

В рамках этого раздела вы настроите серию событий кнопок, демонстрирующих базовые приемы использования Пространственных привязок Azure для достижения пространственного выравнивания в общем интерфейсе.

В окне "Иерархия" разверните объект **Button**. Выберите в нем первый дочерний объект кнопки с именем **StartAzureSession**:

![mrlearning-sharing](images/mrlearning-sharing/tutorial4-section2-step1-1.png)

В окне "Инспектор" найдите компонент **Interactable (Script)** (Взаимодействие — скрипт) и настройте событие **OnClick ()** (Щелчок), как описано ниже.

* В поле **None (Object)** (Отсутствует (объект)) укажите объект **TableAnchor**.
* В раскрывающемся списке **No Function** (Нет функции) выберите функцию **AnchorModuleScript** > **StartAzureSession ()** .

![mrlearning-sharing](images/mrlearning-sharing/tutorial4-section2-step1-2.png)

В окне "Иерархия" выберите второй дочерний объект кнопки с именем **CreateAzureAnchor**. Затем в окне "Инспектор" найдите компонент **Interactable (Script)** (Взаимодействие — скрипт) и настройте событие **OnClick ()** (Щелчок), как описано ниже.

* В поле **None (Object)** (Отсутствует (объект)) укажите объект **TableAnchor**.
* В раскрывающемся списке **No Function** (Нет функции) выберите функцию **AnchorModuleScript** > **CreateAzureAnchor ()** .
* В появившемся поле **None (Game Object)** (Отсутствует (игровой объект)) укажите объект **TableAnchor**.

![mrlearning-sharing](images/mrlearning-sharing/tutorial4-section2-step1-3.png)

В окне "Иерархия" выберите третий дочерний объект кнопки с именем **ShareAzureAnchor**. Затем в окне "Инспектор" найдите компонент **Interactable (Script)** (Взаимодействие — скрипт) и настройте событие **OnClick ()** (Щелчок), как описано ниже.

* В поле **None (Object)** (Отсутствует (объект)) укажите объект **TableAnchor**.
* В раскрывающемся списке **No Function** (Нет функции) выберите функцию **SharingModuleScript** > **ShareAzureAnchor ()** .

![mrlearning-sharing](images/mrlearning-sharing/tutorial4-section2-step1-4.png)

В окне "Иерархия" выберите четвертый дочерний объект кнопки с именем **GetAzureAnchor**. Затем в окне "Инспектор" найдите компонент **Interactable (Script)** и настройте событие **OnClick ()** , как описано ниже.

* В поле **None (Object)** (Отсутствует (объект)) укажите объект **TableAnchor**.
* В раскрывающемся списке **No Function** (Нет функции) выберите функцию **SharingModuleScript** > **GetAzureAnchor ()** .

![mrlearning-sharing](images/mrlearning-sharing/tutorial4-section2-step1-5.png)

## <a name="connecting-the-scene-to-the-azure-resource"></a>Подключение сцены к ресурсу Azure

В окне "Иерархия" разверните объект **SharedPlayground** и выберите объект **TableAnchor**. Затем в окне "Инспектор" найдите компонент **Spatial Anchor Manager (Script)** (Диспетчер пространственных привязок — скрипт) и укажите в разделе **Учетные данные** данные учетной записи Пространственных привязок Azure, созданной в рамках [предварительных требований](mrlearning-sharing(photon)-ch1.md#prerequisites) для этой серии учебников.

* В поле **Spatial Anchors Account ID** (Идентификатор учетной записи пространственных привязок) вставьте **идентификатор учетной записи** Пространственных привязок Azure.
* В поле **Spatial Anchors Account Key** (Ключ учетной записи пространственных привязок) вставьте первичный или вторичный **ключ доступа** учетной записи Пространственных привязок Azure.

![mrlearning-sharing](images/mrlearning-sharing/tutorial4-section3-step1-1.png)

Сохраняя выделение объекта **TableAnchor**, убедитесь, что в окне "Инспектор" включены все компоненты скрипта.

* Установите флажок рядом с компонентами **Spatial Anchor Manager (Script)** (Диспетчер пространственных привязок — скрипт), чтобы включить их.
* Установите флажок рядом с компонентами **Anchor Module Script (Script)** (Скрипт модуля привязок — скрипт), чтобы включить их.
* Установите флажок рядом с компонентами **Sharing Module Script (Script)** (Скрипт модуля общего доступа — скрипт), чтобы включить их.

![mrlearning-sharing](images/mrlearning-sharing/tutorial4-section3-step1-2.png)

## <a name="trying-the-experience-with-spatial-alignment"></a>Использование возможности пространственного выравнивания

> [!NOTE]
> Пространственные привязки Azure не могут работать в Unity. Поэтому для проверки функциональных возможностей этой службы вам придется развернуть проект как минимум на двух устройствах HoloLens.

После создания и развертывания проекта Unity на двух устройствах HoloLens вы сможете поддерживать пространственное выравнивание между ними, используя общий идентификатор привязки Azure. Чтобы проверить этот механизм, можно выполнить следующие действия.

1. На устройстве HoloLens 1: **запустите приложение** (создается Rocket Launcher и размещается в таблице).
2. На устройстве HoloLens 2: **запустите приложение** (оба пользователя видят таблицу с Rocket Launcher, однако таблица не отображается в одном расположении, а аватары пользователей не отображаются там, где находятся пользователи).
3. На устройстве HoloLens 1: нажмите кнопку **Start Azure Session** (Запуск сеанса Azure).
4. На устройстве HoloLens 1: нажмите кнопку **Create Azure Anchor** (Создать привязку Azure) (создается привязка в расположении объекта TableAnchor и сохраняются сведения о ней в ресурсе Azure).
5. На устройстве HoloLens 1: нажмите кнопку **Share Azure Anchor** (Поделиться привязкой Azure) (предоставляет другим пользователям доступ к идентификатору привязки в режиме реального времени).
6. На устройстве HoloLens 2: нажмите кнопку **Start Azure Session** (Запуск сеанса Azure).
7. На устройстве HoloLens 2: нажмите кнопку **Get Azure Anchor** (Получить привязку Azure) (подключается к ресурсу Azure для получения сведений о привязке для совместно используемого идентификатора привязки, затем перемещает объект TableAnchor в расположение, где с помощью устройства HoloLens 1 была создана привязка).

## <a name="congratulations"></a>Поздравляем!

Из этого учебника вы узнали, как интегрировать мощные возможности Пространственных привязок Azure для поддержки согласованного расположения устройств в общем интерфейсе. На этом мы завершаем работу с этой серией учебников, из которой мы узнали, как настроить учетную запись и приложение Photon, как интегрировать Photon и PUN в приложение Unity, как настроить аватары пользователей и общие объекты, а также как согласовать нескольких участников с помощью Пространственных привязок Azure.
