---
title: Пространственные привязки
description: Рекомендации по использованию пространственных привязок для отрисовки стабильных голограмм.
author: thetuvix
ms.author: alexturn
ms.date: 02/24/2019
ms.topic: article
ms.localizationpriority: high
keywords: coordinate system, spatial coordinate system, world-scale, world, scale, position, orientation, anchor, spatial anchor, world-locked, world-locking, persistence, sharing
ms.openlocfilehash: 16165194d040ad22f7885897eddcc65cf9dcaec3
ms.sourcegitcommit: f20beea6a539d04e1d1fc98116f7601137eebebe
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/05/2019
ms.locfileid: "65730862"
---
# <a name="spatial-anchors"></a>Пространственные привязки

Пространственная привязка представляет собой важную точку в мире, которую система должна отслеживать с течением времени. Каждая привязка имеет [систему координат](coordinate-systems.md), которая нужным образом корректируется относительно других привязок или систем отсчета, чтобы гарантировать, что закрепленные голограммы остаются точно на месте.  Отрисовка голограммы в системе координат привязки предоставляет самое точное позиционирование этой голограммы в любой момент времени. Это возможно благодаря небольшим корректировкам положения голограммы с течением времени, так как система постоянно перемещает ее обратно на свое место относительно реального мира.

Вы также можете сохранять и совместно использовать пространственные привязки между сеансами приложения и устройствами:
* Сохраняя локальные пространственные привязки на диск и загружая их позже, ваше приложение может определить примерно одно и то же расположение голограммы в реальном мире в разных сеансах приложения на одном устройстве HoloLens.
* Благодаря созданию облачной привязки с помощью <a href="https://docs.microsoft.com/azure/spatial-anchors/overview" target="_blank">Пространственных привязок Azure</a> ваше приложение может совместно использовать пространственную привязку для нескольких устройств HoloLens, iOS и Android. Если каждое устройство будет отрисовывать голограмму с использованием одной и той же пространственной привязки, голограмма будет отображаться в одном и том же месте в реальном мире для сеансов всех пользователей.  Это позволяет обмениваться опытом в режиме реального времени.
* <a href="https://docs.microsoft.com/azure/spatial-anchors/overview" target="_blank">Пространственные привязки Azure</a> можно также использовать для сохранения асинхронной голограммы на устройствах HoloLens, iOS и Android.  Благодаря совместному использованию надежной облачной пространственной привязки несколько устройств могут наблюдать одну и ту же постоянную голограмму с течением времени, даже если они находятся в разное время в разных местах.

Для применения с компьютерными гарнитурами в пространствах, диаметр которых не превышает 5 метров, вместо пространственных привязок обычно можно просто использовать [систему координат сцены](coordinate-systems.md#stage-frame-of-reference), предоставляющую единую систему координат для отрисовки содержимого. Однако если ваше приложение предназначено для того, чтобы пользователи могли отходить от HoloLens на расстояние более 5 метров, например работая по всему этажу здания, вам понадобятся пространственные привязки для обеспечения стабильности содержимого.

В то время как пространственные привязки хороши для голограмм, которые должны оставаться неподвижными в мире, после установки привязок их нельзя перемещать. Существуют альтернативы привязкам, подходящие для динамических голограмм, которые должны перемещаться вместе с пользователем. Динамические голограммы лучше всего размещать, используя стационарную систему отсчета (основа внешних координат Unity) или присоединенную систему отсчета.

## <a name="best-practices"></a>Рекомендации

Эти рекомендации по пространственным привязкам помогут вам создать стабильные голограммы, которые точно отслеживают реальный мир.

### <a name="create-spatial-anchors-where-users-place-them"></a>Создание пространственных привязок, размещаемых пользователями

В большинстве случаев именно пользователи должны размещать пространственные привязки.

Например, в HoloLens приложение может находить точку пересечения [взгляда пользователя](gaze.md) с помощью сетки [пространственного отображения](spatial-mapping.md), чтобы пользователь мог решить, где разместить голограмму. Когда пользователь выполняет жест касания, чтобы поместить эту голограмму, создайте пространственную привязку в точке пересечения, а затем поместите голограмму в начало системы координат этой привязки.

Локальные пространственные привязки легко и удобно создавать. Система объединит их внутренние данные, если несколько привязок смогут совместно использовать базовые данные датчика. Обычно нужно создавать новую локальную привязку для каждой голограммы, которую пользователь явно размещает, за исключением случаев, описанных ниже, например для строгих групп голограмм.

### <a name="always-render-anchored-holograms-within-3-meters-of-their-anchor"></a>Всегда отображайте закрепленные голограммы в пределах 3 метров от их привязки

Пространственные привязки стабилизируют свою систему координат возле источника привязки. Если вы отрисовываете голограммы на расстоянии более 3 метров от этого источника, эти голограммы могут отображаться с заметными позиционными ошибками пропорционально их расстоянию от этого источника из-за эффектов плеча рычага. Это работает, если пользователь стоит рядом с привязкой, так как в таком случае голограмма также находится далеко от пользователя. Это означает, что угловая ошибка удаленной голограммы будет небольшой. Тем не менее, если пользователь подходит к этой отдаленной голограмме, она будет казаться больше, что делает эффекты плеча рычага от источника дальней привязки весьма очевидными.

### <a name="group-holograms-that-should-form-a-rigid-cluster"></a>Групповые голограммы, которые должны образовывать жесткий кластер

Несколько голограмм могут использовать одну и ту же пространственную привязку, если приложение ожидает, что эти голограммы будут поддерживать фиксированные связи по отношению друг к другу.

Например, если вы анимируете голографическую солнечную систему в комнате, лучше привязать все объекты солнечной системы к одной привязке в центре, чтобы они плавно перемещались относительно друг друга. В этом случае именно вся солнечная система будет закреплена, хотя ее составные части будут динамически перемещаться вокруг привязки.

Ключевым условием для сохранения стабильности голограммы является соблюдение правила 3-х метров, описанного выше.

### <a name="render-highly-dynamic-holograms-using-the-stationary-frame-of-reference-instead-of-a-local-spatial-anchor"></a>Отрисовка высокодинамичных голограмм с использованием стационарной системы отсчета вместо локальной пространственной привязки

Если у вас есть высокодинамичная голограмма, например персонаж, ходящий по комнате, или плавающий пользовательский интерфейс, который следует вдоль стены за пользователем, вместо использования локальных пространственных привязок лучше визуализировать эти голограммы непосредственно в системе координат, предоставленной [стационарной системой отсчета](coordinate-systems.md#stationary-frame-of-reference) (в Unity это достигается размещением голограмм непосредственно в мировых координатах без привязки WorldAnchor). Голограммы в стационарной системе отсчета могут смещаться, когда пользователь находится далеко от голограммы. Это будет менее заметно для динамических голограмм: либо голограмма постоянно движется, либо она постоянно остается рядом с пользователем, где смещение будет минимальным.

Интересным случаем при использовании динамических голограмм является возможность анимации объекта из одной привязанной системы координат в другую. Например, у вас может быть два замка на расстоянии 10 метров, каждый со своей собственной пространственной привязкой, при этом из одного замка стреляют из пушечного ядра в другой замок. В момент, когда пушечное ядро ​​выстреливается, вы можете отобразить его в соответствующем месте в стационарной системе отсчета, чтобы оно совпадало с пушкой в ​​привязанной системе координат первого замка. Затем оно может следовать своей траектории в стационарной системе отсчета, пролетая 10 метров по воздуху. Когда пушечное ядро ​​достигает другого замка, вы можете переместить его в привязанную систему координат второго замка, чтобы учесть физические расчеты твердых тел этого замка.

Если вы используете высокодинамичную голограмму на разных устройствах, вам нужно выбрать облачную пространственную привязку, которая будет выступать в качестве их родительского элемента, так как стационарные системы отсчета не могут быть общими для всех устройств.  Однако в этом случае вы должны убедиться, что либо динамическая голограмма, либо устройства, просматривающие ее, остаются в радиусе 3-х метров от привязки, чтобы голограмма выглядела стабильной на всех устройствах.

### <a name="avoid-creating-a-grid-of-spatial-anchors"></a>Не следует создавать сетку пространственных привязок

У вас может возникнуть искушение заставить ваше приложение отбрасывать регулярную сетку пространственных привязок, когда пользователь ходит, перемещая динамические объекты от привязки к привязке. Однако это требует большого объема вычислений от приложения без использования данных датчика глубины, которые сама система хранит внутри. В этих случаях вы, как правило, сможете достигнуть лучших результатов с меньшими усилиями, поместив голограммы в стационарную систему отсчета, как описано в разделе выше.

При предварительном размещении набора облачных пространственных привязок вокруг статического пространства вместо создания произвольной сетки привязок можно разместить привязки в местах расположения ключевых голограмм, с которыми пользователь столкнется в соответствии с вышеуказанным принципом.  Это гарантирует максимальную стабильность этих ключевых голограмм.

### <a name="release-local-spatial-anchors-you-no-longer-need"></a>Удаляйте пространственные привязки, которые больше не нужны

Пока локальная пространственная привязка активна, система будет в первую очередь хранить данные датчика, которые находятся рядом с этой привязкой. Если вы больше не используете пространственную привязку, ограничьте доступ к ее системе координат. Это позволит при необходимости удалить базовые данные датчика.

Это особенно важно для локальных привязок, сохраненных в хранилище пространственных привязок. Данные датчиков возле этих привязок будут постоянно храниться, чтобы ваше приложение могло найти эту привязку в будущих сеансах, что сократит пространство, доступное для отслеживания других привязок. Храните только те локальные привязки, которые вам нужно будет найти в будущих сеансах, и удаляйте их из хранилища, когда они больше не будут иметь значения для пользователя.

Для облачных пространственных привязок хранилище можно масштабировать в соответствии с вашим сценарием.  Вы можете хранить любое количество облачных привязок, удаляя их только тогда, когда знаете, что вашим пользователям не нужно будет снова находить голограммы с этими привязками.

## <a name="see-also"></a>См. также
* [Системы координат](coordinate-systems.md)
* [Общий доступ в смешанной реальности](shared-experiences-in-mixed-reality.md)
* <a href="https://docs.microsoft.com/azure/spatial-anchors" target="_blank">Пространственные привязки Azure</a>
* [Сохраняемость в Unity](persistence-in-unity.md)
* [Coordinate systems in DirectX](coordinate-systems-in-directx.md#place-holograms-in-the-world-using-spatial-anchors) (Системы координат в DirectX)
* [Case study - Looking through holes in your reality](case-study-looking-through-holes-in-your-reality.md) (Пример использования. Взгляд сквозь отверстия в реальности)
