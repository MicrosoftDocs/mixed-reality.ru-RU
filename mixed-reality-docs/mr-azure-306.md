---
title: Г-н и 306 Azure - потоковой передачи видео
description: Выполните этот курс, чтобы узнать, как реализовать приложение смешанной реальности служб мультимедиа Azure.
author: drneil
ms.author: jemccull
ms.date: 07/04/2018
ms.topic: article
keywords: Azure, смешанной реальности, academy, unity, учебник, api, служб мультимедиа, потоковое видео, 360, создающий эффект присутствия, виртуальной реальности
ms.openlocfilehash: f6974ab6a72828a557649d5dc65b4e505a7484ff
ms.sourcegitcommit: 384b0087899cd835a3a965f75c6f6c607c9edd1b
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/12/2019
ms.locfileid: "59599486"
---
>[!NOTE]
>Учебники Academy реальности Mixed были разработаны с HoloLens (1-го поколения) и смешанной реальности Иммерсивную в виду.  Таким образом мы думаем, что это важно, чтобы эти учебники на месте для разработчиков, которые по-прежнему необходимы сведения при разработке приложений для этих устройств.  Эти руководства будут **_не_** дополняться последние наборы инструментов или взаимодействия, используемых для HoloLens 2.  Они будут сохранены, чтобы продолжить работу на поддерживаемых устройствах. Будет существовать новую серию учебников, которые будут опубликованы в будущем, демонстрируют способ разработки для HoloLens 2.  Это уведомление будет обновляться со ссылкой на эти руководства, когда они учитываются.

<br> 

# <a name="mr-and-azure-306-streaming-video"></a>Г-н и Azure 306: Потоковое видео

![конечный продукт-запуск](images/AzureLabs-Lab6-00.png)
![конечный продукт-запуск](images/AzureLabs-Lab6-01.png)

В этом курсе вы узнаете, как подключаться служб мультимедиа Azure с работой смешанной реальности VR Windows позволяют передавать всеохватывающее воспроизведение видео в иммерсивную. 

**Службы мультимедиа Azure** представляют собой коллекцию служб, которая предоставляет службы потоковой передачи видео высокого качества для более широкой аудитории на современных наиболее популярных мобильных устройствах. Дополнительные сведения см. в статье [страницы служб мультимедиа Azure](https://azure.microsoft.com/services/media-services).

После выполнения этого курса, у вас будет приложении иммерсивных гарнитуры смешанной реальности, смогут осуществлять следующее:

1. Получить видео 360 градусов из **хранилища Azure**, до **Azure Media Service**.

2. Отображение видео извлеченных 360 градусов в сцене Unity.

3. Перемещаться между двумя сценами, с помощью двух разных видео.

В приложении зависит от пользователя о том, как интегрировать результаты проектированию. Этот курс призван научить позволяют интегрировать службу Azure с проектом Unity. Это задание может использовать знание, что вы получите из этого курса можно улучшить приложение смешанной реальности.

## <a name="device-support"></a>Поддержка устройств

<table>
<tr>
<th>Курс</th><th style="width:150px"> <a href="hololens-hardware-details.md">HoloLens</a></th><th style="width:150px"> <a href="immersive-headset-hardware-details.md">Иммерсивную</a></th>
</tr><tr>
<td> Г-н и Azure 306: Потоковое видео</td><td style="text-align: center;"> </td><td style="text-align: center;"> ✔️</td>
</tr>
</table>

## <a name="prerequisites"></a>предварительные требования

> [!NOTE]
> Этот учебник предназначен для разработчиков, имеющих минимальный опыт с помощью Unity и C#. Также имейте в виду, что предварительные требования и инструкции в этом документе представляют новые были протестированы и проверены на момент написания статьи (мая 2018 г.). Вы можете свободно использовать последнюю программное обеспечение, как указано в [установить средства статье](install-the-tools.md), хотя следует не полагать, что информация в этом курсе будет точным соответствием что можно найти в новой версии по сравнению приведенных ниже .

Рекомендуется следующее оборудование и программное обеспечение для этого курса:

- На Компьютере, разработки [совместимы с Windows Mixed Reality](https://support.microsoft.com/help/4039260/windows-10-mixed-reality-pc-hardware-guidelines) для иммерсивных разработки Гарнитура (VR)
- [Windows 10 Fall Creators Update (или более поздней версии) с включенным режимом разработчика](install-the-tools.md#installation-checklist)
- [Последний пакет SDK Windows 10](install-the-tools.md#installation-checklist)
- [Unity 2017.4](install-the-tools.md#installation-checklist)
- [Visual Studio 2017](install-the-tools.md#installation-checklist)
- Объект [иммерсивных (VR) гарнитуры смешанной реальности Windows](immersive-headset-hardware-details.md)
- Доступ к Интернету для Azure установки и извлечения данных
- Два характеристиках видео в формате mp4 (можно найти некоторые видеоматериалы, бесплатные [на этой странице загрузки](https://www.mettle.com/360vr-master-series-free-360-downloads-page))

## <a name="before-you-start"></a>Прежде чем начать

1.  Чтобы избежать возникновения проблем сборки этого проекта, настоятельно рекомендуется создать проект, упомянутые в этом руководстве в корень или рядом с корневой папки (пути к папкам long может привести к проблемам во время сборки).
2.  Настройка и проверка вашего смешанной реальности гарнитура Иммерсивных.

    > [!NOTE]
    > Вы будете **не** требуются контроллеры движения курс с демороликами. Если вам нужна поддерживает настройку Иммерсивных гарнитура, нажмите кнопку [ссылку о том, как настроить Windows Mixed Reality](https://support.microsoft.com/en-au/help/4043101/windows-10-set-up-windows-mixed-reality).

## <a name="chapter-1---the-azure-portal-creating-the-azure-storage-account"></a>Глава 1 - на портале Azure: Создание учетной записи хранения Azure

Чтобы использовать **службы хранилища Azure**, вам потребуется создать и настроить **учетной записи хранения** на портале Azure.

1.  Войдите в [портала Azure](https://portal.azure.com).

    > [!NOTE]
    > Если у вас еще нет учетной записи Azure, необходимо будет создать его. Если вы следуете этим руководством, аудитории или лаборатории ситуации, попросите преподавателем или из прокторов для сведения о настройке новой учетной записи.

2.  После входа в систему щелкните **учетные записи хранения** в меню слева.

    ![Настройка учетной записи хранения Azure](images/AzureLabs-Lab6-02.png)

3.  На **учетные записи хранения** , щелкните на **добавить**.

    ![Настройка учетной записи хранения Azure](images/AzureLabs-Lab6-03.png)

4.  В **учетная запись хранения** вкладке:

    1.  Вставить **имя** для вашей учетной записи, помните, это поле принимает только цифры и строчные буквы.

    2.  Для **модели развертывания,** выберите **Resource manager**.

    3.  Для **тип учетной записи**выберите **хранилища (общего назначения версии 1)**.

    4.  Для **производительности** выберите **Standard*.** 

    5.  Для **репликации** выберите **локально избыточное хранилище (LRS)**.

    6.  Оставьте **требуется безопасное перемещение** как **отключено**.

    7.  Выберите **подписки**.

    8.  Выберите **группы ресурсов** или создайте новую. Группа ресурсов предоставляет способ отслеживания, контроля доступа, Подготовка и управление выставлением счетов для набора средств Azure.

    9.  Определить **расположение** для группы ресурсов (Если вы создаете новую группу ресурсов). Расположение оптимально подойдет в регионе, в котором приложение будет работать. Некоторые ресурсы Azure доступны только в определенных регионах.

5.  Будет необходимо подтвердить, что мы рассмотрели, положения и условия, применяемые к этой службе.

    ![Настройка учетной записи хранения Azure](images/AzureLabs-Lab6-04.png)

6.  Когда вы перейдете на **создать**, вы получите ожидания службы должен быть создан, это может занять около минуты.

7.  Уведомление будет отображаться на портале, после создания экземпляра службы.

    ![Настройка учетной записи хранения Azure](images/AzureLabs-Lab6-05.png)

8.  На этом этапе вы не обязательно должны следовать ресурса — просто переход к следующей главе.

## <a name="chapter-2---the-azure-portal-creating-the-media-service"></a>Глава 2 - на портале Azure: создание службы мультимедиа

Чтобы использовать службы мультимедиа Azure, необходимо настроить экземпляр службы, чтобы сделать доступными для приложения (при котором владелец учетной записи должен иметь права администратора).

1.  На портале Azure щелкните **создать ресурс** в левом верхнем углу, а поиск **службы мультимедиа** клавишу **ввод**. Ресурс, который вы хотите в настоящее время имеет розовый значка. Выберите этот параметр, чтобы отобразить новую страницу.

    ![Портал Azure](images/AzureLabs-Lab6-06.png)

2.  Новая страница будет предоставить описание **службы мультимедиа**. В нижней левой части этого запроса, нажмите кнопку **создать** кнопку, чтобы создать ассоциацию с этой службой.

    ![Портал Azure](images/AzureLabs-Lab6-07.png)

3.  Когда вы перейдете на **создать** панели будет отображаться, когда необходимо предоставить некоторые сведения о новой службы мультимедиа:

    1.  Вставить нужный **имя учетной записи** для данного экземпляра службы.

    2.  Выберите **подписки**.

    3. Выберите **группы ресурсов** или создайте новую. Группа ресурсов предоставляет способ отслеживания, контроля доступа, Подготовка и управление выставлением счетов для набора средств Azure. Рекомендуется хранить все службы Azure, связанные с один проект (например, такие как многому) в разделе общей группы ресурсов). 
    
    > Если вы хотите получить дополнительные сведения о группах ресурсов Azure, выполните инструкции из этого [ссылка на сведения об управлении группами ресурсов Azure](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-portal).

    4.  Определить **расположение** для группы ресурсов (Если вы создаете новую группу ресурсов). Расположение оптимально подойдет в регионе, в котором приложение будет работать. Некоторые ресурсы Azure доступны только в определенных регионах.

    5.  Для **учетной записи хранения** щелкните **выберите...**  раздела, а затем щелкните **учетной записи хранения** созданный в предыдущей главе.

    6.  Также необходимо будет подтвердить, что мы рассмотрели, положения и условия, применяемые к этой службе.

    7.  Нажмите кнопку **Создать**.

        ![Портал Azure](images/AzureLabs-Lab6-08.png)

4.  Когда вы перейдете на **создать**, вы получите ожидания службы должен быть создан, это может занять около минуты.

5.  Уведомление будет отображаться на портале, после создания экземпляра службы.

    ![Портал Azure](images/AzureLabs-Lab6-09.png)

6.  Щелкните уведомление, чтобы изучить ваш новый экземпляр службы.

    ![Портал Azure](images/AzureLabs-Lab6-10.png)

7.  Нажмите кнопку **перейти к ресурсу** кнопки в уведомлении для просмотра в новом экземпляре службы.

8.  На странице новой службы мультимедиа на панели слева щелкните **активы** ссылку, которая посвящена равном вниз.

9.  На следующей странице в левом верхнем углу страницы, нажмите кнопку **отправить**.

    ![Портал Azure](images/AzureLabs-Lab6-11.png)

10. Щелкните **папку** значок, чтобы просматривать файлы и выберите сначала 360 видео, которое вы хотите выполнять потоковую передачу. 
    
    > Это можно выполнить [ссылку, чтобы загрузить пример видео](https://vimeo.com/214401712).

    ![Портал Azure](images/AzureLabs-Lab6-12.png)

> [!WARNING]
> Длинные имена файлов может вызвать проблемы с помощью кодировщика: таким образом чтобы видео проблем нет, необходимо рассмотреть возможность сокращения длина имен видеофайл.

11. Индикатор станет зеленым, если видео завершил передачу.

    ![Портал Azure](images/AzureLabs-Lab6-13.png)

12. Щелкните текст выше (**yourservicename - активы**) чтобы вернуться к **активы** страницы.

13. Обратите внимание, что видео был успешно загружен. Щелкните ее.

    ![Портал Azure](images/AzureLabs-Lab6-14.png)

14. Вы будете перенаправлены на страницу будет показывать, подробные сведения о видео. Чтобы иметь возможность использовать ваше видео, их нужно кодировать его, щелкнув **Encode** кнопку в верхней левой части страницы.

    ![Портал Azure](images/AzureLabs-Lab6-15.png)

15. Новая панель появится справа, где можно задать параметры для файла кодировки. Задайте следующие свойства (некоторые будет уже установлено по умолчанию):

    1.  **Имя кодировщика мультимедиа *Media Encoder Standard***

    2.  **Предустановки для кодирования *Content Adaptive Multiple Bitrate MP4***

    3.  **Имя задания *Media Encoder Standard обработки Video1.mp4***

    4.  **Имя ресурса-контейнера мультимедиа выходные данные *Video1.mp4--Media Encoder Standard в кодировке***

        ![Портал Azure](images/AzureLabs-Lab6-16.png)

16. Нажмите кнопку **Создать**.

17. Появится панель с **задания кодирования добавлен**, щелкните на этой панели и панель будет отображаться с помощью процесса кодирования, в нем отображается.

    ![Портал Azure](images/AzureLabs-Lab6-17.png)

    ![Портал Azure](images/AzureLabs-Lab6-18.png)

18. Дождитесь завершения задания. После этого, вы можете закрыть панель с «X» в правом верхнем углу этой панели.

    ![Портал Azure](images/AzureLabs-Lab6-19.png)

    ![Портал Azure](images/AzureLabs-Lab6-20.png)

    > [!IMPORTANT]
    > Время, которое для этого потребуется, зависит от размера файла видео. Этот процесс может занять довольно много времени.

19. Теперь, когда закодированная версия параметра видео будет создана, можно опубликовать его, чтобы сделать его доступным. Чтобы сделать это, щелкните синий ссылку **активы** чтобы вернуться на страницу ресурсов.

    ![Портал Azure](images/AzureLabs-Lab6-21.png)

20. Вы увидите видео вместе с другой, принадлежащей **тип актива *MP4 с несколькими скоростями***.

    ![Портал Azure](images/AzureLabs-Lab6-22.png)

    > [!NOTE] 
    > Вы можете заметить, что новый ресурс, наряду с начальной видео, является *Неизвестный*, и имеет "0" байт, он является **размер**, просто обновите окно для ее обновления.

21. Щелкните этот новый ресурс.

    ![Портал Azure](images/AzureLabs-Lab6-23.png)

22. Вы увидите аналогичные панели тот, который использовался ранее, просто это другой ресурс. Нажмите кнопку **публикации** расположенную в центре верхней части страницы.

    ![Портал Azure](images/AzureLabs-Lab6-24.png)

23. Вам будет предложено задать **локатора**, который является точкой входа, в файл/s, в ресурсах. Для вашего сценария установите следующие свойства:

    1.  **Тип указателя** > **последовательной**.

    2.  **Даты** и **время** будет присвоено, с вашей текущей даты, время в будущем (Сто лет в данном случае). Оставьте как есть или изменить его в соответствии с.

    > [!NOTE]
    > Дополнительные сведения о Локаторах и вы можете [документацию по службам мультимедиа Azure](https://docs.microsoft.com/azure/media-services/media-services-concepts).

24. В нижней части этой панели, щелкните **добавить** кнопки.

    ![Портал Azure](images/AzureLabs-Lab6-25.png)

25. Видео, опубликованы и может передаваться с помощью конечной точки. Далее вниз, данная страница является **файлы** раздел. Это, где будет различных версий закодированное видео. Выберите наибольшее возможное решение, один (на приведенном ниже рисунке это файл 1920 x 960), и затем будут отображаться панели справа. Там вы найдете **URL-адрес скачивания**. Скопируйте этот **конечной точки** так как оно будет использоваться в коде.

    ![Портал Azure](images/AzureLabs-Lab6-26.png)    

    ![Портал Azure](images/AzureLabs-Lab6-27.png)

    > [!NOTE] 
    > Можно также нажать **воспроизведение** кнопку, чтобы воспроизвести видео и протестировать его.

26. Теперь необходимо передать второй видео, которое будет использоваться в этом лабораторном занятии. Выполните действия, описанные в повторение тот же процесс для второго видео. Убедитесь, вы скопировали вторая **конечной точки** также. Используйте следующую команду [ссылку на загрузку второй видео](https://vimeo.com/214402865).

27. После публикации обеих видео вы готовы перейти к следующей главе.

## <a name="chapter-3---setting-up-the-unity-project"></a>Глава 3 - Настройка проекта Unity

Следующие запущена типичный набор для разработки с помощью смешанной реальности и, таким образом, — это хороший шаблон для других проектов.

1.  Откройте **Unity** и нажмите кнопку **New**. 

    ![Портал Azure](images/AzureLabs-Lab6-28.png)

2.  Введите имя проекта Unity, теперь нужно вставить **MR\_360VideoStreaming.**. Убедитесь, что тип проекта присваивается **3D**. Задание расположения в другое место, наиболее подходящего для вас (Помните, что лучше, чем ближе к корневые каталоги). Щелкните **создать проект**.

    ![Портал Azure](images/AzureLabs-Lab6-29.png)

3.  С помощью Unity откройте, стоит проверки по умолчанию **редактор сценариев** присваивается **Visual Studio.** Перейдите к ***изменить* *предпочтения*** и затем в окне «Новый» перейдите к **внешние средства**. Изменение **внешнего редактора скриптов** для **Visual Studio 2017**. Закрыть **предпочтения** окна.

    ![Портал Azure](images/AzureLabs-Lab6-30.png)

4.  Перейдите к ***файл* *параметры построения*** и переключитесь на платформе, которое **универсальной платформы Windows**, щелкнув **Переключить платформу** кнопки.

5.  Также убедитесь, что:

    1. **Целевое устройство** присваивается **любого устройства.**
    
    2.  **Тип сборки** присваивается **D3D.**

    3.  **Пакет SDK для** присваивается **самую новую установленную.**

    4.  **Версия Visual Studio** присваивается **самую новую установленную.**

    5.  **Сборка и запуск** присваивается **локального компьютера.**

    6.  Не беспокоиться о настройке **сцены** прямо сейчас, как вы настроите их позже.

    7.  Остальные параметры следует оставить значение по умолчанию сейчас.

        ![Настройка проекта Unity](images/AzureLabs-Lab6-31.png)

6.  В **параметры построения** щелкните **параметры проигрывателя** кнопки, откроется панель связанных в пространстве где **инспектор** находится. 

7. В этой панели необходимо проверить некоторые настройки:

    1.  В **другие параметры** вкладке:

        1.  **Сценарии** **версии среды выполнения** должно быть **стабильной** (.NET 3.5 эквивалент).

        2. **Создание сценариев серверной части** должно быть **.NET.**

        3. **Уровень совместимости API** должно быть **.NET 4.6.**

            ![Настройка проекта Unity](images/AzureLabs-Lab6-32.png)

    2.  Далее панели в **XR параметры** (под **параметры публикации**), деления **поддерживается виртуальной реальности**, убедитесь, что **смешанной реальности SDK Windows**  добавляется.

        ![Настройка проекта Unity](images/AzureLabs-Lab6-33.png)

    3.  В рамках **параметров публикации** в списке **возможности**, проверьте:

        - **internetClient**

            ![Настройка проекта Unity](images/AzureLabs-Lab6-34.png)

8.  После внесения этих изменений, закройте **параметры построения** окна.

9.  Сохраните проект **файл* *сохранить проект **.



## <a name="chapter-4---importing-the-insideoutsphere-unity-package"></a>Глава 4 — Импорт пакета InsideOutSphere Unity

> [!IMPORTANT]
> Если вы хотите пропустить *Настройка Unity* компонент курс и по-прежнему непосредственно в код, вы можете загрузить [.unitypackage](https://github.com/Microsoft/HolographicAcademy/raw/Azure-MixedReality-Labs/Azure%20Mixed%20Reality%20Labs/MR%20and%20Azure%20306%20-%20Streaming%20video/Azure-MR-306.unitypackage), импортировать его в проект в качестве [ **Пользовательского пакета**](https://docs.unity3d.com/Manual/AssetPackages.html), а затем продолжить из **Глава 5**. По-прежнему необходимо будет создать проект Unity.

Для этого курса необходимо загрузить пакет средств Unity, которые называются [ **InsideOutSphere.unitypackage**](https://github.com/Microsoft/HolographicAcademy/raw/Azure-MixedReality-Labs/Azure%20Mixed%20Reality%20Labs/MR%20and%20Azure%20306%20-%20Streaming%20video/InsideOutSphere.unitypackage).

Инструкции импорта **пакет unitypackage**:

1.  С помощью панели мониторинга Unity перед глазами, щелкните **активы** в меню в верхней части экрана, нажмите кнопку **Импорт пакета > пользовательского пакета**.

    ![Импорт пакета InsideOutSphere Unity](images/AzureLabs-Lab6-35.png)

2.  Используйте средство выбора файлов для выбора **InsideOutSphere.unitypackage** пакета и нажмите кнопку **откройте**. Список компонентов для этого ресурса будет отображаться пользователю. Подтверждение импорта, щелкнув **импорта**.

    ![Импорт пакета InsideOutSphere Unity](images/AzureLabs-Lab6-36.png)

3.  После его завершения импорта вы заметите три новых папок, **материалы**, **моделей**, и **Prefabs**, были добавлены к **активы**папки. Такого рода структуру папок является типичным для проекта Unity.

    ![Импорт пакета InsideOutSphere Unity](images/AzureLabs-Lab6-37.png)

    1.  Откройте **моделей** папки и вы увидите, **InsideOutSphere** модели был импортирован.

    2.  В рамках **материалы** вы найдете папку **InsideOutSpheres** материал *lambert1*, вместе с именем материал *ButtonMaterial*, который используется системой GazeButton, который появится в ближайшее время.

    3.  **Prefabs** папка содержит **InsideOutSphere** готового блока, который содержит оба **InsideOutSphere** *модели* и  *GazeButton*.

    4.  **Включено без кода**, вы напишете код, выполнив этот курс.


4.  В рамках **иерархии**выберите **Main Camera** объекта и обновите следующие компоненты:

    1.  **Преобразование**

        1.  Позиция = **X**: 0, **Y**: 0, **Z**: 0.

        2. Поворот = **X**: 0, **Y**: 0, **Z**: 0.

        3. Масштаб **X**: 1, **Y**: 1, **Z**: 1.

    2.  **Камера**

        1. **Очистить флаги**: Сплошным цветом.

        2.  **Обрезки плоскостей**: Рядом с: 0,1, далеко: 6.

            ![Импорт пакета InsideOutSphere Unity](images/AzureLabs-Lab6-38.png)

5.  Перейдите к **Prefab** папку, а затем перетащите **InsideOutSphere** prefab в **иерархии** панели.

    ![Импорт пакета InsideOutSphere Unity](images/AzureLabs-Lab6-39.png)

6.  Разверните **InsideOutSphere** объекта в пределах **иерархии** , щелкнув небольшой стрелку рядом с ним. Вы увидите **дочерних** объекта, именуемое **GazeButton**. Это будет использоваться для изменения автоматически и таким образом видео.

    ![Импорт пакета InsideOutSphere Unity](images/AzureLabs-Lab6-40.png)

7.  В окне инспектора щелкните **InsideOutSphere**преобразовать компонент, убедитесь, что заданы следующие свойства:

    |            |    ПРЕОБРАЗОВАНИЕ - ПОЗИЦИИ   |           |
    | :---------:| :-----------------------: | :--------:|
    |   **X** 0  |          **Y** 0          |  **Z** 0  |

    |            |    ПРЕОБРАЗОВАНИЕ - ПОВОРОТА   |           |
    | :---------:| :-----------------------: | :--------:|
    |   **X** 0  |          **Y** -50        |  **Z** 0  |

    |            |     ПРЕОБРАЗОВАНИЕ - МАСШТАБИРОВАНИЯ     |           |
    | :---------:| :-----------------------: | :--------:|
    |  **X** 1   |          **Y** 1          |  **Z** 1  |

    ![Импорт пакета InsideOutSphere Unity](images/AzureLabs-Lab6-41.png)

8.  Щелкните **GazeButton** дочерний объект и задать его **преобразования** следующим образом:

    |            |    ПРЕОБРАЗОВАНИЕ - ПОЗИЦИИ   |           |
    | :---------:| :-----------------------: | :--------:|
    |   **X** 3.6|          **Y** 1.3        |  **Z** 0  |

    |            |    ПРЕОБРАЗОВАНИЕ - ПОВОРОТА   |           |
    | :---------:| :-----------------------: | :--------:|
    |   **X** 0  |          **Y** 0          |  **Z** 0  |

    |            |     ПРЕОБРАЗОВАНИЕ - МАСШТАБИРОВАНИЯ     |           |
    | :---------:| :-----------------------: | :--------:|
    |  **X** 1   |          **Y** 1          |  **Z** 1  |

    ![Импорт пакета InsideOutSphere Unity](images/AzureLabs-Lab6-42.png)


## <a name="chapter-5---create-the-videocontroller-class"></a>Глава 5 - создание класса VideoController

**VideoController** класс размещает две конечные точки видео, которые будут использоваться для потоковой передачи содержимого из службы мультимедиа Azure.

Для создания этого класса:

1.  Щелкните правой кнопкой мыши в **папке Asset**, который находится в **проекта** панели и щелкните **Создать > Папка**. Назовите папку **сценариев**.

    ![Создание класса VideoController](images/AzureLabs-Lab6-43.png)

    ![Создание класса VideoController](images/AzureLabs-Lab6-44.png)

2.  Дважды щелкните **сценариев** папку, чтобы открыть его.

3.  Щелкните правой кнопкой мыши внутри папки, а затем щелкните **Создать > C\# скрипт**. Назовите сценарий **VideoController**.

    ![Создание класса VideoController](images/AzureLabs-Lab6-45.png)

4.  Дважды щелкните новый **VideoController** скрипт, чтобы открыть его с **Visual Studio 2017.**

    ![Создание класса VideoController](images/AzureLabs-Lab6-46.png)

5.  Обновите пространства имен в верхней части файла кода следующим образом:

    ```csharp
    using System.Collections;
    using UnityEngine;
    using UnityEngine.SceneManagement;
    using UnityEngine.Video;
    ```

6.  Введите следующие переменные в **VideoController** класса, наряду с **Awake()** метод:

    ```csharp
        /// <summary> 
        /// Provides Singleton-like behaviour to this class. 
        /// </summary> 
        public static VideoController instance; 
        
        /// <summary> 
        /// Reference to the Camera VideoPlayer Component.
        /// </summary> 
        private VideoPlayer videoPlayer; 
        
        /// <summary>
        /// Reference to the Camera AudioSource Component.
        /// </summary> 
        private AudioSource audioSource; 
        
        /// <summary> 
        /// Reference to the texture used to project the video streaming 
        /// </summary> 
        private RenderTexture videoStreamRenderTexture;

        /// <summary>
        /// Insert here the first video endpoint
        /// </summary>
        private string video1endpoint = "-- Insert video 1 Endpoint here --";

        /// <summary>
        /// Insert here the second video endpoint
        /// </summary>
        private string video2endpoint = "-- Insert video 2 Endpoint here --";

        /// <summary> 
        /// Reference to the Inside-Out Sphere. 
        /// </summary> 
        public GameObject sphere;

        void Awake()
        {
            instance = this;
        }
    ```

7.  Пришло время для ввода конечные точки на основе видео Azure Media Service:

    1.  Первый в *video1endpoint* переменной.
    
    2.  Второй в *video2endpoint* переменной.

    > [!WARNING]
    > Имеется известная проблема, с помощью *https* в Unity, при использовании версии 2017.4.1f1. Если видео содержат ошибку в play, попробуйте вместо этого использовать «http».

8.  Далее, **Start()** метод подходит для редактирования. Этот метод запускается каждый раз при переключении сцены (следовательно переключение видео), просмотрев кнопку помощи.

    ```csharp
        // Use this for initialization
        void Start()
        {
            Application.runInBackground = true;
            StartCoroutine(PlayVideo());
        }
    ```

9.  Следуя **Start()** метод, вставьте **PlayVideo()** *IEnumerator* метод, который будет использоваться для запуска видео без проблем (поэтому наблюдается без дерганья изображения).

    ```csharp
        private IEnumerator PlayVideo()
        {
            // create a new render texture to display the video 
            videoStreamRenderTexture = new RenderTexture(2160, 1440, 32, RenderTextureFormat.ARGB32);

            videoStreamRenderTexture.Create();

            // assign the render texture to the object material 
            Material sphereMaterial = sphere.GetComponent<Renderer>().sharedMaterial;

            //create a VideoPlayer component 
            videoPlayer = gameObject.AddComponent<VideoPlayer>();

            // Set the video to loop. 
            videoPlayer.isLooping = true;

            // Set the VideoPlayer component to play the video from the texture 
            videoPlayer.renderMode = VideoRenderMode.RenderTexture;

            videoPlayer.targetTexture = videoStreamRenderTexture;

            // Add AudioSource 
            audioSource = gameObject.AddComponent<AudioSource>();

            // Pause Audio play on Awake 
            audioSource.playOnAwake = true;
            audioSource.Pause();

            // Set Audio Output to AudioSource 
            videoPlayer.audioOutputMode = VideoAudioOutputMode.AudioSource;
            videoPlayer.source = VideoSource.Url;

            // Assign the Audio from Video to AudioSource to be played 
            videoPlayer.EnableAudioTrack(0, true);
            videoPlayer.SetTargetAudioSource(0, audioSource);

            // Assign the video Url depending on the current scene 
            switch (SceneManager.GetActiveScene().name)
            {
                case "VideoScene1":
                    videoPlayer.url = video1endpoint;
                    break;

                case "VideoScene2":
                    videoPlayer.url = video2endpoint;
                    break;

                default:
                    break;
            }

            //Set video To Play then prepare Audio to prevent Buffering 
            videoPlayer.Prepare();

            while (!videoPlayer.isPrepared)
            {
                yield return null;
            }

            sphereMaterial.mainTexture = videoStreamRenderTexture;

            //Play Video 
            videoPlayer.Play();

            //Play Sound 
            audioSource.Play();

            while (videoPlayer.isPlaying)
            {
                yield return null;
            }
        }
    ```

10. Последний метод, необходимые для этого класса **ChangeScene()** метод, который будет использоваться для переключения между сценами.

    ```csharp
        public void ChangeScene()
        {
            SceneManager.LoadScene(SceneManager.GetActiveScene().name == "VideoScene1" ? "VideoScene2" : "VideoScene1");
        }
    ```

    > [!TIP] 
    > **ChangeScene()** метод использует под рукой C\# , называемого *условный оператор*. Это позволяет для условий для проверки, и затем значения возвращаются в зависимости от результата проверки, все в одной инструкции. Выполните это [ссылку, чтобы узнать больше о условный оператор](https://docs.microsoft.com/dotnet/csharp/language-reference/operators/conditional-operator).

11. Сохраните изменения в Visual Studio перед возвратом к Unity.

12. Обратно в редакторе Unity, щелкните и перетащите **VideoController** класса [из] {.underline} **сценарии** папку **Main Camera** объекта в  **Иерархия** панели.

13. Щелкните **Main Camera** и просмотрите **панели Инспектора**. Обратите внимание, что в компоненте скрипта вновь добавленный есть поле с пустым значением. Это поле ссылки, которая нацелена на открытые переменные в коде.

14. Перетащите **InsideOutSphere** объекта из **панели иерархии** для **Sphere** область памяти, как показано на рисунке ниже.

    ![Создайте класс VideoController](images/AzureLabs-Lab6-47.png)
    ![создать класс VideoController](images/AzureLabs-Lab6-48.png)

## <a name="chapter-6---create-the-gaze-class"></a>Глава 6 - создание класса взглядом

Этот класс отвечает за создание **Raycast** что будет beprojected вперед от **Main Camera**, для обнаружения какой объект, который просматривает пользователь. В этом случае **Raycast** будет необходимо определить, если пользователь просматривает **GazeButton** объект в сцене и активировать поведение.

Для создания данного класса:

1.  Перейдите к **сценариев** папку, созданную ранее.

2.  Щелкните правой кнопкой мыши в **проекта** панели **создать* *C\# Script**. Назовите сценарий **помощи**.

3.  Дважды щелкните новый ***помощи*** скрипт, чтобы открыть его с **Visual Studio 2017.**

4.  Убедитесь, что следующее пространство имен в верхней части сценария и удалите любые другие:

    ```csharp
    using UnityEngine;
    ```

5.  Затем добавьте следующие переменные внутри **помощи** класса:

    ```csharp
        /// <summary> 
        /// Provides Singleton-like behaviour to this class. 
        /// </summary> 
        public static Gaze instance;

        /// <summary> 
        /// Provides a reference to the object the user is currently looking at. 
        /// </summary> 
        public GameObject FocusedGameObject { get; private set; }

        /// <summary> 
        /// Provides a reference to compare whether the user is still looking at 
        /// the same object (and has not looked away). 
        /// </summary> 
        private GameObject oldFocusedObject = null;

        /// <summary> 
        /// Max Ray Distance 
        /// </summary> 
        float gazeMaxDistance = 300;

        /// <summary> 
        /// Provides whether an object has been successfully hit by the raycast. 
        /// </summary> 
        public bool Hit { get; private set; }
    ```

6.  Код для **Awake()** и **Start()** методы теперь должен быть добавлен.

    ```csharp
        private void Awake()
        {
            // Set this class to behave similar to singleton 
            instance = this;
        }

        void Start()
        {
            FocusedGameObject = null;
        }
    ```

7.  Добавьте следующий код в **Update()** метод для проекта Raycast и выявления попаданий целевой:

    ```csharp
        void Update()
        {
            // Set the old focused gameobject. 
            oldFocusedObject = FocusedGameObject;
            RaycastHit hitInfo;

            // Initialise Raycasting. 
            Hit = Physics.Raycast(Camera.main.transform.position, Camera.main.transform.forward, out hitInfo, gazeMaxDistance);

            // Check whether raycast has hit. 
            if (Hit == true)
            {
                // Check whether the hit has a collider. 
                if (hitInfo.collider != null)
                {
                    // Set the focused object with what the user just looked at. 
                    FocusedGameObject = hitInfo.collider.gameObject;
                }
                else
                {
                    // Object looked on is not valid, set focused gameobject to null. 
                    FocusedGameObject = null;
                }
            }
            else
            {
                // No object looked upon, set focused gameobject to null.
                FocusedGameObject = null;
            }

            // Check whether the previous focused object is this same 
            // object (so to stop spamming of function). 
            if (FocusedGameObject != oldFocusedObject)
            {
                // Compare whether the new Focused Object has the desired tag we set previously. 
                if (FocusedGameObject.CompareTag("GazeButton"))
                {
                    FocusedGameObject.SetActive(false);
                    VideoController.instance.ChangeScene();
                }
            }
        }
    ```

8.  Сохраните изменения в Visual Studio перед возвратом к Unity.

9.  Щелкните и перетащите **помощи** класса из папки скриптов для объекта Main Camera в **иерархии** панели.

## <a name="chapter-7---setup-the-two-unity-scenes"></a>Глава 7 - два Unity сцены

В этой главе предназначена для настройки двух сцен, каждый из которых размещает видео в stream. Вы приведет к дублированию сцены, вы уже создали, таким образом, чтобы не нужно настроить еще раз, то, что вы затем измените новую сцену, чтобы *GazeButton* объект находится в другом месте и имеет различный внешний вид. Это позволяет продемонстрировать изменение между сценами.

1.  Это можно сделать, выбрав **файл > Сохранить сцену как...** . Сохранение окно будет отображаться. Нажмите кнопку **новую папку** кнопки.

    ![Глава 7 - два Unity сцены](images/AzureLabs-Lab6-49.png)

2.  Назовите папку **сцены**.

3.  **Сохранить сцену** окно по-прежнему будут открыты. Откройте только что созданный **сцены** папки.

4.  В **имя файла:** текстовое поле, тип **VideoScene1**, затем нажмите клавишу **Сохранить**.

5.  В Unity, откройте ваш **сцены** папку, а затем выберите пункт вашей **VideoScene1** файл. Использование клавиатуры и нажмите клавишу **Ctrl + D** дублируются сцены

    > [!TIP]
    > **Дублировать** также можно выполнить команду, перейдя по адресу **изменить > Дублировать**.

6.  Unity будет автоматически увеличивать количество имен сцены, но включить его в любом случае, убедитесь, что он соответствует ранее вставленный код.

    >  Вы должны иметь **VideoScene1** и **VideoScene2**.

7.  С вашей двумя сценами, перейдите к **файл > Параметры сборки**. С помощью **параметры построения** открытое окно, перетащите вашей работает **сцены в сборке** раздел.

    ![Глава 7 - Настройка двумя сценами Unity](images/AzureLabs-Lab6-50.png)

    > [!TIP] 
    > Можно выбрать оба вашей сцены из вашей **сцены** общему ресурсу посредством совместного хранения **Ctrl** кнопку, затем щелчок левой кнопкой мыши каждый сцены и наконец перетащите оба по.

8.  Закрыть **параметры построения** окно и двойного щелчка по **VideoScene2**.

9.  Откройте второй сцены, выберите команду **GazeButton** дочерний объект **InsideOutSphere**и установите его преобразования следующим образом:

    |            |    ПРЕОБРАЗОВАНИЕ - ПОЗИЦИИ   |           |
    | :---------:| :-----------------------: | :--------:|
    |   **X** 0  |         **Y** 1.3         | **Z** 3.6 |

    |            |    ПРЕОБРАЗОВАНИЕ - ПОВОРОТА   |           |
    | :---------:| :-----------------------: | :--------:|
    |   **X** 0  |          **Y** 0          |  **Z** 0  |

    |            |     ПРЕОБРАЗОВАНИЕ - МАСШТАБИРОВАНИЯ     |           |
    | :---------:| :-----------------------: | :--------:|
    |  **X** 1   |          **Y** 1          |  **Z** 1  |

10. С **GazeButton** все еще выбран, поиск в дочерних **инспектор** и **Сетка фильтра**. Щелкните рядом с полем мало целевой **Mesh** эталонное поле:

    ![Глава 7 - Настройка двумя сценами Unity](images/AzureLabs-Lab6-51.png)

11. Объект **выберите Mesh** Откроется всплывающее окно. Дважды щелкните **куба** mesh из списка **активы**.

    ![Глава 7 - Настройка двумя сценами Unity](images/AzureLabs-Lab6-52.png)

12. **Сетка фильтра** будет обновить и теперь **куба**. Теперь щелкните **шестеренки** значок рядом с полем **Sphere Collider** и нажмите кнопку **удалить компонент**, чтобы удалить collider от этого объекта.

    ![Глава 7 - Настройка двумя сценами Unity](images/AzureLabs-Lab6-53.png)

13. С помощью **GazeButton** все еще выбран, щелкните **добавить компонент** кнопки в нижней части **инспектор**. В поле поиска введите **поле**, и **Collider поле** будет иметь параметр — щелкните, чтобы добавить **Collider поле** для вашей **GazeButton** объекта .

    ![Глава 7 - Настройка двумя сценами Unity](images/AzureLabs-Lab6-54.png)

14. **GazeButton** — теперь частично обновлена, чтобы выглядеть по-другому, тем не менее, теперь вы создадите новый **материал**, в котором она выглядит совершенно по-разному и легче распознать как другой объект, чем объект в первую сцену.

15. Перейдите к вашей **материалы** папку, в пределах **панель проекта**. Дублировать **ButtonMaterial** материал (нажмите клавишу **Ctrl** + **D** на клавиатуре или щелкните левой кнопкой **материал**, затем из **изменить** пункт меню, выберите файл **дублировать**).

    ![Глава 7 - Настройка двумя сценами Unity](images/AzureLabs-Lab6-55.png)
    ![Глава 7 — Настройка двумя сценами Unity](images/AzureLabs-Lab6-56.png)

16. Выберите новый **ButtonMaterial** материал (здесь с именем **ButtonMaterial 1**) и в **инспектор**, нажмите кнопку **Albedo** цвет окно. Откроется всплывающее окно, в котором можно выбрать другой цвет (выберите, какое угодно), затем закройте всплывающее окно. Материал будет свой собственный экземпляр и отличается от исходного.

    ![Глава 7 - Настройка двумя сценами Unity](images/AzureLabs-Lab6-57.png)

17. Перетащите новый **материал** на **GazeButton** дочерний элемент, теперь полностью обновить его внешний вид, так как это легко отличить от первой кнопки сцены.

    ![Глава 7 - Настройка двумя сценами Unity](images/AzureLabs-Lab6-58.png)

18. На этом этапе можно проверить проекта в редакторе перед построением проекта универсальной платформы Windows.

    -  Нажмите клавишу **воспроизведение** кнопку **редактор** и wear вашей гарнитуры.

        ![Глава 7 - Настройка двумя сценами Unity](images/AzureLabs-Lab6-59.png)

19. Рассмотрим два **GazeButton** объектов для переключения между первым и вторым видео.

## <a name="chapter-8---build-the-uwp-solution"></a>Глава 8 - выполнить сборку решения универсальной платформы Windows

Когда вы убедились, что редактор не содержит ошибок, вы будете готовы сборки.

Для сборки:

1.  Сохранить текущую сцену, щелкнув **файл > Сохранить**.

2.  Проверьте поле, называемое **Unity C\# проекты** (это важно, так как он позволит вам изменить классы, после завершения сборки).

3.  Перейдите к **файл > Параметры сборки**, щелкните **построения**.

4.  Вам будет предложено выбрать папку, где вы хотите buildthe решения.

5.  Создание **ПОСТРОЕНИЯ** папку и в этой папке создайте другую папку с соответствующим именем, по своему усмотрению.

6.  Щелкните новую папку и нажмите кнопку **Выбор папки**, таким образом, для выбора этой папки, чтобы начать построение в этом расположении.

    ![Глава 8 — Построить решение UWP](images/AzureLabs-Lab6-60.png)
    ![главе 8 — построить решение универсальной платформы Windows](images/AzureLabs-Lab6-61.png)

7.  Один раз Unity завершил построение (может занять некоторое время), он будет открыт **проводнике** окно в папке построения.

## <a name="chapter-9---deploy-on-local-machine"></a>Глава 9 — развертывание на локальном компьютере

После завершения построения **проводнике** окно будет отображаться в папке построения. Откройте папку с именем и созданная для, а затем дважды щелкните файл решения (SLN) в этой папке, чтобы открыть решение в Visual Studio 2017.

Единственное, что осталось сделать, — это развертывание приложения в компьютер (или *локальный компьютер*).

Для развертывания на локальном компьютере:

1.  В **Visual Studio 2017**, откройте файл решения, который был только что создан.

2.  В **платформа решения**выберите **x86, локальный компьютер**.

3.  В **конфигурации решения** выберите **Отладка**.

    ![Глава 9 — Развертывание на локальном компьютере](images/AzureLabs-Lab6-62.png)

4.  Теперь необходимо будет восстановить все пакеты в решение. Щелкните правой кнопкой мыши ваш **решение**и нажмите кнопку **восстановить пакеты NuGet для решения...**

    > [!NOTE] 
    > Это делается, так как пакеты, которые созданы Unity должны быть предназначены для работы со ссылками на локальных компьютерах.

5.  Перейдите к **меню "сборка"** и щелкнуть **развернуть решение** для загрузки неопубликованных приложений на компьютер. Visual Studio создаст сначала и затем развернуть приложение.

6.  Приложения появятся в списке установленных приложений, Готово к запуску.

    ![Глава 9 — Развертывание на локальном компьютере](images/AzureLabs-Lab6-63.png)

Когда вы запустите приложение смешанной реальности, вам будет вам быть в пределах **InsideOutSphere** модели, которые использовались в приложении. Это сфера будет где потоковую передачу видео, благодаря представлению 360 градусов, входящее видео (который был расположенным для такого рода перспективы). Не удивляйтесь, если видео занимает несколько секунд для загрузки, приложение регулируется доступные скорости подключения к Интернету, мере видео для выборки, а затем загружаться, поэтому для потоковой передачи в приложение.
Когда будете готовы, изменить сцен и открыть второй видео, gazing в красный шар! Затем вы можете вернуться назад, используя голубой куб в сцене второй!

## <a name="your-finished-azure-media-service-application"></a>Готового приложения служб мультимедиа Azure
 
Поздравляем, вы создали приложение смешанной реальности, которое использует службы мультимедиа Azure для потоковой передачи видео 360.

![Результат лаборатории](images/AzureLabs-Lab6-00.png)

![Результат лаборатории](images/AzureLabs-Lab6-01.png)

## <a name="bonus-exercises"></a>Упражнения премии

**Упражнение 1**

Это вполне возможно, только изменение видео в этом руководстве с помощью одной сценой. Поэкспериментировать с приложением и сделать его одной сценой! Возможно даже добавьте другого видео, в набор.

**Упражнение 2**

Поэкспериментируйте с Azure и Unity и пытается реализовать возможность для приложения, чтобы автоматически выбрать видео с размером другой файл, в зависимости от надежности подключение к Интернету.


