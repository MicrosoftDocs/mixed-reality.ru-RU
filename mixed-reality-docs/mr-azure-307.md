---
title: Г-н и Azure 307 - машинного обучения
description: Выполните этот курс, чтобы узнать, как реализовать приложение смешанной реальности студии машинного обучения Azure.
author: drneil
ms.author: jemccull
ms.date: 07/04/2018
ms.topic: article
keywords: Azure, смешанной реальности, academy, unity, руководства, api, машинное обучение, ml, студия машинного обучения, hololens, насыщенные, виртуальной реальности
ms.openlocfilehash: 89d9758dedb6a2389644dda887bfadf5b28f6dd2
ms.sourcegitcommit: 06ac2200d10b50fb5bcc413ce2a839e0ab6d6ed1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/09/2019
ms.locfileid: "67694545"
---
>[!NOTE]
>Учебники Academy реальности Mixed были разработаны с HoloLens (1-го поколения) и смешанной реальности Иммерсивную в виду.  Таким образом мы думаем, что это важно, чтобы эти учебники на месте для разработчиков, которые по-прежнему необходимы сведения при разработке приложений для этих устройств.  Эти руководства будут **_не_** дополняться последние наборы инструментов или взаимодействия, используемых для HoloLens 2.  Они будут сохранены, чтобы продолжить работу на поддерживаемых устройствах. Будет существовать новую серию учебников, которые будут опубликованы в будущем, демонстрируют способ разработки для HoloLens 2.  Это уведомление будет обновляться со ссылкой на эти руководства, когда они учитываются.

<br>

# <a name="mr-and-azure-307-machine-learning"></a>Г-н и Azure 307: Машинное обучение

![конечный продукт-запуск](images/AzureLabs-Lab7-0.png)

В рамках этого курса вы узнаете, как добавить возможности машинного обучения (ML) приложение смешанной реальности, с помощью студии машинного обучения Azure.

*Студия машинного обучения Azure* — это служба Майкрософт, которая предоставляет разработчикам множество алгоритмов машинного обучения, которые могут помочь с входных данных, выходных данных, подготовки и визуализации. Из этих компонентов то существует возможность разработки эксперимента прогнозной аналитики, выполнить на ней итерацию и использовать ее для обучения модели. После обучения, можно сделать модель operational в облаке Azure, таким образом, чтобы его можно затем оценки новых данных. Дополнительные сведения см. в статье [странице студии машинного обучения Azure](https://azure.microsoft.com/en-au/services/machine-learning-studio/).

Оформили этот курс, вы получите приложение иммерсивных гарнитуры смешанной реальности и будет узнали, как выполнить следующие:

1.  Создать таблицу с данными продаж для *студии машинного обучения Azure* портала и проектирования алгоритм для прогнозирования будущих продаж популярных элементов.
2.  Создание **проекта Unity**, который может получать и интерпретировать данные прогноза из службы машинного Обучения.
3.  Отобразить данные прогнозирование визуально в **проекта Unity**, до предоставления самыми популярными материалами продаж на полке.

В приложении зависит от пользователя о том, как интегрировать результаты проектированию. Этот курс призван научить позволяют интегрировать службу Azure с проектом Unity. Это задание может использовать знание, что вы получите из этого курса можно улучшить приложение смешанной реальности.

Этот курс — это автономное руководство, которые не предусматривают любых других смешанной реальности лабораторий, напрямую.

## <a name="device-support"></a>Поддержка устройств

<table>
<tr>
<th>Курс</th><th style="width:150px"> <a href="hololens-hardware-details.md">HoloLens</a></th><th style="width:150px"> <a href="immersive-headset-hardware-details.md">Иммерсивные гарнитуры</a></th>
</tr><tr>
<td> Г-н и Azure 307: Машинное обучение</td><td style="text-align: center;"> ✔️</td><td style="text-align: center;"> ✔️</td>
</tr>
</table>

> [!NOTE]
> Хотя этот курс основное внимание уделяется Windows Mixed Reality иммерсивную (VR), можно также применить полученные знания в этом курсе для Microsoft HoloLens. При выполнении, а также курс, вы увидите заметки обо всех изменениях, может потребоваться использовать для поддержки HoloLens. При использовании HoloLens, вы можете заметить некоторые echo во время записи голоса.

## <a name="prerequisites"></a>предварительные требования

> [!NOTE]
> Этот учебник предназначен для разработчиков, имеющих минимальный опыт с помощью Unity и C#. Также имейте в виду, что предварительные требования и инструкции в этом документе представляют новые были протестированы и проверены на момент написания статьи (мая 2018 г.). Вы можете свободно использовать последнюю программное обеспечение, как указано в [установить средства статье](install-the-tools.md), хотя следует не полагать, что информация в этом курсе будет точным соответствием что можно найти в новой версии по сравнению приведенных ниже .

Рекомендуется следующее оборудование и программное обеспечение для этого курса:

- На Компьютере, разработки [совместимы с Windows Mixed Reality](https://support.microsoft.com/help/4039260/windows-10-mixed-reality-pc-hardware-guidelines) для иммерсивных разработки Гарнитура (VR)
- [Windows 10 Fall Creators Update (или более поздней версии) с включенным режимом разработчика](install-the-tools.md#installation-checklist)
- [Последний пакет SDK Windows 10](install-the-tools.md#installation-checklist)
- [Unity 2017.4](install-the-tools.md#installation-checklist)
- [Visual Studio 2017](install-the-tools.md#installation-checklist)
- Объект [иммерсивных (VR) гарнитуры смешанной реальности Windows](immersive-headset-hardware-details.md) или [Microsoft HoloLens](hololens-hardware-details.md) с включенным режимом разработчика
- Доступ к Интернету для настройки Azure и получения данных машинного Обучения

## <a name="before-you-start"></a>Прежде чем начать

Чтобы избежать возникновения проблем сборки этого проекта, настоятельно рекомендуется создать проект, упомянутые в этом руководстве в корень или рядом с корневой папки (пути к папкам long может привести к проблемам во время сборки). 

## <a name="chapter-1---azure-storage-account-setup"></a>Глава 1 - установки учетная запись хранения Azure

Чтобы использовать Azure Translator API, необходимо настроить экземпляр службы, чтобы сделать доступными для приложения.
1.  Войдите в [портала Azure](https://portal.azure.com).

    > [!NOTE]
    > Если у вас еще нет учетной записи Azure, необходимо будет создать его. Если вы следуете этим руководством, аудитории или лаборатории ситуации, попросите преподавателем или из прокторов для сведения о настройке новой учетной записи.

2.  После входа в систему щелкните **учетные записи хранения** в меню слева.

    ![Настройка учетной записи хранения Azure](images/AzureLabs-Lab7-1.png)

    > [!NOTE]
    > Слово **New** может были заменены **создать ресурс**, в новых порталов.

3.  На **учетные записи хранения** , щелкните на **добавить**.

    ![Настройка учетной записи хранения Azure](images/AzureLabs-Lab7-2.png)

4.  В **создать учетную запись хранения** панели:

    1.  Вставить **имя** для вашей учетной записи, помните, это поле принимает только цифры и строчные буквы.
    2.  Для **модели развертывания,** выберите **Resource manager**.
    3.  Для **тип учетной записи**выберите **хранилища (общего назначения версии 1)** .
    4.  Для **производительности**выберите **стандартный**.
    5.  Для **репликации** выберите **Read-access геоизбыточного хранилища (RA-GRS)** .
    6.  Оставьте **требуется безопасное перемещение** как **отключено**.
    7.  Выберите **подписки**.
    4. Выберите **группы ресурсов** или создайте новую. Группа ресурсов предоставляет способ отслеживания, контроля доступа, Подготовка и управление выставлением счетов для набора средств Azure. Рекомендуется хранить все службы Azure, связанные с один проект (например, такие как многому) в разделе общей группы ресурсов).

        > Если вы хотите получить дополнительные сведения о группах ресурсов Azure, пожалуйста, [откройте статью группы ресурсов](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-portal).
    
    5.  Определить **расположение** для группы ресурсов (Если вы создаете новую группу ресурсов). Расположение оптимально подойдет в регионе, в котором приложение будет работать. Некоторые ресурсы Azure доступны только в определенных регионах.

5.  Также необходимо будет подтвердить, что мы рассмотрели, положения и условия, применяемые к этой службе.

    ![Настройка учетной записи хранения Azure](images/AzureLabs-Lab7-3.png)

6.  Когда вы перейдете на **создать**, вы получите ожидания службы должен быть создан, это может занять около минуты.

7.  Уведомление будет отображаться на портале, после создания экземпляра службы.

    ![Настройка учетной записи хранения Azure](images/AzureLabs-Lab7-4.png)

## <a name="chapter-2---the-azure-machine-learning-studio"></a>Глава 2 - студии машинного обучения Azure

Чтобы использовать *машинного обучения Azure*, необходимо настроить экземпляр службы машинного обучения, чтобы сделать доступными для приложения.

1.  На портале Azure щелкните **New** в левом верхнем углу, а поиск **рабочая область студии машинного обучения**, нажмите клавишу **ввод**.

    ![Студия машинного обучения Azure](images/AzureLabs-Lab7-5.png)

2.  Новая страница будет предоставить описание **рабочая область студии машинного обучения** службы. В нижней левой части этого запроса, нажмите кнопку **создать** кнопку, чтобы создать ассоциацию с этой службой.

3.  Когда вы перейдете на **создать**, будет отображаться панель, где необходимо предоставить некоторые сведения о новой **службы студии машинного обучения**:

    1.  Вставить нужный **имя рабочей области** для данного экземпляра службы.

    2.  Выберите **подписки**.

    3. Выберите **группы ресурсов** или создайте новую. Группа ресурсов предоставляет способ отслеживания, контроля доступа, Подготовка и управление выставлением счетов для набора средств Azure. Рекомендуется хранить все службы Azure, связанные с один проект (например, такие как многому) в разделе общей группы ресурсов). 

        > Если вы хотите получить дополнительные сведения о группах ресурсов Azure, пожалуйста, [откройте статью группы ресурсов](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-portal).

    4.  Определить **расположение** для группы ресурсов (Если вы создаете новую группу ресурсов). Расположение оптимально подойдет в регионе, в котором приложение будет работать. Некоторые ресурсы Azure доступны только в определенных регионах. Следует использовать ту же группу ресурсов, которую вы использовали для создания хранилища Azure в предыдущей главе.

    5.  Для **учетной записи хранения** щелкните **использовать существующий**, затем щелкните раскрывающееся меню и щелкните **учетной записи хранения** созданный в предыдущей главе.

    6.  Выберите соответствующий **ценовой категории рабочей области** автоматически, в раскрывающемся меню.

    7.  В рамках **план веб-службы** щелкните **создать** **новых,** в текстовом поле введите ее имя.

    8.  Из **ценовой план веб-службы** выберите Ценовая категория по своему усмотрению. Разработки и тестирования уровень **DEVTEST стандартный** должны быть доступны вам бесплатно.

    9.  Также необходимо будет подтвердить, что мы рассмотрели, положения и условия, применяемые к этой службе.

    10. Нажмите кнопку **Создать**.

        ![Студия машинного обучения Azure](images/AzureLabs-Lab7-6.png)

4.  Когда вы перейдете на **создать**, вы получите ожидания службы должен быть создан, это может занять около минуты.

5.  Уведомление будет отображаться на портале, после создания экземпляра службы.

    ![Студия машинного обучения Azure](images/AzureLabs-Lab7-7.png)

6.  Щелкните уведомление, чтобы изучить ваш новый экземпляр службы.

    ![Студия машинного обучения Azure](images/AzureLabs-Lab7-8.png)

7.  Нажмите кнопку **перейти к ресурсу** кнопки в уведомлении для просмотра в новом экземпляре службы.

8.  На странице отображается, в разделе **Дополнительные ссылки** щелкните **запуска студии машинного обучения**, который будет направлять в браузере **студии машинного обучения** портал.

    ![Студия машинного обучения Azure](images/AzureLabs-Lab7-9.png)

9.  Используйте **Sign In** кнопки в правом верхнем углу или в центре, чтобы войти в студию машинного обучения.

    ![Студия машинного обучения Azure](images/AzureLabs-Lab7-10.png)


## <a name="chapter-3---the-machine-learning-studio-dataset-setup"></a>Глава 3 - студии машинного обучения: Настройка набора данных

Одним из способов работы алгоритмов машинного обучения по анализа существующих данных, а затем попытаться спрогнозировать будущие результаты на основе существующего набора данных. Это обычно означает, что у вас есть, тем лучше алгоритм будет в прогнозировании будущих результатов более существующих данных.

Образец таблицы вам предоставляется, этот курс вызывается [ProductsTableCSV и может быть скачан здесь](https://github.com/Microsoft/HolographicAcademy/raw/Azure-MixedReality-Labs/Azure%20Mixed%20Reality%20Labs/MR%20and%20Azure%20307%20-%20Machine%20learning/MR%20and%20Azure%20307%20-%20Machine%20learning.zip).

> [!IMPORTANT]
> Выше ZIP-файл содержит оба **ProductsTableCSV** и **.unitypackage**, которые потребуются в [Глава 6](#chapter-6---importing-the-mlproducts-unity-package). Этот пакет также предоставляется в рамках соответствующей главы, хотя отдельные CSV-файл.

Этот пример набора данных содержит запись популярных объектов на каждый час каждый день 2017 года.
        
![Студия машинного обучения: Настройка набора данных](images/AzureLabs-Lab7-11.png)

Например, на 1 день 2017 г., в 13: 00 (час 13), центр ознакомительного программного обеспечения элемент был соль и Перец.

Этот пример таблицы содержит 9998 записи.

1.  Вернитесь к **студии машинного обучения** портала, и добавить эту таблицу как **набора данных** для вашей машинного Обучения. Это можно сделать, щелкнув **+ создать** кнопку в левом нижнем углу экрана.

    ![Студия машинного обучения: Настройка набора данных](images/AzureLabs-Lab7-12.png)

2.  Раздел будет снизу и в наличии панели навигации слева. Нажмите кнопку **набора данных**, а затем в правой части, **из локального файла**.

    ![Студия машинного обучения: Настройка набора данных](images/AzureLabs-Lab7-13.png)

3.  Передать новый **набора данных** , сделав следующее:

    1. Будет открыто окно отправки, где вы можете **Обзор** жестком диске для нового набора данных.

        ![Студия машинного обучения: Настройка набора данных](images/AzureLabs-Lab7-14.png)

    2.  После выбора и обратно в окне передачи, оставьте флажок снятом.

    3.  В текстовом поле ниже, введите **ProductsTableCSV.csv** как имя для набора данных (хотя автоматически добавляются).

    4.  С помощью раскрывающееся меню для **тип**выберите **универсальный CSV-файл с заголовком (CSV)** .

    5.  Нажмите клавишу деления в правом нижнем углу окна передачи и **набора данных** будут отправлены.

## <a name="chapter-4---the-machine-learning-studio-the-experiment"></a>Глава 4 – студии машинного обучения: Эксперимент

Перед созданием машинного обучения системы, необходимо будет эксперимент, проверяемый на теории о своих данных. С результатами вы будете знать, если вам нужно больше данных, или в том случае, если нет никакой корреляции между данными и возможный результат.

Чтобы приступить к созданию эксперимента:

1.  Снова щелкните **+ создать** кнопку в левом нижнем углу страницы, а затем **эксперимента** > **пустой эксперимент**.

    ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-15.png)

2.  Новая страница будет отображаться с пустой эксперимент:

3.  На панели слева разверните **сохраненные наборы данных** > **Мои наборы данных** и перетащите **ProductsTableCSV** в **эксперимента**.

    ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-16.png)

4.  На панели слева разверните **преобразования данных** > **выборка и разбиение**. Затем перетащите **разбиение данных** элемент в **эксперимента**. Элемент разделения данных будет разделить набор данных на две части. Одной из частей будет использоваться для обучения алгоритма машинного обучения. Вторая часть будет использоваться для оценки точности алгоритма создан.

    ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-17.png)

5.  На панели справа (во время разбиения данных выбран элемент на холсте) изменить **доля строк в первый выходной набор данных** для **0,7**. Это будет разбить данные на две части, первая часть будет 70% данных, а вторая часть будет оставшиеся 30%. Чтобы убедиться, что данные разбиваются случайным образом, убедитесь, что **случайного разбиения** снимайте флажок.

    ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-18.png)

6.  Перетащите подключение из основание системы счисления **ProductsTableCSV** элемента на холсте вверху элемента разделения данных. Это будет подключить элементы и отправлять **ProductsTableCSV** выходные данные набора данных (данные) для разделения входных данных.  

    ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-19.png)

7.  В **экспериментов** на левой панели, разверните узел **машинного обучения** > **Train**. Перетащите **Обучение модели** элемент out на холст эксперимента. Холст должен выглядеть так же, как ниже.

    ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-20.png)

8.  Из ***нижнем левом углу*** из **разбиение данных** элементов перетащите соединение **вверху справа** из **Обучение модели** элемента. Первого разбиения 70% из набора данных будет использоваться Обучение модели для обучения алгоритму.

    ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-21.png)

9.  Выберите **Обучение модели** элемент на холсте, а также на **свойства** панели (в правой части окна браузера) выберите **запустить средство выбора столбцов** кнопки.

10. В текстовом поле введите **продукта** и нажмите клавишу **ввод**, *продукта* будет установлен в качестве столбца для обучения прогнозов. После этого щелкните **делений** в нижнем правом углу, чтобы закрыть диалоговое окно выбора.

    ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-22.png)

11. Вы собираетесь обучения **Мультиклассовая логистическая Регрессия** алгоритм для прогнозирования наиболее популярное **продукта** зависимости от часа дня и даты. Это выходит за рамки этого документа, чтобы подробно описывается различных алгоритмов, предоставляемых студией машинного обучения Azure, однако вы подробнее можно узнать из [машины обучения Памятка по алгоритмам](https://docs.microsoft.com/azure/machine-learning/studio/algorithm-cheat-sheet)

12. Из панели элементов эксперимента в левой части разверните **машинного обучения** > **Initialize Model** > **классификации**и перетащите  **Мультиклассовая логистическая Регрессия** элементов на холст эксперимента.

13. Соедините выход, в нижней части **Мультиклассовая логистическая Регрессия**, на верхний левый вход **Обучение модели** элемента.

    ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-23.png)

14. В списке элементов эксперимента на панели слева разверните **машинного обучения** > **Оценка**и перетащите **Score Model** элементов на холст.

15. Соедините выход, в нижней части **Обучение модели**, на верхний левый вход **оценка модели**.

16. Соедините выход из нижнего правого **разбиение данных**, на верхний правый вход **Score Model** элемента.

    ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-24.png)

17. В списке **эксперимента** элементы на панели слева разверните **машинного обучения** > **Evaluate**и перетащите **Evaluate Model** элементов на холст.

18. Соедините выход из **Score Model** на верхний левый вход **Evaluate Model**.

    ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-25.png)

19. Вы создали свой первый эксперимент обучения машины. Теперь можно сохранить и запустить эксперимент. В меню в нижней части страницы щелкните **Сохранить** кнопку, чтобы сохранить свой эксперимент и нажмите кнопку **запуска** запуск эксперимента.

    ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-26.png)

20. Вы увидите **состояние** в верхней правой части холста эксперимента. Подождите несколько секунд для эксперимента завершить.

    > Если у вас есть набор данных больших (реальном мире) вполне вероятно, что эксперимента может занять часов для выполнения.

    ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-27.png)

21. Щелкните правой кнопкой мыши **Evaluate Model** элемент на холсте и из контекстного меню при наведении указателя мыши мыши над **результаты оценки**, а затем выберите **визуализировать**.

    ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-28.png)

22. Результаты оценки отображаются отображение прогнозируемых выходных данных и фактические результаты. При этом используется 30% исходного набора данных, который был ранее, разделение для оценки модели. Вы увидите, что результаты не отлично, в идеале вам будет иметь наибольший номер в каждой строке размещения выделенный элемент в столбцах.

    ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-29.png)

23. Закрыть **результаты**.

24. В использовании обученной модели машинного обучения, необходимо предоставлять его как **веб-службы**. Чтобы сделать это, щелкните **настроить веб-службу** меню в меню в нижней части страницы и щелкните на **прогнозной веб-службы**.

    ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-30.png)

25. Будет создана новая вкладка, и обучение модели объединяются для создания новой веб-службы. 

26. В меню в нижней части страницы щелкните **Сохранить**, затем нажмите кнопку **запуска**. Вы увидите состояние обновления в правом верхнем углу холста эксперимента.

    ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-31.png)

27. После завершения работы, **Deploy Web Service** кнопка будет отображаться в нижней части страницы. Вы готовы к развертыванию веб-службы. Нажмите кнопку **Deploy Web Service** (классической) в меню в нижней части страницы.

    ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-32.png)

    > Ваш браузер может запросить чтобы разрешить всплывающее окно, в которой следует **Разрешить**, хотя может потребоваться нажать **Deploy Web Service** опять же, если на странице развертывание не отображается. 

28. После создания эксперимента вы будете перенаправлены к **панели мониторинга** страницы, где у вас будет вашей **ключ API** отображается. Скопируйте его в Блокнот в данный момент, он потребуется в коде очень скоро. Когда вы заметили ключ API, нажмите кнопку **запрос/ОТВЕТ** кнопку в **конечная точка по умолчанию** разделе под ключ.

    ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-33.png)

    > [!NOTE] 
    > Если щелкнуть теста на этой странице можно ввести входные данные и просмотреть выходные данные. Введите **день** и **час**. Оставьте **продукта** запись пустым. Нажмите кнопку **Подтверждение** кнопки. JSON, представляющее вероятность каждого продукта, что выбор будут показаны результаты в нижней части страницы.

29. Новый веб-страницы откроется, отображение инструкции и примеры о структуре запроса, требующегося студии машинного обучения. Копировать **URI запроса** отображаются на этой странице в вашей Блокнот.

    ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-34.png)

Теперь вы создали это система, обеспечивающие, скорее всего, для продажи продукта на основе исторических приобретения данных, соотносятся с временем дня года и машинного обучения.

Чтобы вызвать веб-службы, вам потребуется URL-адрес конечной точки службы и ключ API для службы. Щелкните **Consume** вкладки в верхней строке меню.

**Потребления** сведения будут отображаться сведения, необходимо будет вызывать веб-службы из кода. Сделайте копию **первичный ключ** и **запрос-ответ** URL-адрес. Они потребуются в следующей главе.

## <a name="chapter-5---setting-up-the-unity-project"></a>Глава 5 - Настройка проекта Unity

Настройка и проверка вашего смешанной реальности гарнитура Иммерсивных.

> [!NOTE]
>  Вы будете **не** требуются контроллеры движения курс с демороликами. Если вам нужна поддерживает настройку Иммерсивных гарнитура, нажмите кнопку [здесь](https://support.microsoft.com/en-au/help/4043101/windows-10-set-up-windows-mixed-reality).

1.  Откройте **Unity** и создайте новый проект Unity с именем **MR\_MachineLearning.** Убедитесь, что тип проекта присваивается **3D**.

2.  С помощью Unity откройте, стоит проверки по умолчанию **редактор сценариев** присваивается **Visual Studio**. Перейдите к **изменить** > **предпочтения** и затем в окне «Новый» перейдите к **внешние средства**. Изменение **внешнего редактора скриптов** для **Visual Studio 2017**. Закрыть **предпочтения** окна.

3.  Перейдите к **файл** > **параметры построения** и переключитесь на платформе, которое **универсальной платформы Windows**, щелкнув ***переключения платформы***  кнопки.

4.  Также убедитесь, что:

    1.  **Целевое устройство** присваивается **любого устройства**.

        > Microsoft HoloLens, задайте **целевое устройство** для *HoloLens*.

    2.  **Тип сборки** присваивается **D3D**.

    3.  **Пакет SDK для** присваивается **самую новую установленную**.

    4.  **Версия Visual Studio** присваивается **самую новую установленную**.

    5.  **Сборка и запуск** присваивается **локальный компьютер**.

    6.  Не беспокоиться о настройке **сцены** прямо сейчас, как они предоставляются в более поздней версии.

    7.  Остальные параметры следует оставить значение по умолчанию сейчас.

        ![Настройка проекта Unity](images/AzureLabs-Lab7-35.png)

5.  В **параметры построения** щелкните **параметры проигрывателя** кнопки, откроется панель связанных в пространстве где **инспектор** находится. 

6. В этой панели необходимо проверить некоторые настройки:

    1.  В **другие параметры** вкладке:

        1.  **Сценарии** **версии среды выполнения** должно быть **экспериментальные** (.NET 4.6 эквивалент)

        2. **Создание сценариев серверной части** должно быть ***.NET***

        3. **Уровень совместимости API** должно быть **.NET 4.6**

            ![Настройка проекта Unity](images/AzureLabs-Lab7-36.png)

    2.  В рамках **параметров публикации** в списке **возможности**, проверьте:

        - **internetClient**

            ![Настройка проекта Unity](images/AzureLabs-Lab7-37.png)

    3.  Далее панели в **XR параметры** (под **параметры публикации**), деления **поддерживается виртуальной реальности**, убедитесь, что **смешанной реальности SDK Windows**  добавляется

        ![Настройка проекта Unity](images/AzureLabs-Lab7-38.png)

    

6.  Вернитесь в **параметры построения** *Unity C#*  проектов больше не отображается серым, установите флажок рядом с это. 

7.  Закройте окно Параметры построения.

8.  Сохраните проект (**ФАЙЛ > Сохранить ПРОЕКТ**).

## <a name="chapter-6---importing-the-mlproducts-unity-package"></a>Глава 6 - Импорт пакета MLProducts Unity

Для этого курса необходимо скачать пакет средств Unity [ **Azure-MR-307.unitypackage**](https://github.com/Microsoft/HolographicAcademy/raw/Azure-MixedReality-Labs/Azure%20Mixed%20Reality%20Labs/MR%20and%20Azure%20307%20-%20Machine%20learning/307-Scene-Setup.unitypackage). Этот пакет поставляется со сцены, и объекты, предварительно созданные, вы сможете сосредоточиться на начало его все работает. **ShelfKeeper** предоставляется скрипт, но содержит только открытые переменные, для установки структуры сцены. Необходимо будет сделать все остальные разделы. 

Для импорта этого пакета:

1.  С помощью панели мониторинга Unity перед глазами, щелкните **активы** в меню в верхней части экрана, нажмите кнопку **Импорт пакета, пользовательского пакета**.

    ![Импорт пакета MLProducts Unity](images/AzureLabs-Lab7-39.png)

2.  Используйте средство выбора файлов для выбора **Azure-MR-307.unitypackage** пакета и нажмите кнопку **откройте**.

3.  Список компонентов для этого ресурса будет отображаться пользователю. Подтверждение импорта, щелкнув **импорта**.

    ![Импорт пакета MLProducts Unity](images/AzureLabs-Lab7-40.png)

4.  После его завершения импорта можно заметить, что некоторые новые папки публиковались в игру на Unity **панель проекта**. Это трехмерные модели и соответствующих материалов, которые являются частью готовых сцены, вы будете работать. В этом курсе вы напишете большая часть кода.

    ![Импорт пакета MLProducts Unity](images/AzureLabs-Lab7-41.png)

5.  В рамках **панель проекта** папке, щелкните на **сцены** папку и дважды щелкните внутри сцены (вызывается **MR_MachineLearningScene**). Сцены откроется (см. рисунок ниже). Если отсутствуют red бубны, просто щелкните **элементы** кнопку в верхней правой части **панели Game**.

    ![Импорт пакета MLProducts Unity](images/AzureLabs-Lab7-44.png)

## <a name="chapter-7---checking-the-dlls-in-unity"></a>Глава 7 - Проверка библиотек DLL в Unity

Чтобы использовать библиотеки JSON (используется для сериализации и десериализации), с пакетом, который отображался в реализована Newtonsoft DLL. Библиотека должна иметь правильные настройки, хотя следует (особенно если у вас возникают проблемы с кодом не работает). 

Для этого сделайте следующее:

-  Щелкните левой кнопкой мыши на файле Newtonsoft внутри папки подключаемых модулей и просмотрите **панели Инспектора**. Убедитесь, что **Any платформы** установлен. Перейдите к **вкладке UWP** и также обеспечивают **не обрабатывать** установлен.

    ![Импорт библиотек DLL в Unity](images/AzureLabs-Lab7-48.png)

## <a name="chapter-8---create-the-shelfkeeper-class"></a>Глава 8 - создать класс ShelfKeeper

**ShelfKeeper** класс размещает методы, определяющие пользовательского интерфейса и продуктов, порожденных в сцене.

В рамках импортированного пакета будет у пользователя имеется этот класс на то, что он не полон. Теперь пришло время для завершения этого класса:

1.  Дважды щелкните **ShelfKeeper** сценарий, в **сценарии** , откройте папку с **Visual Studio 2017**.

2.  Замените весь код, существующий в скрипте следующим кодом, которое задает дату и время и имеет метод для отображения продукта.

    ```csharp
    using UnityEngine;

    public class ShelfKeeper : MonoBehaviour
    {
        /// <summary>
        /// Provides this class Singleton-like behavior
        /// </summary>
        public static ShelfKeeper instance;

        /// <summary>
        /// Unity Inspector accessible Reference to the Text Mesh object needed for data
        /// </summary>
        public TextMesh dateText;

        /// <summary>
        /// Unity Inspector accessible Reference to the Text Mesh object needed for time
        /// </summary>
        public TextMesh timeText;

        /// <summary>
        /// Provides references to the spawn locations for the products prefabs
        /// </summary>
        public Transform[] spawnPoint;

        private void Awake()
        {
            instance = this;
        }

        /// <summary>
        /// Set the text of the date in the scene
        /// </summary>
        public void SetDate(string day, string month)
        {
            dateText.text = day + " " + month;
        }

        /// <summary>
        /// Set the text of the time in the scene
        /// </summary>
        public void SetTime(string hour)
        {
            timeText.text = hour + ":00";
        }

        /// <summary>
        /// Spawn a product on the shelf by providing the name and selling grade
        /// </summary>
        /// <param name="name"></param>
        /// <param name="sellingGrade">0 being the best seller</param>
        public void SpawnProduct(string name, int sellingGrade)
        {
            Instantiate(Resources.Load(name),
                spawnPoint[sellingGrade].transform.position, spawnPoint[sellingGrade].transform.rotation);
        }
    }
    ```

3.  Не забудьте сохранить изменения в **Visual Studio** перед возвратом **Unity**.

4.  Обратно в редакторе Unity, убедитесь, что **ShelfKeeper** класс выглядит как ниже:

    ![Создание класса ShelfKeeper](images/AzureLabs-Lab7-51.png)

    > [!IMPORTANT]
    > Если скрипт не имеет целевых объектов по ссылке (т. е. *даты (текст Mesh)* ), просто перетащите соответствующие объекты из **панели иерархии**, в целевой объект поля. Ниже приведены сведения о работе, при необходимости.
    > 
    > 1.  Откройте **точки Spawn** массива в **ShelfKeeper** компонента скрипта, щелкнув левой кнопкой мыши его. Появится вызываемой подраздел **размер**, который указывает размер массива. Тип **3** в текстовое поле рядом с полем **размер** и нажмите клавишу **ввод**, и три слота будет создан под.
    > 2. В рамках **иерархии** разверните **отображения времени** объекта (с левой кнопкой мыши стрелку рядом с ним). Далее щелкните ***Main Camera*** изнутри **иерархии**, так что **инспектор** его сведениями.
    > 3. Выберите **главной камеры** в **панели иерархии**. Перетащите **даты** и **время** объектов из **панели иерархии** для **текстовой даты** и **текста во время** Слоты в **инспектор** из **Main Camera** в **ShelfKeeper** компонента.
    > 4. Перетащите **точки Spawn** из **панели иерархии** (под *полки* объект) для **3** **элемент**ссылаются на целевые объекты под **Spawn точки** массива, как показано на рисунке.
    > 
    >     ![Создание класса ShelfKeeper](images/AzureLabs-Lab7-52.png)

## <a name="chapter-9---create-the-productprediction-class"></a>Глава 9 — создать класс ProductPrediction

Далее нужно создать класс является **ProductPrediction** класса.

Этот класс отвечает за:

-   Запрос **службы машинного обучения** экземпляр, который предоставляет текущую дату и время.

-   Десериализации ответа JSON в полезных данных.

-   Интерпретации данных, получение 3 рекомендуемых продуктов.

-   Вызов **ShelfKeeper** методы для отображения данных в сцене класса.

Для создания этого класса:

1.  Перейдите к **сценарии** папку в **панель проекта**.

2.  Щелкните правой кнопкой мыши внутри папки **создать**  >   **C# сценарий**. Вызовите сценарий **ProductPrediction**.

3.  Дважды щелкните новый **ProductPrediction** скрипт, чтобы открыть его с **Visual Studio 2017**.

4.  Если **обнаружено изменение файла** диалоговое окно появится, нажмите кнопку ***перезагрузить решение**.

5.  Добавьте следующие пространства имен в начало класса ProductPrediction:

    ```csharp
    using System;
    using System.Collections.Generic;
    using UnityEngine;
    using System.Linq;
    using Newtonsoft.Json;
    using UnityEngine.Networking;
    using System.Runtime.Serialization;
    using System.Collections;
    ```

6.  Внутри **ProductPrediction** класса вставьте следующие два объекта, которые состоят из нескольких вложенных классов. Эти классы используются для сериализации и десериализации JSON для службы машинного обучения.

    ```csharp
        /// <summary>
        /// This object represents the Prediction request
        /// It host the day of the year and hour of the day
        /// The product must be left blank when serialising
        /// </summary>
        public class RootObject
        {
            public Inputs Inputs { get; set; }
        }

        public class Inputs
        {
            public Input1 input1 { get; set; }
        }

        public class Input1
        {
            public List<string> ColumnNames { get; set; }
            public List<List<string>> Values { get; set; }
        }
    ```

    ```csharp
        /// <summary>
        /// This object containing the deserialised Prediction result
        /// It host the list of the products
        /// and the likelihood of them being sold at current date and time
        /// </summary>
        public class Prediction
        {
            public Results Results { get; set; }
        }

        public class Results
        {
            public Output1 output1;
        }

        public class Output1
        {
            public string type;
            public Value value;
        }

        public class Value
        {
            public List<string> ColumnNames { get; set; }
            public List<List<string>> Values { get; set; }
        }
    ```

7.  Затем добавьте следующие переменные выше предыдущий код (таким образом, связанные с JSON, что код в нижней части сценария, кода, все остальные функции и выходом из способ):

    ```csharp
        /// <summary>
        /// The 'Primary Key' from your Machine Learning Portal
        /// </summary>
        private string authKey = "-- Insert your service authentication key here --";

        /// <summary>
        /// The 'Request-Response' Service Endpoint from your Machine Learning Portal
        /// </summary>
        private string serviceEndpoint = "-- Insert your service endpoint here --";

        /// <summary>
        /// The Hour as set in Windows
        /// </summary>
        private string thisHour;

        /// <summary>
        /// The Day, as set in Windows
        /// </summary>
        private string thisDay;

        /// <summary>
        /// The Month, as set in Windows
        /// </summary>
        private string thisMonth;

        /// <summary>
        /// The Numeric Day from current Date Conversion
        /// </summary>
        private string dayOfTheYear;

        /// <summary>
        /// Dictionary for holding the first (or default) provided prediction 
        /// from the Machine Learning Experiment
        /// </summary>    
        private Dictionary<string, string> predictionDictionary;

        /// <summary>
        /// List for holding product prediction with name and scores
        /// </summary>
        private List<KeyValuePair<string, double>> keyValueList;
    ```

    > [!IMPORTANT]
    > Убедитесь, что для вставки **первичный ключ** и **конечную точку запрос ответ**, из портале машинного обучения, в переменные здесь. Под изображениями Показать, где вам потребовалось бы ключ и конечную точку. 
    >  
    > ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-53-1.png)
    >
    > ![Студия машинного обучения: Эксперимент](images/AzureLabs-Lab7-53-2.png)

8.  Вставьте этот код в **Start()** метод. **Start()** метод вызывается при инициализации класса:

    ```csharp
        void Start()
        {
            // Call to get the current date and time as set in Windows
            GetTodayDateAndTime();

            // Call to set the HOUR in the UI
            ShelfKeeper.instance.SetTime(thisHour);

            // Call to set the DATE in the UI
            ShelfKeeper.instance.SetDate(thisDay, thisMonth);

            // Run the method to Get Predication from Azure Machine Learning
            StartCoroutine(GetPrediction(thisHour, dayOfTheYear));
        }
    ```

9.  Ниже приведен метод, который получает значение даты и времени из Windows и преобразует его в формат, который в нашем эксперименте машинного обучения можно использовать для сравнения с данными, хранящимися в таблице.

    ```csharp
        /// <summary>
        /// Get current date and hour
        /// </summary>
        private void GetTodayDateAndTime()
        {
            // Get today date and time
            DateTime todayDate = DateTime.Now;

            // Extrapolate the HOUR
            thisHour = todayDate.Hour.ToString();

            // Extrapolate the DATE
            thisDay = todayDate.Day.ToString();
            thisMonth = todayDate.ToString("MMM");

            // Extrapolate the day of the year
            dayOfTheYear = todayDate.DayOfYear.ToString();
        }
    ```

10. Вы можете **удалить** **Update()** метод, так как этот класс не будет его использовать.

11. Добавьте следующий метод, который будет взаимодействовать текущей даты и времени в конечной точке машинного обучения и получать ответ в формате JSON.

    ```csharp
        private IEnumerator GetPrediction(string timeOfDay, string dayOfYear)
        {
            // Populate the request object 
            // Using current day of the year and hour of the day
            RootObject ro = new RootObject
            {
                Inputs = new Inputs
                {
                    input1 = new Input1
                    {
                        ColumnNames = new List<string>
                        {
                            "day",
                            "hour",
                        "product"
                        },
                        Values = new List<List<string>>()
                    }
                }
            };

            List<string> l = new List<string>
            {
                dayOfYear,
                timeOfDay,
                ""
            };

            ro.Inputs.input1.Values.Add(l);

            Debug.LogFormat("Score request built");

            // Serialise the request
            string json = JsonConvert.SerializeObject(ro);

            using (UnityWebRequest www = UnityWebRequest.Post(serviceEndpoint, "POST"))
            {
                byte[] jsonToSend = new System.Text.UTF8Encoding().GetBytes(json);
                www.uploadHandler = new UploadHandlerRaw(jsonToSend);

                www.downloadHandler = new DownloadHandlerBuffer();
                www.SetRequestHeader("Authorization", "Bearer " + authKey);
                www.SetRequestHeader("Content-Type", "application/json");
                www.SetRequestHeader("Accept", "application/json");

                yield return www.SendWebRequest();
                string response = www.downloadHandler.text;

                // Deserialize the response
                DataContractSerializer serializer;
                serializer = new DataContractSerializer(typeof(string));
                DeserialiseJsonResponse(response);
            }
        }
    ```

12. Добавьте следующий метод, который отвечает за десериализацию ответ в формате JSON и обмен данными результат десериализации для **ShelfKeeper** класса. Это приведет к появлению имена из трех элементов, согласно прогнозу продавать наиболее в текущую дату и время. Вставьте приведенный ниже код в **ProductPrediction** класс, ниже предыдущего метода.

    ```csharp
        /// <summary>
        /// Deserialize the response received from the Machine Learning portal
        /// </summary>
        public void DeserialiseJsonResponse(string jsonResponse)
        {
            // Deserialize JSON
            Prediction prediction = JsonConvert.DeserializeObject<Prediction>(jsonResponse);
            predictionDictionary = new Dictionary<string, string>();

            for (int i = 0; i < prediction.Results.output1.value.ColumnNames.Count; i++)
            {
                if (prediction.Results.output1.value.Values[0][i] != null)
                {
                    predictionDictionary.Add(prediction.Results.output1.value.ColumnNames[i], prediction.Results.output1.value.Values[0][i]);
                }
            }

            keyValueList = new List<KeyValuePair<string, double>>();

            // Strip all non-results, by adding only items of interest to the scoreList
            for (int i = 0; i < predictionDictionary.Count; i++)
            {
                KeyValuePair<string, string> pair = predictionDictionary.ElementAt(i);
                if (pair.Key.StartsWith("Scored Probabilities"))
                {
                    // Parse string as double then simplify the string key so to only have the item name
                    double scorefloat = 0f;
                    double.TryParse(pair.Value, out scorefloat);
                    string simplifiedName =
                        pair.Key.Replace("\"", "").Replace("Scored Probabilities for Class", "").Trim();
                    keyValueList.Add(new KeyValuePair<string, double>(simplifiedName, scorefloat));
                }
            }

            // Sort Predictions (results will be lowest to highest)
            keyValueList.Sort((x, y) => y.Value.CompareTo(x.Value));

            // Spawn the top three items, from the keyValueList, which we have sorted
            for (int i = 0; i < 3; i++)
            {
                ShelfKeeper.instance.SpawnProduct(keyValueList[i].Key, i);
            }

            // Clear lists in case of reuse
            keyValueList.Clear();
            predictionDictionary.Clear();
        }
    ```

13. Сохранить **Visual Studio** и вернитесь к **Unity**.

14. Перетащите **ProductPrediction** класса скрипт из **сценарий** папку, на **Main Camera** объекта.

15. Сохраните сцену и проект **файл** > **сохранить/файл сцены** > **сохранить проект**.

## <a name="chapter-10---build-the-uwp-solution"></a>Глава 10 - выполнить сборку решения универсальной платформы Windows

Пришло время выполнить сборку проекта в качестве решения UWP может выполняться как отдельное приложение.

Для сборки:

1.  Сохранить текущую сцену, щелкнув **файл** > **сохранить сцены**.

2.  Перейдите к **файл** > **параметры сборки**

3.  Проверьте поле, называемое **Unity C# проекты** (это важно, так как он позволит вам изменить классы, после завершения сборки).

4.  Щелкните **Добавление открытых сцен**,

5.  Щелкните **Сборка**.

    ![Выполните сборку решения универсальной платформы Windows](images/AzureLabs-Lab7-54.png)

6.  Вам будет предложено выбрать папку, где требуется выполнить сборку решения.

7.  Создание **ПОСТРОЕНИЯ** папку и в этой папке создайте другую папку с соответствующим именем, по своему усмотрению.

8.  Щелкните новую папку и нажмите кнопку **Выбор папки**, чтобы начать построение в этом расположении.

    ![Выполните сборку решения универсальной платформы Windows](images/AzureLabs-Lab7-55.png)

    ![Выполните сборку решения универсальной платформы Windows](images/AzureLabs-Lab7-56.png)

9.  Один раз Unity завершил построение (может занять некоторое время), он будет открыт **проводнике** окне в местоположении, построения (проверьте панели задач, так как он может не всегда отображаются над windows, но уведомит вас о Добавление нового окно).

## <a name="chapter-11---deploy-your-application"></a>Глава 11 - развертывания приложения

Для развертывания приложения:

1.  Перейдите к новой сборки Unity ( **приложения** папки) и откройте файл решения с **Visual Studio**.

2.  Откройте Visual Studio вам потребуется восстановить пакеты NuGet, который можно сделать с помощью щелкнув MachineLearningLab_Build решения, в обозревателе решений (находится справа от Visual Studio) щелкните правой кнопкой мыши и выбрав восстановить пакеты NuGet.

    ![Добавьте пакеты NuGet](images/AzureLabs-Lab7-57.png)

3.  В списке выберите конфигурацию решения **Отладка**.

4.  В платформу решения, выберите **x86**, **локальный компьютер**. 

    > Для Microsoft HoloLens, может быть проще устанавливать равным *удаленный компьютер*, таким образом, не связанном устройстве на компьютер. Однако необходимо будет выполнить следующее:
    > - Знать **IP-адрес** из HoloLens, которую можно найти в *параметры > сеть и Интернет > Wi-Fi > Дополнительно*; IPv4 — это адрес, следует использовать. 
    > - Убедитесь, **режим разработчика** — **на**; найдено в *параметры > обновление и безопасность > для разработчиков*.

    ![Добавьте пакеты NuGet](images/AzureLabs-Lab7-58.png)

5.  Перейдите к **меню "сборка"** и щелкнуть **развернуть решение** для загрузки неопубликованных приложений на вашем ПК.

6.  Приложения появятся в списке установленных приложений, Готово к запуску.

При запуске приложения смешанной реальности, вы увидите bench, которая была создана в сцене Unity, и от инициализации, будут выбираться данные, которые можно настроить в Azure. Данные, которые будут десериализованы в вашем приложении, и три лучших результатов для текущей датой и временем будет предоставляться визуально три модели на bench.


## <a name="your-finished-machine-learning-application"></a>Готового приложения машинного обучения
 
Поздравляем, вы создали приложение смешанной реальности, которое использует машинное обучение Azure для прогнозирования данных и их отображения на сцены.

![Добавьте пакеты NuGet](images/AzureLabs-Lab7-0.png)

## <a name="exercise"></a>Упражнение

**Упражнение 1**

Поэкспериментируйте с порядком сортировки, приложения и имеют три нижних прогнозы отображаются на полки, как эти данные потенциально полезным также.

**Упражнение 2**

С помощью **таблицы Azure** Заполните новую таблицу с информацией о погоде и создайте новый эксперимент, используя данные.
