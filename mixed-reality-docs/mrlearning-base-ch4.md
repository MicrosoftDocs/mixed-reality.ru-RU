---
title: Основной модуль обучения работе со смешанной реальностью. Взаимодействие с трехмерным объектом
description: В рамках этого курса вы узнаете, как реализовать функцию распознавания лиц Azure в приложении смешанной реальности.
author: jessemcculloch
ms.author: jemccull
ms.date: 02/26/2019
ms.topic: article
ms.localizationpriority: high
keywords: mixed reality, unity, tutorial, hololens
ms.openlocfilehash: 45e772de0825fe2161f880a165d6c75c755b849e
ms.sourcegitcommit: f20beea6a539d04e1d1fc98116f7601137eebebe
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/05/2019
ms.locfileid: "65730908"
---
# <a name="mr-learning-base-module---3d-object-interaction"></a>Основной модуль обучения работе со смешанной реальностью. Взаимодействие с трехмерным объектом

В этом уроке мы рассмотрим основные концепции трехмерного содержимого и взаимодействия с пользователем. Вы узнаете, как упорядочить трехмерные объекты в составе коллекции, как использовать ограничивающие рамки для простых манипуляций, что такое ближнее и дальнее взаимодействие и как использовать отслеживание рук для жестов касания и захвата. 

## <a name="objectives"></a>Задачи

* Упорядочение трехмерного содержимого с помощью коллекции объектов сетки MRTK.
* Реализация ограничивающих рамок.
* Настройка трехмерных объектов для базовых манипуляций (перемещение, поворот и масштабирование).
* Изучение ближнего и дальнего взаимодействия.
* Освоение дополнительных жестов при работе с отслеживанием рук, таких как захват и касание.

## <a name="instructions"></a>Инструкция

### <a name="organizing-3d-objects-in-a-collection"></a>Упорядочение трехмерных объектов в коллекции

1. Щелкните иерархию правой кнопкой мыши и выберите действие Create Empty (Создать пустой). Это действие создает пустой игровой объект. Присвойте ему новое имя 3DObjectCollection. В него мы поместим все трехмерные объекты. Убедитесь, что для этой коллекции заданы значения размещения x=0, y=0 и z=0.

![Изображение "Урок 4, глава 1, шаг 1"](images/Lesson4_Chapter1_step1im.PNG)

2. Импортируйте активы BaseModule по той же процедуре, которая предложена в [уроке 1](mrlearning-base-ch1.md) для импорта пользовательских пакетов. К активам BaseModule относятся трехмерные модули и другие полезные скрипты, которые будут использоваться в этом руководстве. Пакет BaseModule для Unity можно найти здесь: <https://github.com/Microsoft/MixedRealityLearning/releases/tag/V1.1>

3. Вам нужен шаблон CoffeeCup (Чашка кофе), рядом с которым отображается голубой кубик. Не перепутайте его с шаблоном чашки кофе, рядом с которым отображаются голубой кубик и маленький белый листок (так обозначается исходная трехмерная модель, а не готовый шаблон). 

![Изображение "Урок 4, глава 1, примечание A"](images/Lesson4_chapter1_noteaim.PNG)

4. Перетащите шаблон чашки в любое удобное место игрового объекта 3DObjectCollection, который вы создали на шаге 1. Теперь эта чашка кофе станет дочерним элементом коллекции.

![Изображение "Урок 4, глава 1, шаг 4"](images/Lesson4_chapter1_step4ima.PNG)

5. Теперь мы добавим в сцену дополнительные трехмерные объекты. Ниже приведен список объектов, которые мы добавим в наш пример. По мере добавления объектов может оказаться, что они отображаются в сцене с разными размерами. Измените масштаб каждой трехмерной модели, используя функцию преобразования на панели инспектора. Рекомендуемые настройки для этого примера мы добавили в список объектов ниже. Найдите эти слова через поле поиска на панели проекта и перетащите шаблон трехмерного объекта в объекте 3DObjectCollection, как и на предыдущем шаге. Все эти коллекции шаблонов можно найти в разделе Assets>BaseModuleAssets>Base Module Prefabs
- Найдите строку "TheModule_BaseModuleIncomplete". Перетащите объект в сцену. Установите параметры размера x=0,03, y=0,03 и z=0,03. 
- Найдите строку "Octa_BaseModuleIncomplete". Перетащите объект в сцену. Установите параметры размера x=0,13, y=0,13 и z=0,13.
- Найдите строку "EarthCore_BaseModuleIncomplete". Перетащите объект в сцену. Установите параметры размера x=50,0, y=50,0 и z=50,0.
- Найдите строку "Cheese_BaseModuleIncomplete". Перетащите объект в сцену. Установите параметры размера x=0,05, y=0,05 и z=0,05.
- Найдите строку "Model_Platonic_BaseModuleIncomplete". Перетащите объект в сцену. Установите параметры размера x=0,13, y=0,13 и z=0,13.
- Найдите строку "CoffeeCup_BaseModuleIncomplete". Перетащите объект в сцену.

![Изображение "Урок 4, глава 1, шаг 5"](images/Lesson4_Chapter1_step5im.PNG)

6. Добавьте в сцену 3 куба. Щелкните правой кнопкой мыши объект 3DObjectCollection, выберите элемент 3D Object (Трехмерный объект), а затем Cube (Куб). Установите параметры размера x=0,14, y=0,14 и z=0,14. Повторите этот шаг еще 2 раза, чтобы в общей сложности получить 3 куба. Вы также можете дважды дублировать первый куб, чтобы получить нужные 3 куба. Вы также можете применить три готовых шаблона куба из раздела Assets>BaseModuleAssets>Base Module Prefabs: GreenCube_BaseModuleIncomplete, BlueCube_BaseModuleIncomplete и OrangeCube_BaseModuleIncomplete.

![Изображение "Урок 4, глава 1, шаг 6"](images/Lesson4_Chapter1_step6im.PNG)

7. Расположите коллекцию объектов в виде сетки, выполнив процедуру из [урока 2](mrlearning-base-ch2.md) с коллекцией объектов сетки MRTK. На рисунке ниже представлен пример размещения объектов в виде сетки размером 3x3.

![Изображение "Урок 4, глава 1, примечание B"](images/Lesson4_chapter1_notebim.PNG)

>Примечание. Вы можете заметить, что некоторые объекты расположены не по центру, как на приведенном выше рисунке. Это связано с тем, что шаблоны или объекты могут иметь невыровненные дочерние объекты. Вы можете изменить положения объектов и (или) дочерних объектов, чтобы сетка была равномерной.


### <a name="manipulating-3d-objects"></a>Работа с трехмерными объектами
1. Добавьте возможность манипулирования кубом. Чтобы добавить возможность манипулирования трехмерными объектами, выполните следующие действия.
-   Выберите в иерархии трехмерный объект, для которого нужно настроить манипулирование (любой из кубов в этом примере).
-   Щелкните Add Component (Добавить компонент). 
-   Выполните поиск по строке "manipulation".
-   Выберите Manipulation Handler (Обработчик манипулирования).
-   Повторите эту операцию для всех трехмерных объектов, расположенных под объектом 3DObjectCollection, кроме самого объекта 3DObjectCollection.
-   Убедитесь, что у каждого трехмерного объекта есть коллайдер или прямоугольный коллайдер (Add Component > Box Collider (Добавить компонент > Прямоугольный коллайдер)).

![Изображение "Урок 4, глава 2, шаг 1"](images/Lesson4_chapter2_step1im.PNG)

>Обработчик манипулирования — это компонент, который позволяет настроить параметры поведения объектов при манипулировании. Сюда относятся повороты, масштабирование, перемещение и ограничение перемещений по определенным осям. 

2. Настройте для одного куба ограничения, чтобы его можно было только масштабировать. Выберите один куб из объекта 3DObjectCollection. На панели инспектора, рядом с пунктом Two Handed Manipulation Type (Тип манипулирования двумя руками) щелкните стрелку раскрывающегося меню и выберите Scale (Масштабирование). Теперь пользователь может изменить только размер куба.

![Изображение "Урок 4, глава 2, шаг 2"](images/Lesson4_Chapter2_step2im.PNG)

3. Измените цвет каждого куба, чтобы их можно было различать. 
-   Перейдите на панель проекта и прокрутите ее вниз до элемента MixedRealityToolkit.SDK, затем выберите его.
-   Выберите папку Standard Assets.
-   Щелкните папку materials.
-   Перетащите новый материал на каждый из кубов. 

>Примечание. Вы можете выбрать для кубов любые цвета. В нашем примере мы собираемся использовать цвета glowingcyan (ярко-голубой), glowingorange (ярко-оранжевый) и green (зеленый). Вы можете экспериментировать с другими цветами. Чтобы придать кубу цвет, выберите нужный куб и перетащите материал в поле материала для модуля отрисовки сетки на панели инспектора для этого куба. 

![Изображение "Урок 4, глава 2, шаг 3"](images/Lesson4_Chapter2_step3im.PNG)

4. Выберите другой куб из объекта 3DObjectCollection и настройте его так, чтобы перемещение не превышало определенного расстояния от головы. Для этого щелкните раскрывающееся меню справа от элемента Constraint On Movement (Ограничение на перемещение) и выберите вариант Fix Distance From Head (Фиксированное расстояние от головы). Теперь пользователь может перемещать этот куб только в пределах поля зрения. 

![Изображение "Урок 4, глава 2, шаг 4"](images/Lesson4_chapter2_step4im.PNG)

Следующие несколько шагов нужны для того, чтобы разрешить взаимодействие и захват для трехмерных объектов. Мы применим несколько параметров манипулирования. 

5. Выберите на панели инспектора объект cheese (сыр) и щелкните Add Component (Добавить компонент). 

6. В поле поиска введите строку "Near Interaction Grabbable" (Захват при ближнем взаимодействии) и выберите найденный скрипт. Этот компонент позволяет пользователям протягивать отслеживаемые руки к объектам и хватать их. Для объектов поддерживается манипулирование на большом расстоянии, если не снят флажок Allow Far Manipulation (Разрешить дальнее манипулирование), который отмечен зеленым кружком на рисунке ниже.

![Изображение "Урок 4, глава 2, шаг 6"](images/Lesson4_Chapter2_step6im.PNG)

7. Добавьте Near Interaction Grabbable (Захват при ближнем взаимодействии) к объектам Octa, Platonic, earth core (ядро Земли), lunar module (лунный модуль) и coffee cup (чашка кофе), повторив шаги 5 и 6 для этих объектов.

8. Удалите возможность дальнего манипулирования для объекта Octa. Для этого выберите в иерархии Octa и снимите флажок Allow Far Manipulation (Разрешить дальнее манипулирование), который отмечен на рисунке зеленым кружком. Теперь пользователи смогут взаимодействовать с объектом Octa только напрямую с помощью отслеживаемых рук.

>Примечание. Полная документация по компоненту обработчика манипулирования и связанным с ним параметрам вы можете найти в [документации MRTK](https://microsoft.github.io/MixedRealityToolkit-Unity/Documentation/README_ManipulationHandler.html).

9. Убедитесь, что компонент Near Interaction Grabbable (Захват при ближнем взаимодействии) добавлен в объекты earth core (ядро Земли), lunar module (лунный модуль) и coffee cup (чашка кофе) (см. шаг 7).

10. Для лунного модуля измените значение параметра Manipulation Handler (Обработчик манипулирования) таким образом, чтобы он вращался вокруг центра объекта при ближнем и дальнем взаимодействиях, как показано на рисунке ниже.

![Изображение "Урок 4, глава 2, шаг 10"](images/Lesson4_chapter2_step10im.PNG)

11. Для объекта earth core (ядро Земли) измените поведение отпускания на nothing (нет действия). Это означает, что объект earth core (ядро Земли) будет останавливаться, когда пользователь отпускает его. 

![Изображение "Урок 4, глава 2, шаг 11"](images/Lesson4_Chapter2_step11im.PNG)

> Примечание. Этот параметр полезен, например, при создании мяча, который можно бросать. Если сохранять при отпускании скорость и угловую скорость, мяч будет продолжать движение с той же скоростью, с которой его отпустили, примерно как обычный физический мяч.

### <a name="adding-bounding-boxes"></a>Добавление ограничивающих рамок
Ограничивающие рамки делают манипулирование объектами одной рукой более простым и интуитивно понятным, как при прямом манипулировании (ближнее взаимодействие), так и при лучевом манипулировании (дальнее взаимодействие). У ограничивающих рамок есть метки-манипуляторы, которые можно захватывать для масштабирования или вращения объектов по определенным осям.
>Примечание. Чтобы добавить к объекту ограничивающую рамку, сначала нужно создать для него коллайдер (например, прямоугольный коллайдер). Мы уже делали это ранее в этом занятии. Чтобы добавить коллайдер, можно выбрать нужный объект и выбрать на панели инспектора действие Add Component > Box Collider (Добавить компонент > Прямоугольный коллайдер).
>

1. Добавьте прямоугольный коллайдер к объекту earth core (ядро Земли), если у него еще нет коллайдера (коллайдер не нужно добавлять и настраивать, если вы используете готовые шаблоны из папки Base Module Assets, как было предложено в инструкциях). В случае с объектом earth core (ядро Земли) нам нужно добавить прямоугольный коллайдер к объекту node_id30, который является дочерним для объекта earth core (ядро Земли), как показано на рисунке ниже. Выберите node_id30, затем щелкните Add Component (Добавить компонент) на панели инспектора для этого объекта и выберите box collider (прямоугольный коллайдер). 

![Изображение "Урок 4, глава 3, шаг 1"](images/Lesson4_Chapter3_step1im.PNG)

![Изображение "Урок 4, глава 3, шаг 2"](images/Lesson4_chapter3_step2im.PNG)

> Примечание. Убедитесь, что прямоугольный коллайдер визуализируется, не слишком мал и не слишком велик. Его размер должен примерно совпадать с размером того объекта, который он окружает (в нашем примере это ядро Земли). Если потребуется, измените параметры прямоугольного коллайдера, выбрав для него действие редактирования. Вы можете изменить значения x, y и z или перетащить манипуляторы ограничивающей рамки прямо в окне редактора сцен. 

![Изображение "Урок 4, глава 3, примечание"](images/Lesson4_Chapter3_noteim.PNG)

2. Добавьте ограничивающую рамку к объекту node_id30 в объекте earth core (ядро Земли). Для этого выберите объект node_id30 из коллекции 3DObjectCollection. Щелкните Add Component (Добавить компонент) и выполните поиск по строке "bounding box" (ограничивающая рамка). Убедитесь, что ограничивающая рамка, прямоугольный коллайдер и скрипты манипулирования (обработчик манипулирования и обработчик захвата при близком взаимодействии) размещены в одном игровом объекте.

3.  В разделе Behavior (Поведение) для ограничивающей рамки выберите Activate on start (Активация при запуске) из раскрывающегося списка Activation (Активация). Чтобы просмотреть дополнительные сведения о доступных вариантах активации или о других параметрах ограничивающей рамки, воспользуйтесь [документацией по ограничивающей рамке MRTK](<https://microsoft.github.io/MixedRealityToolkit-Unity/Documentation/README_BoundingBox.html>).

   

   *На следующих шагах мы изменим внешний вид ограничивающей рамки, в том числе материал по умолчанию, материал при захвате и параметры визуализации манипуляторов (по углам и сторонам). MRTK предоставляет несколько параметров для настройки ограничивающей рамки.*

4. На панели проекта выполните поиск по строке "boundingbox". Вы получите материалы, которые обозначены в списке результатов голубой сферой, как показано на рисунке ниже. 

5. Перетащите материал boundingbox в слот материала для компонента ограничивающей рамки. Перетащите также материал boundingboxgrabbed и поместите его в слот материала при захвате для компонента ограничивающей рамки.

6. Перетащите материал MRTK_BoundingBox_ScaleWidget в слот манипулятора масштабирования для компонента ограничивающей рамки. 

7. Перетащите материал MRTK_BoundingBox_RotateWidget в слот манипулятора вращения для компонента ограничивающей рамки.

![Изображение "Урок 4, глава 3, шаг 4"](images/Lesson4_chapter3_step4-7im.PNG)

8. Убедитесь, что ограничивающая рамка привязана к правильному объекту. В компоненте ограничивающей рамки есть скрипты target object (целевой объект) и bounds override (переопределение границ). Обязательно перетащите в оба этих слота объект, вокруг которого есть ограничивающая рамка. В нашем примере перетащите в оба слота объект node_id30, как показано на рисунке ниже.

> Теперь при открытии или запуске приложения объект будет окружен голубой рамкой. Мы можете перетаскивать углы этой рамки, чтобы изменять размер объекта. Если вы хотите сделать манипуляторы масштабирования и поворота более крупными и заметными, мы рекомендуем использовать стандартные параметры ограничивающей рамки (то есть пропустить шаги 4–7). 

![Изображение "Урок 4, глава 3, шаг 8"](images/Lesson4_Chapter3_step8im.PNG)

9. Чтобы вернуться в стандартный режим визуализации ограничивающей рамки, на панели инспектора для объекта ограничивающей рамки выберите шаблон манипулятора вращения и нажмите клавишу Delete. Вы увидите такую визуализацию ограничивающей рамки, как показано на рисунке ниже. Примечание. Визуализации ограничивающей рамки отображаются только в режиме воспроизведения.

![Изображение "Урок 4, глава 3, шаг 9"](images/Lesson4_chapter3_step9im.PNG)

### <a name="adding-touch-effects"></a>Добавление поддержки касания
В этом примере мы добавим звуковой эффект, который воспроизводится при касании объекта рукой.

1. Добавьте компонент источника звука в игровой объект. Выберите объект Octa в иерархии сцены. На панели инспектора нажмите кнопку Add Component (Добавить компонент), найдите и выберите элемент Audio Source (Источник звука). Позднее мы применим этот источник звука для воспроизведения звуковых эффектов. 

>Примечание. Убедитесь, что к объекту Octa присоединен прямоугольный коллайдер.

2. Добавьте компонент Near interaction touchable (Касание при ближнем взаимодействии). На панели инспектора нажмите кнопку Add Component (Добавить компонент) и найдите элемент Near interaction touchable (Касание при ближнем взаимодействии). Выберите этот компонент, чтобы добавить его. Примечание. Исправьте снимок экрана, чтобы было очевидным добавление компонента, а не только выделение прямоугольного коллайдера.

>Примечание. Ранее мы добавили компонент Near interaction grabbable (Захват при ближнем взаимодействии). Разница между этими двумя компонентами заключается в том, что взаимодействие grabbable (захват) позволяет взять объект и взаимодействовать с ним. Взаимодействие touchable (касание) позволяет только дотронуться до объекта. Вы можете использовать оба компонента совместно, чтобы сочетать эти взаимодействия.

![Изображение "Урок 4, глава 4, шаг 1"](images/Lesson4_chapter4_step1-2im.PNG)

3. Добавьте скрипт hand interaction touch (касание при взаимодействии с рукой). Обратите внимание, что этот скрипт входит в состав сцены Unity, которую вы импортировали вместе с демонстрационным пакетом, и не является частью базового пакета MRTK. Как и на предыдущем шаге, нажмите кнопку Add Component (Добавить компонент), выполните поиск компонента Hand interaction touch (Касание при взаимодействии с рукой) и добавьте его. 
   Обратите внимание на то, что для этого скрипта есть три варианта действия. 

   - On touch completed (При завершении касания). Этот вариант срабатывает, когда вы касаетесь объекта и отпускаете его. 
   - On touch started (В начале касания). Этот вариант срабатывает сразу, когда вы касаетесь объекта. 
   - On touch updated (При обновлении касания). Этот вариант активируется периодически в течение всего периода, пока рука касается объекта. 

   Для нашего примера мы выберем вариант On touch started (В начале касания).

4. Нажмите кнопку "+" для варианта On touch started (При начале касания), как показано на рисунке ниже. Перетащите объект Octa в пустое поле. 

5. В раскрывающемся списке no function (нет функции), который расположен над зеленым прямоугольником на рисунке ниже, выберите элемент AudioSource (Источник звука) > PlayOneShot. В это поле мы добавим аудиоклип, используя следующие концепции.

   - MRTK содержит небольшой список аудиоклипов. Вы можете изучить их на панели проекта. Они размещены в папке MixedRealityToolkit.SDK во вложенной папке standard assets. Там вы найдете папку audio со всеми доступными аудиоклипами.
   - Для нашего примера мы выберем аудиоклип MRTK_Gem. 
   - Чтобы добавить этот аудиоклип, перетащите его из панели проекта в слот AudioSource.PlayOneShot (отмечен зеленой рамкой в приведенном выше примере) на панели инспектора.

   Теперь, когда пользователь направит руку на объект Octa и коснется его, будет воспроизводиться аудиоклип MRTK_Gem. Также скрипт Hand Interaction Touch (Касание при взаимодействии с рукой) при касании изменяет цвет объекта. 

![Изображение "Урок 4, глава 4, шаг 3, примечание 5"](images/Lesson4_chapter4_step3-5-noteim.PNG)

### <a name="congratulations"></a>Поздравляем! 
Из этого урока вы узнали, как упорядочить трехмерные объекты в коллекции сетки и как манипулировать трехмерными объектами (масштабирование, вращение и перемещение) с помощью близкого взаимодействия (непосредственный захват отслеживаемыми руками) и дальнего взаимодействия (посредством лучей от взгляда или от руки). Вы также узнали, как разместить ограничивающие рамки вокруг трехмерных объектов и как использовать и настраивать манипуляторы на этих ограничивающих рамках. И наконец, вы научились инициировать события при касании объекта.

[Следующий урок. Расширенный ввод](mrlearning-base-ch5.md)

