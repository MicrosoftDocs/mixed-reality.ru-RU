---
title: Серия руководств по началу работы, часть 5. Взаимодействие с трехмерными объектами
description: Сведения о базовом содержимом и интерфейсах пользователя в трехмерной среде, в том числе об упорядочении трехмерных объектов и ограничивающих прямоугольниках для простого манипулирования.
author: jessemcculloch
ms.author: jemccull
ms.date: 05/02/2019
ms.topic: article
keywords: mixed reality, unity, tutorial, hololens
ms.localizationpriority: high
ms.openlocfilehash: b807ac7e51e4009d2c44d3b7c67fbdf3488ccbd9
ms.sourcegitcommit: 92ff5478a5c55b4e2c5cc2f44f1588702f4ec5d1
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/30/2020
ms.locfileid: "82604995"
---
# <a name="5-interacting-with-3d-objects"></a>5. Взаимодействие с трехмерными объектами

В этом руководстве содержатся базовые сведения о содержимом и взаимодействии с пользователем в трехмерной среде. В частности, вы узнаете, как упорядочивать трехмерные объекты в составе коллекции и использовать ограничивающие рамки для простых манипуляций, а также что такое ближнее и дальнее взаимодействие и как использовать отслеживание рук для жестов касания и захвата.

## <a name="objectives"></a>Задачи

* Создание панели трехмерных объектов, которые будут далее использоваться для других целей обучения
* Реализация ограничивающих рамок.
* Настройка трехмерных объектов для базовых манипуляций (перемещение, поворот и масштабирование).
* Изучение ближнего и дальнего взаимодействия.
* Освоение дополнительных жестов, таких как захват и касание, при работе с отслеживанием рук.

## <a name="importing-the-tutorial-assets"></a>Импорт активов для руководства

Скачайте и импортируйте пользовательский пакет Unity:

* [MRTK.HoloLens2.Unity.Tutorials.Assets.GettingStarted.2.3.0.3.unitypackage](https://github.com/microsoft/MixedRealityLearning/releases/download/getting-started-v2.3.0.3/MRTK.HoloLens2.Unity.Tutorials.Assets.GettingStarted.2.3.0.3.unitypackage)

Когда вы завершите импорт активов для руководства, окно проекта должно выглядеть примерно так:

![mrlearning-base](images/mrlearning-base/tutorial4-section1-step1-1.png)

> [!TIP]
> Чтобы вспомнить, как правильно импортировать пользовательский пакет Unity, воспользуйтесь инструкциями из статьи об [импорте Набора средств Смешанной реальности (MRTK)](mrlearning-base-ch1.md#import-the-mixed-reality-toolkit).

## <a name="decluttering-the-scene-view"></a>Устранение захламленности представления сцены

Чтобы работать со сценой было проще, отключите параметр **Scene Visibility** (Видимость сцены) для объектов **Cube** и **ButtonCollection**. Для этого щелкните значки с изображением **глаза** слева от этих объектов. Так вы спрячете объект в окне сцены, не изменяя его внутриигровой видимости.

![mrlearning-base](images/mrlearning-base/tutorial4-section2-step1-1.png)

> [!TIP]
> Дополнительные сведения об элементах управления видимостью и их применении для оптимизации представления сцены и рабочего процесса вы можете найти на <a href="https://docs.unity3d.com/Manual/SceneVisibility.html" target="_blank">этой странице</a> документации.

## <a name="organizing-3d-objects-in-a-collection"></a>Упорядочение трехмерных объектов в коллекции

В рамках этого раздела вы создадите панель трехмерных объектов, которые при работе со следующими разделами этого руководства примените для изучения разных способов взаимодействия с трехмерными объектами. В частности, вы разместите трехмерные объекты в сетке 3x3.

Точно так же, как и при [создании панели кнопок](mrlearning-base-ch2.md#creating-a-panel-of-buttons-using-mrtks-grid-object-collection), необходимо выполнить следующие основные действия:

1. Присвоение родительского объекта для трехмерных объектов.
2. Добавление и настройка компонента Grid Object Collection (Script) (Коллекция объектов сетки — скрипт).

### <a name="1-parent-the-3d-objects-to-a-parent-object"></a>1. Присвоение родительского объекта для трехмерных объектов

В окне "Иерархия" **создайте пустой объект**. Присвойте ему подходящее имя, например **3DObjectCollection**, и разместите его в подходящем расположении, например с координатами X = 0, Y = –0,2, Z = 2.

В окне Project (Проект) перейдите к разделу **Assets** (Активы) > **MRTK.Tutorials.GettingStarted** > **Prefabs** (Заготовки). Затем присвойте значение **родительского объекта** **3DObjectCollection** для следующих заготовок:

* Cheese;
* CoffeeCup;
* EarthCore;
* Octa;
* Platonic;
* TheModule.

![mrlearning-base](images/mrlearning-base/tutorial4-section3-step1-1.png)

В окне "Иерархия" **создайте три куба** в качестве дочерних объектов для объекта **3DObjectCollection**. Присвойте значению преобразования **Масштаб** координаты X = 0,15, Y = 0,15, Z = 0,15:

![mrlearning-base](images/mrlearning-base/tutorial4-section3-step1-2.png)

> [!TIP]
> Руководство по [созданию пользовательского интерфейса и настройке Набора средств для смешанной реальности](mrlearning-base-ch2.md) поможет освежить знания о выполнении описанных выше действий.

Переместите кубы таким образом, чтобы все они были хорошо видны:

![mrlearning-base](images/mrlearning-base/tutorial4-section3-step1-3.png)

В окне Project (Проект) перейдите к разделу **Assets** (Активы) > **MixedRealityToolkit.SDK** > **StandardAssets** (Стандартные активы) > **Materials** (Материалы), чтобы просмотреть включенные в состав MRTK материалы.

**Щелкните и перетащите** подходящие материалы на свойство **Материалы** для элемента 0 каждого куба в отрисовщике сетки:

* MRTK_Standard_GlowingCyan;
* MRTK_Standard_GlowingOrange;
* MRTK_Standard_Green.

![mrlearning-base](images/mrlearning-base/tutorial4-section3-step1-4.png)

### <a name="2-add-and-configure-the-grid-object-collection-script-component"></a>2. Добавление и настройка компонента Grid Object Collection (Script) (Коллекция объектов сетки — скрипт).

Добавьте компонент **Grid Object Collection (Script)** (Коллекция объектов сетки — скрипт) в объект **3DObjectCollection**. Настройте его следующим образом:

* Для параметра **Sort Type** (Тип сортировки) укажите значение **Child Order** (В порядке дочерних объектов), чтобы отсортировать дочерние объекты в порядке их размещения в родительском объекте.

Нажмите кнопку **Update Collection** (Обновить коллекцию), чтобы применить новую конфигурацию.

![mrlearning-base](images/mrlearning-base/tutorial4-section3-step2-1.png)

## <a name="manipulating-3d-objects"></a>Работа с трехмерными объектами

В рамках этого раздела вы добавите возможность манипулировать трехмерными объектами, размещенными на созданной в предыдущем разделе панели. Кроме того, для заготовок вы настроите возможность трогать и захватывать эти объекты отслеживаемыми руками. После этого вы изучите некоторые поведения манипуляции, которые можно применить к объектам.

Для получения этого результата вам нужно выполнить следующие шаги:

1. Добавьте компонент "Manipulation Handler (Script)" (Обработчик манипуляций — скрипт) ко всем объектам.
2. Добавьте компонент "Near Interaction Grabbable (Script)" (Возможность захвата при близком взаимодействии — скрипт) к объектам заготовок.
3. Настройте компонент "Manipulation Handler (Script)" (Обработчик манипуляций — скрипт).

> [!IMPORTANT]
> Чтобы **объект поддерживал манипуляции**, он должен иметь следующие компоненты:
>
> * компонент **Collider** (Коллайдер), например Box Collider;
> * компонент **Manipulation Handler (Script)** (Обработчик манипуляций — скрипт).
>
> Чтобы **объект поддерживал манипуляции** и **захват отслеживаемыми руками**, он должен иметь следующие компоненты:
>
> * компонент **Collider** (Коллайдер), например Box Collider;
> * компонент **Manipulation Handler (Script)** (Обработчик манипуляций — скрипт);
> * компонент **Near Interaction Grabbable (Script)** (Возможность захвата при близком взаимодействии — скрипт).

### <a name="1-add-the-manipulation-handler-script-component-to-all-the-objects"></a>1. Добавление компонента "Manipulation Handler (Script)" (Обработчик манипуляций — скрипт) ко всем объектам

В окне "Иерархия" выберите объект **Cheese**. Затем нажмите и удерживайте клавишу **SHIFT**. Выберите объект **Cube () 2** и добавьте ко всем выбранным объектам компонент **Manipulation Handler (Script)** (Обработчик манипуляций —скрипт):

![mrlearning-base](images/mrlearning-base/tutorial4-section4-step1-1.png)

> [!NOTE]
> Для выполнения задач этого руководства в заготовки уже добавлены коллайдеры. В примитивах Unity, например в объектах Cube, компоненты коллайдера добавляются автоматически при создании объекта. На приведенном выше изображении коллайдеры обведены зелеными контурами. Чтобы получить дополнительные сведения о коллайдерах, воспользуйтесь <a href="https://docs.unity3d.com/Manual/CollidersOverview.html" target="_blank">этим разделом</a> из документации по Unity.

### <a name="2-add-the-near-interaction-grabbable-script-component-to-the-prefab-objects"></a>2. Добавление компонента "Near Interaction Grabbable (Script)" (Возможность захвата при близком взаимодействии — скрипт) к объектам заготовок

В окне "Иерархия" выберите объект **Cheese**. Затем нажмите и удерживайте клавишу **SHIFT**, выберите объект **TheModule**. Добавьте ко всем выбранным объектам компонент **Near Interaction Grabbable (Script)** (Возможность захвата при близком взаимодействии — скрипт):

![mrlearning-base](images/mrlearning-base/tutorial4-section4-step2-1.png)

### <a name="3-configure-the-manipulation-handler-script-component"></a>3. Настройте компонент "Manipulation Handler (Script)" (Обработчик манипуляций — скрипт).

#### <a name="default-manipulation"></a>Стандартное манипулирование

Для объекта **Cube** сохраните значения всех свойств по умолчанию, чтобы проверить в работе стандартное поведение манипулирования:

![mrlearning-base](images/mrlearning-base/tutorial4-section4-step3-1.png)

> [!TIP]
> Чтобы сбросить настройки компонента на стандартные, щелкните значок "Параметры" этого компонента и выберите действие "Сбросить".

#### <a name="restrict-manipulation-to-scale-only"></a>Ограничение манипулирования только масштабированием

Для объекта **Cube (1)** измените значение параметра **Two Handed Manipulation Type** (Тип манипулирования двумя руками) на **Scale** (Масштабирование), чтобы пользователь мог изменять у этого объекта только размер:

![mrlearning-base](images/mrlearning-base/tutorial4-section4-step3-2.png)

#### <a name="constrain-the-movement-to-a-fixed-distance-from-the-user"></a>Ограничение манипулирования фиксированной дистанцией до пользователя

Для объекта **Cube (2)** измените значение параметра **Constraint On Movement** (Ограничения на перемещение) на **Fix Distance From Head** (Фиксированное расстояние до головы), чтобы при любом перемещении объекта он оставался на том же удалении от пользователя:

![mrlearning-base](images/mrlearning-base/tutorial4-section4-step3-3.png)

#### <a name="default-grabbable-manipulation"></a>Стандартное манипулирование с возможностью захвата

Для объектов **Cheese**, **CoffeCup** и **EarthCore** сохраните значения всех свойств по умолчанию, чтобы проверить в работе стандартное поведение манипулирования с возможностью захвата:

![mrlearning-base](images/mrlearning-base/tutorial4-section4-step3-4.png)

#### <a name="remove-the-ability-of-far-manipulation"></a>Удаление возможности дальнего манипулирования

Для объекта **Octa** снимите флажок **Allow Far Manipulation** (Разрешать дальнее манипулирование), чтобы пользователь мог взаимодействовать с этим объектом только при непосредственном контакте отслеживаемых рук:

![mrlearning-base](images/mrlearning-base/tutorial4-section4-step3-5.png)

#### <a name="make-an-object-rotate-around-its-center"></a>Настройка поворота объекта вокруг его центральной точки

Для объекта **Platonic** измените значение параметров **One Hand Rotation Mode Near** (Режим вращения одной рукой при ближнем взаимодействии) и **One Hand Rotation Mode Far** (Режим вращения одной рукой при дальнем взаимодействии) на **Rotate About Object Center** (Вращение вокруг центра объекта), чтобы при вращении этого объекта одной рукой он поворачивался вокруг своей центральной точки:

![mrlearning-base](images/mrlearning-base/tutorial4-section4-step3-6.png)

#### <a name="keep-movement-after-object-is-released"></a>Сохранение движения при отпускании объекта

Для объекта **TheModule** добавьте компонент **Rigidbody**, чтобы поддерживать физические законы. Затем удалите флажок **Use Gravity** (Использовать гравитацию), чтобы этот объект не подвергался земному притяжению:

![mrlearning-base](images/mrlearning-base/tutorial4-section4-step3-7.png)

Вернитесь к компоненту "Manipulation Handler (Script)" (Обработчик манипуляций — скрипт) и убедитесь, что для параметра **Release Behavior** (Поведение при отпускании) заданы значения **Keep Velocity** (Сохранять скорость) и **Keep Angular Velocity** (Сохранять угловую скорость), чтобы этот объект продолжал движение при прекращении контакта с рукой пользователя.

![mrlearning-base](images/mrlearning-base/tutorial4-section4-step3-8.png)

Дополнительные сведения о компоненте "Обработчик манипуляции" и его свойствах вы можете получить в [этом руководстве](https://microsoft.github.io/MixedRealityToolkit-Unity/Documentation/README_ManipulationHandler.html) на [портале документации по MRTK](https://microsoft.github.io/MixedRealityToolkit-Unity/README.html).

## <a name="adding-bounding-boxes"></a>Добавление ограничивающих рамок

Ограничивающие рамки делают манипулирование объектами одной рукой более простым и интуитивно понятным при ближнем и дальнем взаимодействии, предоставляя маркеры для масштабирования и вращения.

В рамках нашего примера вы добавите ограничивающую рамку к объекту EarthCore, чтобы с этим объектом можно было не только взаимодействовать путем манипулирования, которое вы настроили в предыдущем разделе, но и путем масштабирования, а также вращения с помощью маркеров ограничивающей рамки.

> [!IMPORTANT]
> Чтобы **использовать ограничивающую рамку**, объект должен иметь следующие компоненты:
>
> * компонент **Collider** (Коллайдер), например Box Collider;
> * компонент **Bounding Box (Script)** (Ограничивающая рамка — скрипт).

### <a name="1-add-the-bounding-box-script-component-to-the-earthcore-object"></a>1. Добавление компонента Bounding Box (Script) (Ограничивающая рамка — скрипт) к объекту EarthCore

В окне "Инспектор" выберите объект **EarthCore**. Добавьте к нему компонент **Bounding Box (Script)** (Ограничивающая рамка — скрипт).

![mrlearning-base](images/mrlearning-base/tutorial4-section5-step1-1.png)

> [!NOTE]
> Визуализация ограничивающей рамки создается во время выполнения. Поэтому вы не увидите ее до входа в игровой режим.

### <a name="2-visualize-and-test-the-bounding-box-using-the-in-editor-simulation"></a>2. Визуализация и тестирование ограничивающей рамки с помощью имитации в редакторе

Нажмите кнопку Play (Играть), чтобы перейти в игровой режим. Теперь нажмите и удерживайте клавишу "Пробел", чтобы отобразить руку. С помощью мыши попробуйте взаимодействовать с ограничивающей рамкой.

![mrlearning-base](images/mrlearning-base/tutorial4-section5-step2-1.png)

Дополнительные сведения о компоненте Bounding Box (Ограничивающая рамка) и его свойствах вы можете получить в [этом руководстве](https://microsoft.github.io/MixedRealityToolkit-Unity/Documentation/README_BoundingBox.html) на [портале документации по MRTK](https://microsoft.github.io/MixedRealityToolkit-Unity/README.html).

## <a name="adding-touch-effects"></a>Добавление поддержки касания

В рамках этого примера мы добавим активацию событий при касании объекта рукой. В частности, мы настроим для объекта Octa воспроизведение звукового эффекта при касании пользователем.

Для получения этого результата вам нужно выполнить следующие шаги:

1. Добавление компонента источника звука в объект.
2. Добавление компонента "Near Interaction Touchable (Script)" (Возможность касания при близком взаимодействии — скрипт) к объекту.
3. Добавление компонента "Hand Interaction Touch (Script)" (Касание при взаимодействии рукой — скрипт) к объекту.
4. Реализация события On Touch Started.
5. Тестирование взаимодействия касанием с помощью имитации в редакторе.

> [!IMPORTANT]
> Чтобы **запускать события касанием**, объект должен иметь следующие компоненты:
>
> * компонент **Collider** (Коллайдер), желательно Box Collider;
> * компонент **Near Interaction Touchable (Script)** (Возможность касания при ближнем взаимодействии — скрипт);
> * компонент **Hand Interaction Touch (Script)** (Касание при взаимодействии рукой — скрипт).

> [!NOTE]
> Компонент "Hand Interaction Touch (Script)" (Касание при взаимодействии рукой — скрипт) не входит в состав MRTK. Вы импортировали его вместе с другими активами для руководства. Изначально он входил в набор примеров для Набора средств Unity для смешанной реальности.

### <a name="1-add-an-audio-source-component-to-the-object"></a>1. Добавление компонента источника звука в объект

В окне "Иерархия" выберите объект **Octa**. Добавьте к этому объекту компонент **Audio Source** (Источник звука) и укажите для параметра **Spatial Blend** (Пространственное смешивание) значение 1, чтобы включить пространственный звук.

![mrlearning-base](images/mrlearning-base/tutorial4-section6-step1-1.png)

### <a name="2-add-the-near-interaction-touchable-script-component-to-the-object"></a>2. Добавление компонента "Near Interaction Touchable (Script)" (Возможность касания при близком взаимодействии — скрипт) к объекту

Оставляя выделенным объект **Octa**, добавьте компонент **Near Interaction Touchable (Script)** (Возможность касания при ближнем взаимодействии — скрипт). Нажмите кнопки **Fix Bounds** (Зафиксировать границы) и **Fix Center** (Зафиксировать центр) для компонента "Near Interaction Touchable (Script)" (Возможность касания при ближнем взаимодействии — скрипт), чтобы он совпадал с объектом BoxCollider.

![mrlearning-base](images/mrlearning-base/tutorial4-section6-step2-1.png)

### <a name="3-add-the-hand-interaction-touch-script-component-to-the-object"></a>3. Добавление компонента "Hand Interaction Touch (Script)" (Касание при взаимодействии рукой — скрипт) к объекту

Сохраняя выделенным объект **Octa**, добавьте компонент **Hand Interaction Touch (Script)** (Касание при взаимодействии рукой — скрипт) к объекту:

![mrlearning-base](images/mrlearning-base/tutorial4-section6-step3-1.png)

### <a name="4-implement-the-on-touch-started-event"></a>4. Реализация события On Touch Started

В компоненте **Hand Interaction Touch (Script)** (Касание при взаимодействии рукой — скрипт) щелкните маленький значок **+** , чтобы создать новое событие **On Touch Started ()** . Теперь настройте в объекте **Octa** получение события и определите **AudioSource.PlayOneShot** в качестве выполняемого действия:

![mrlearning-base](images/mrlearning-base/tutorial4-section6-step4-1.png)

Перейдите в раздел **Ресурсы** > **MixedRealityToolkit.SDK** > **StandardAssets** > **Audio**, чтобы просмотреть звуковые клипы, предоставленные в комплекте с MRTK. Затем подберите подходящий клип для поля **Звуковой клип**, например MRTK_Gem:

![mrlearning-base](images/mrlearning-base/tutorial4-section6-step4-2.png)

> [!TIP]
> В разделе об [обработке жестов и нажатий активных кнопок с помощью средства отслеживания руки](mrlearning-base-ch2.md#hand-tracking-gestures-and-interactable-buttons) вы можете освежить свои знания о реализации событий.

### <a name="5-test-the-touch-interaction-using-the-in-editor-simulation"></a>5. Тестирование взаимодействия касанием с помощью имитации в редакторе

Нажмите кнопку Play (Играть), чтобы перейти в игровой режим. Теперь нажмите и удерживайте клавишу "Пробел", чтобы отобразить руку. С помощью мыши коснитесь объекта Octa для воспроизведения звукового эффекта.

![mrlearning-base](images/mrlearning-base/tutorial4-section6-step5-1.png)

> [!NOTE]
> Как вы наблюдали при взаимодействии касанием и как видно на изображении выше, цвет объекта Octa пульсирует при касании. Этот эффект жестко закодирован в компоненте "Hand Interaction Touch (Script)" (Касание при взаимодействии рукой — скрипт) и не является следствием действий по настройке, которые вы выполняли ранее.
>
> Если вы хотите отключить этот эффект, закомментируйте строку 32 'TargetRenderer = GetComponentInChildren<Renderer>();'. В результате значение TargetRenderer всегда будет NULL и цвет объекта не изменится.

## <a name="congratulations"></a>Поздравляем!

Из этого руководства вы узнали, как упорядочить трехмерные объекты в коллекции сетки и манипулировать трехмерными объектами (масштабирование, вращение и перемещение) с помощью близкого взаимодействия (непосредственный захват отслеживаемыми руками) и дальнего взаимодействия (посредством лучей от взгляда или от руки). Вы также узнали, как разместить ограничивающие рамки вокруг трехмерных объектов, а также использовать и настраивать манипуляторы на этих ограничивающих рамках. И наконец, вы научились инициировать события при касании объекта.

[Следующий урок. 6. Изучение дополнительных входных параметров](mrlearning-base-ch5.md)
