---
title: Практический пример — создание одной далекой в смешанной реальности
description: Перед доставкой Microsoft HoloLens, мы попросили наше сообщество разработчиков, на какие приложения они хотели бы видеть опытной группой внутреннего построения нового устройства. Более 5000 идеи были общими, и после опроса Twitter 24-часовом, победителя было идею, называется «Galaxy Explorer».
author: KarimLUCCIN
ms.author: kaluccin
ms.date: 03/21/2018
ms.topic: article
keywords: Galaxy Explorer, HoloLens, Windows Mixed Reality, поделиться идеей, пример внедрения
ms.openlocfilehash: a478eaa35144a8ee0fbeaeb43cec4b9f901890ab
ms.sourcegitcommit: 384b0087899cd835a3a965f75c6f6c607c9edd1b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/12/2019
ms.locfileid: "59604833"
---
# <a name="case-study---creating-a-galaxy-in-mixed-reality"></a>Практический пример — создание одной далекой в смешанной реальности

Перед доставкой Microsoft HoloLens, мы попросили наше сообщество разработчиков, на какие приложения они хотели бы видеть опытной группой внутреннего построения нового устройства. Более 5000 идеи были общими, и после опроса Twitter 24-часовом, победителя было идею вызывается [Galaxy Explorer](galaxy-explorer.md).

Энди Zibits, art интереса к проекту и Karim Luccin, инженер по вопросам графики команды, поговорим о совместной работе между картинок и инженеров приводило к созданию точных и интерактивные представления galaxy Млечного в обозревателе Galaxy.

## <a name="the-tech"></a>Технический

[Наша группа](galaxy-explorer.md#meet-the-team) - делать копии двумя конструкторами, три разработчика, четыре исполнители, производитель и одного тестер — бы шесть недель для создания полностью функциональное приложение, которое позволит пользователям получать дополнительные сведения о vastness и прелесть нашей галактики Млечного.

Мы хотели воспользоваться всеми преимуществами возможность отобразить трехмерные объекты непосредственно в своей сфере жизни, поэтому мы решили, что необходимо для создания реалистичного выглядящие галактики где люди смогут увеличить масштаб close и увидеть отдельные звезд, каждый на собственные траекторий HoloLens .

В первую неделю разработки мы выпустили несколько целей для наших представление космоса Млечного: Ей нужно иметь глубину, перемещения и вид объемные — full звезд, которые помогают создать форму космоса.

При создании анимированных галактики, оказывали миллиардов звезд проблема, что большое число отдельных элементов, которые необходимо обновить будет слишком большой размер каждого кадра для HoloLens для анимации с использованием ЦП. Наше решение участвует сложных сочетание искусством.

## <a name="behind-the-scenes"></a>Как это делается

Чтобы разрешить пользователям просматривать отдельные звезд, что нашим первым этапом было выяснить, сколько примитивы, просмотром мог за один раз.

### <a name="rendering-particles"></a>Подготовка к просмотру примитивы

Текущий ЦП удобны для обработки последовательные задачи и до нескольких параллельных задач за один раз (в зависимости от того, сколько ядер у), но графических процессоров намного больше подходит для обработки тысяч операций параллельного. Тем не менее так как обычно они не используют ту же память, как ЦП, обмена данными между ЦП <> GPU может быстро стать узким местом. Наше решение должно было осуществлять галактики на GPU, и его пришлось полностью live в GPU.

Мы начали нагрузочные тесты с тысячами частиц точки в различных шаблонов. Это позволило нам получить космоса на HoloLens, чтобы увидеть, что выполнено, а что нет.

### <a name="creating-the-position-of-the-stars"></a>Создание положение звезды

Один из наших участников команды уже создала C# код, который создал бы звезды в их начальное положение. Звезды находятся на эллипс и их положения могут быть описаны свойством (**curveOffset**, **ellipseSize**, **повышение прав**) где **curveOffset**— это угол звезды вдоль эллипса, **ellipseSize** — это измерение эллипса вдоль X и Z и повышение правильное высоту данного типа "звезда" в пределах космоса. Таким образом, мы можем создать буфер ([Unity ComputeBuffer](http://docs.unity3d.com/ScriptReference/ComputeBuffer.html)), может инициализироваться значением каждый атрибут типа "звезда" и отправить его в GPU, где бы live для остальной части интерфейса. Чтобы нарисовать этот буфер, мы используем [Unity DrawProcedural](http://docs.unity3d.com/ScriptReference/Graphics.DrawProcedural.html) разрешающее под управлением шейдера (кода на GPU) на произвольный набор точек без необходимости фактическое сетки, который представляет космоса:

**ЦП:**




```
GraphicsDrawProcedural(MeshTopology.Points, starCount, 1);
```

**GPU:**




```
v2g vert (uint index : SV_VertexID)
{

 // _Stars is the buffer we created that contains the initial state of the system
 StarDescriptor star = _Stars[index];
 …

}
```

Мы начали с необработанных циклическая шаблоны с тысячами примитивы. Это давало доказательства, что нам нужно, мы может управлять многих частицы и запустите его со скоростью высокой производительностью, что мы не были удовлетворительными в общей форме космоса. Чтобы улучшить фигуры, попытка различные шаблоны и системы частиц с поворотом. Это были перспективных, так как число эффектов и производительности лет обеспечивает согласованность, но фигуры разбил рядом с центром и звезды были выпуска внешне чего нельзя было реалистичные. Нам требовалось вывод, что позволило бы нам управлять времени и переместить в действительности частицы циклов когда-нибудь ближе к центру космоса.

![Предпринята различные шаблоны и системы частиц, которые вращать, подобные этим.](images/galaxy-patterns-500px.png)

Предпринята различные шаблоны и системы частиц, которые вращать, подобные этим.

Наша команда была исследование, о функции галактики способом, и мы внесли системе частиц пользовательских специально для galaxy таким образом, нам удалось переместить частицы на кнопку с многоточием на основе "[теории wave плотность](https://en.wikipedia.org/wiki/Density_wave_theory),» которого theorizes, вооружений из galaxy описаны области, более высокой плотности, но постоянным корректировкам, например передряги трафика. Похоже, стабильной и сплошной, но звездочек действительно движутся входящий и исходящий руки при переходе по их соответствующих многоточие. В нашей системе частицы никогда не существует на ЦП — мы создания карточек и расположить их на GPU, поэтому вся система является просто начальное состояние + время. Она выполнялась следующим образом:

![Эволюция система частиц с помощью графического процессора](images/spiral-galaxy-arms-500px.jpg)

Эволюция система частиц с помощью графического процессора


После достаточно многоточие добавляются и устанавливаются для поворота, галактики приступила к форме «оружию», где сходятся перемещение звезды. Интервал звездочек вдоль каждого контуру передан часть случайности, и каждого типа "звезда" получил немного позиционные случайности добавлен. Она создана гораздо более естественной выглядящие распределение звезда перемещения и arm. И, наконец мы добавили возможность диска цветов в зависимости от расстояния от центра.

### <a name="creating-the-motion-of-the-stars"></a>Создание движения звезд

Для анимации общие движение типа "звезда", необходимо добавить постоянное угол для каждого кадра и получить звезд, перемещающиеся их эллипсы с постоянной скоростью Радиальный. Это основная причина использования **curveOffset**. Это неверно с технической точки зрения как звезды будет двигаться быстрее на длинный сторонах кнопку с многоточием, но общие движение посчитали хорошо.

![Звезды быстродействие на длинный дуги, медленнее по краям.](images/ellipse-movement.jpg)

Звезды быстродействие на длинный дуги, медленнее по краям.


Таким образом, каждого типа "звезда" полностью описывается (**curveOffset**, **ellipseSize**, **повышение прав**, **возраст**) где **возраст** представляет собой совокупность объектов общее время, истекшее с момента загрузки сцены.




```
float3 ComputeStarPosition(StarDescriptor star)
{

  float curveOffset = star.curveOffset + Age;
  
  // this will be coded as a “sincos” on the hardware which will compute both sides
  float x = cos(curveOffset) * star.xRadii;
  float z = sin(curveOffset) * star.zRadii;
   
  return float3(x, star.elevation, z);
  
}
```

Это позволило нам для создания десятков тысяч звезд один раз при запуске приложения, а затем мы анимированы одним набор звезд вдоль изгибов установленным. Поскольку все, что в GPU, система можно анимировать все звезды в параллельном режиме без затрат на ЦП.

![Вот, как он выглядит когда рисование белого четырехугольники.](images/drawing-white-quads-300px.jpg)

Вот, как он выглядит когда рисование белого четырехугольники.



Чтобы сделать каждой грани четырьмя камеры, мы использовали шейдер геометрии для преобразования каждого типа "звезда" положение двумерной прямоугольник на экране, который будет содержать наших типа "звезда" текстуры.

![Ромбы вместо четырехугольники.](images/drawing-white-quads-300px.jpg)

Ромбы вместо четырехугольники.


Так как мы хотели бы ограничить перекрытий (количество раз, будут обрабатываться пиксель) настолько, насколько возможно, мы (повернутый) нашей четырехугольники таким образом, чтобы они бы меньше перекрытие.

### <a name="adding-clouds"></a>Добавление облака

Существует много способов, чтобы почувствовать объемные частицами — из Рэй marching внутри тома для рисования столько частицы можно имитировать в облаке. В режиме реального времени Рэй marching будет не слишком дорого стоят их трудно автора, поэтому мы впервые опробовал создании фальшивый системы с помощью метода для лесов отрисовки в играх — с большим количеством двумерные изображения деревьев, с которыми сталкиваются камеры. При этом в игре, мы имеют текстуры деревьев, подготовке к просмотру с камеры, который вращается вокруг, сохранять эти изображения и во время выполнения для каждой карточки элемент с объявлением, выберите образ, который соответствует направление представления. Это не работает также с голограммы используются образы. Разница между глаза левой и правой глаза сделать так, что мы должны более высокое разрешение, в противном случае она просто выглядит плоской, псевдонимы, или повторяющихся.

Наши второй попытки мы пробовали, наличие столько частицы максимально. Лучшие визуальные элементы движущееся изображение достигалось при аддитивно нарисованную частицы и размыть их перед их добавлением в сцене. Типичных проблем, возникающих при таком подходе были связаны с сколько примитивы, мы изобразить за один раз и какой объем области, они рассматриваются, сохраняя при этом 60 кадров/с экрана. Размытие полученный образ для получения этого облака испытываешь, как правило, было очень дорогостоящей операцией.

![Без текстуры это, как будет выглядеть облака с прозрачностью 2%.](images/clouds-without-texture-300px.jpg)

Без текстуры это, как будет выглядеть облака с прозрачностью 2%.



Добавочные и необходимости много означает, что бы нам несколько четырехугольники друг над другом, многократно заливки та же точка. В центре космоса та же точка имеет сотни четырехугольники друг над другом, и это имело место огромные затраты при, выполняемая во весь экран.

Выполнив облаков во весь экран и попытке размытия их было бы это плохая идея, поэтому вместо этого мы решили позволяют сделать работу за нас оборудования.

### <a name="a-bit-of-context-first"></a>Бит объект контекста, сначала

При использовании текстуры в игре размера текстуры редко будет соответствовать мы будем использовать его в область, но можно использовать различные виды текстуры, фильтрацию, чтобы получить видеокарта для интерполяции цветов, мы хотим из пикселей текстуры ([Фильтрациятекстур<C3/настроек). Фильтрация интересующей нас [билинейная фильтрация](https://msdn.microsoft.com/library/windows/desktop/bb172357.aspx) которого будет вычислять значение любой точки, используя 4 ближайших.

![Оригинал, прежде чем применять фильтрацию](images/texture-1.png)

![Результат после фильтрации](images/texture-2.png)

С помощью этого свойства, мы видим, что каждый раз, когда мы пытаемся нарисуйте текстуру в области дважды в качестве большое, оно размывает результат.

Вместо передачи в полноэкранный режим и потери эти ценные миллисекунд, мы может уйти на что-то еще, мы визуализируем tiny версии экрана. Затем путем копирования этой текстуры и растягивания его с коэффициентом 2 несколько раз, мы получаем в полноэкранный режим во время Размытие содержимого в процессе.

![X3 увеличить обратно в полном разрешении.](images/galaxy-resolutions-300px.png)

X3 увеличить обратно в полном разрешении.



Это позволило нам получить часть облака с только небольшую часть исходной стоимости. Вместо добавления облаков на полным разрешением, мы только paint 1/был кратен 64 пикселов и просто растянуть текстуры обратно в полном разрешении.

![Слева с upscale от 1/8 к полным разрешением; и, с 3 увеличить с помощью степенью числа 2.](images/stars-upscaled-300px.jpg)

Слева с upscale от 1/8 к полным разрешением; и, с 3 увеличить с помощью степенью числа 2.


Обратите внимание, что пытается перейти от 1/был кратен 64 размера для полный размер за одно действие будет полностью меняет внешний вид, как графическая плата по-прежнему использовать менее 4 пикселей в нашей программе установки для затенения больше области и артефакты начать отображение.

Затем Если добавить полным разрешением звезд с уменьшить размер карточек, мы получаем полный galaxy:

![Рядом с окончательный результат galaxy рендеринге полным разрешением звезд](images/full-galaxy-500px.png)

Как только мы находились на правильном пути с фигурой, мы добавили слой облаков, будут выгружены временных точек на другие мы рисования в Photoshop и добавлены некоторые дополнительные цвета. Это приводило к галактики Млечного наших картинок и инженеры обоих посчитали хороший о и оно соответствовало наших целей и получать глубины, тома и движения — все это без налог ЦП.

![Наши окончательный Galaxy Млечного в трехмерном пространстве.](images/final-galaxy-500px.jpg)

Наши окончательный Galaxy Млечного в трехмерном пространстве.


### <a name="more-to-explore"></a>Дополнительно

Мы с открытым код приложения Galaxy обозревателя и делает ее доступной на [GitHub](https://github.com/Microsoft/GalaxyExplorer) для разработчикам.

Хотите узнать подробнее о процессе разработки для Galaxy Explorer? Извлечь все наши последние обновления проекта на [канал YouTube Microsoft HoloLens](https://www.youtube.com/playlist?list=PLZCHH_4VqpRj0Nl46J0LNRkMyBNU4knbL).

## <a name="about-the-authors"></a>Об авторах

<table style="border:0">
<tr>
<td style="border:0" width="60px"> <img alt="Picture of Karim Luccin at his desk" width="60" height="60" src="images/karim-thumb.jpg" /></td>
<td style="border:0"><b>Karim Luccin</b> — разработчик программного обеспечения и энтузиаст необычные визуальные элементы. Он был инженером графики для Galaxy Explorer.</td>
</tr>
<tr>
<td style="border:0" width="60px"> <img alt="Photo of art lead Andy Zibits" width="60" height="60" src="images/andy-avatar.png" /></td>
<td style="border:0"><b>Энди Zibits</b> является энтузиаст интереса картинок и места, в который управляемых team трехмерного моделирования для Galaxy Explorer и мучились для частицы еще больше.</td>
</tr>
</table>


## <a name="see-also"></a>См. также
* [Galaxy Explorer на сайте GitHub](https://github.com/Microsoft/GalaxyExplorer)
* [Galaxy Explorer проект обновления на сайте YouTube](https://www.youtube.com/playlist?list=PLZCHH_4VqpRj0Nl46J0LNRkMyBNU4knbL)
