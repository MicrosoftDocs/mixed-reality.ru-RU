---
title: Пространственное сопоставление в Unreal
description: Руководство по применению пространственного сопоставления в Unreal
author: sw5813
ms.author: jacksonf
ms.date: 5/5/2020
ms.topic: article
ms.localizationpriority: high
keywords: Unreal, Unreal Engine 4, UE4, HoloLens, HoloLens 2, смешанная реальность, разработка, функции, документация, руководства, голограммы, пространственное сопоставление
ms.openlocfilehash: 32f8247010745b23bf73c5161c378bc1284169ef
ms.sourcegitcommit: ba4c8c2a19bd6a9a181b2cec3cb8e0402f8cac62
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/05/2020
ms.locfileid: "82840083"
---
# <a name="spatial-mapping-in-unreal"></a>Пространственное сопоставление в Unreal

Чтобы включить пространственное сопоставление в HoloLens, установите флажок Spatial Perception (Пространственное восприятие) в разделе Project Settings (Параметры проекта) > Platform (Платформа) > HoloLens > Capabilities (Возможности) редактора Unreal.  

Чтобы применить пространственное сопоставление в игре на HoloLens, включите параметр Generate Mesh Data from Tracked Geometry (Генерировать данные сетки из отслеживаемой геометрии) в ARSessionConfig.  После этого подключаемый модуль HoloLens будет асинхронно получать данные пространственного сопоставления и выводить их в Unreal в виде MRMesh. 

![Хранилище пространственных привязок готово](images/unreal-spatialmapping-arsettings.PNG)

Чтобы отслеживать отладочную визуализацию сетки пространственных сопоставлений, установите флажок Render Mesh Data in Wireframe (Визуализировать данные сетки в каркасе) в ARSessionConfig, чтобы для каждого треугольника MRMesh отображался белый контурный каркас. 

В разделе Project Settings (Параметры проекта) > Platform (Платформа) > HoloLens > Spatial Mapping (Пространственное сопоставление) можно изменить следующие параметры, чтобы изменить поведение пространственного сопоставления в среде выполнения. 

![Параметры пространственных привязок для проекта](images/unreal-spatialmapping-projectsettings.PNG)

Max Triangles Per Cubic Meter (Максимальное число треугольников на кубический метр) изменяет плотность треугольников в сетке пространственного сопоставления.  Spatial Meshing Volume Size (Размер объема для пространственных сеток) указывает размер куба вокруг игрока, в пределах которого будут отображаться и обновляться данные пространственного сопоставления.  Если предполагается, что среда выполнения для приложения будет очень большой, в этом поле следует указать большое значение, чтобы оно лучше соответствовало реальному пространству.  И наоборот, если приложению нужны голограммы только на поверхностях рядом с пользователем, в этом поле можно указать небольшое значение.  По мере перемещения пользователя по игровому миру вместе с ним перемещается и пространство для пространственных сопоставлений. 

Чтобы использовать элемент MRMesh во время выполнения, добавьте к субъекту Blueprint (Схема) компонент AR Trackable Notify (Оповещение об отслеживаемой дополненной реальности). 

![AR Trackable Notify для пространственных привязок](images/unreal-spatialmapping-artrackablenotify.PNG)

Затем перейдите к сведениям об этом компоненте и зелеными кнопками "+" выберите события для отслеживания. 

![События пространственных привязок](images/unreal-spatialmapping-events.PNG)

В этом случае мы отслеживаем событие On Add Tracked Geometry (При добавлении отслеживаемой геометрии), чтобы контролировать допустимые сетки, соответствующие данным пространственного сопоставления, и изменять материал этих сеток: 

![Пример пространственных привязок](images/unreal-spatialmapping-example.PNG)

В C++ можно подписаться на делегат OnTrackableAdded, чтобы получать элементы ARTrackedGeometry по мере доступности.  Существуют аналогичные делегаты для событий обновления и удаления: AddOnTrackableUpdatedDelegate_Handle и AddOnTrackableRemovedDelegate_Handle. 

![Код C++ для событий пространственных привязок](images/unreal-spatialmapping-examplecode.PNG)

В файле проекта Build.cs элемент AugmentedReality должен входить в список PublicDependencyModuleNames, чтобы добавить ARBlueprintLibrary.h и MRMesh для проверки компонента MRMesh в элементе UARTrackedGeometry. 

Пространственное сопоставление — это не единственный тип данных, который предоставляется через ARTrackedGeometries, поэтому сначала мы проверяем соответствие EARObjectClassification и World, что подтверждает наличие геометрии пространственного сопоставления. 

## <a name="see-also"></a>См. также статью
* [Пространственное сопоставление](spatial-mapping.md)
