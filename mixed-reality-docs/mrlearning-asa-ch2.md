---
title: Руководства по Пространственным привязкам Azure — часть 2. Сохранение, получение и совместное использование Пространственных привязок Azure
description: В рамках этого курса вы узнаете, как реализовать функцию распознавания лиц Azure в приложении смешанной реальности.
author: jessemcculloch
ms.author: jemccull
ms.date: 02/26/2019
ms.topic: article
keywords: mixed reality, unity, tutorial, hololens
ms.localizationpriority: high
ms.openlocfilehash: 36f25229469e848a3f0612a5971cc8e9381262f5
ms.sourcegitcommit: 536fd45b48a70bbeca1454cef517ae007225e533
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 03/27/2020
ms.locfileid: "80362007"
---
# <a name="2-saving-retrieving-and-sharing-azure-spatial-anchors"></a><span data-ttu-id="c1c9d-105">2. Сохранение, получение и совместное использование Пространственных привязок Azure</span><span class="sxs-lookup"><span data-stu-id="c1c9d-105">2. Saving, retrieving, and sharing Azure Spatial Anchors</span></span>

<span data-ttu-id="c1c9d-106">В этом учебнике вы узнаете, как сохранять Пространственные привязки Azure между сеансами приложения, сохраняя идентификатор привязки в хранилище HoloLens 2.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-106">In this tutorial, you will learn how to save Azure Spatial Anchors across multiple app sessions by saving the anchor ID to the HoloLens 2's storage.</span></span> <span data-ttu-id="c1c9d-107">Вы также узнаете, как передать этот идентификатор привязки другим устройствам для согласования привязок между несколькими устройствами.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-107">You will also learn how to share this anchor ID to other devices for a multi-device anchor alignment.</span></span>

## <a name="objectives"></a><span data-ttu-id="c1c9d-108">Задачи</span><span class="sxs-lookup"><span data-stu-id="c1c9d-108">Objectives</span></span>

* <span data-ttu-id="c1c9d-109">Узнайте, как сохранять идентификаторы Пространственных привязок Azure на локальный диск HoloLens 2 и извлекать их с диска, чтобы поддерживать сохраняемость между сеансами приложения.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-109">Learn how to save and retrieve Azure Spatial Anchor IDs to and from the HoloLens 2 local disk, for persistence between app sessions</span></span>
* <span data-ttu-id="c1c9d-110">Узнайте, как несколько пользователей могут совместно использовать идентификаторы Пространственных привязок Azure в сценарии с несколькими устройствами.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-110">Learn how to share Azure Spatial Anchor IDs between users in a multi-device scenario</span></span>

## <a name="preparing-the-scene"></a><span data-ttu-id="c1c9d-111">Подготовка сцены</span><span class="sxs-lookup"><span data-stu-id="c1c9d-111">Preparing the scene</span></span>

<span data-ttu-id="c1c9d-112">В окне проекта перейдите к папке **Assets** (Активы) > **MRTK.Tutorials.AzureSpatialAnchors** > **Prefabs** (Заготовки).</span><span class="sxs-lookup"><span data-stu-id="c1c9d-112">In the Project window, navigate to **Assets** > **MRTK.Tutorials.AzureSpatialAnchors** > **Prefabs** folder.</span></span> <span data-ttu-id="c1c9d-113">Удерживая нажатой клавишу CTRL, щелкните **ButtonParent_SaveAnchorId** и **ButtonParent_ShareAnchorId**, чтобы выбрать две нужные заготовки, и перетащите их в окно Hierarchy (Иерархия), чтобы добавить в сцену:</span><span class="sxs-lookup"><span data-stu-id="c1c9d-113">While holding down the CTRL button, click on **ButtonParent_SaveAnchorId** and **ButtonParent_ShareAnchorId** to select the two prefabs, then drag them into the Hierarchy window to add them to the scene:</span></span>

![mrlearning-asa](images/mrlearning-asa/tutorial2-section1-step1-1.png)

## <a name="persist-azure-anchors-between-app-sessions---save-anchor-id-to-disk"></a><span data-ttu-id="c1c9d-115">Сохранение привязок Azure между сеансами приложения — сохранение идентификатора привязки на диск</span><span class="sxs-lookup"><span data-stu-id="c1c9d-115">Persist Azure Anchors between app sessions - Save anchor ID to disk</span></span>
<!-- TODO: Consider renaming to 'Persist Azure Anchors between app sessions' -->

<span data-ttu-id="c1c9d-116">В этом разделе вы узнаете, как сохранять идентификаторы Пространственных привязок Azure на локальный диск HoloLens 2 и извлекать их с диска.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-116">In this section, you will learn how to save and retrieve the Azure Anchor ID to and from the HoloLens 2 local disk.</span></span> <span data-ttu-id="c1c9d-117">Это позволит вам запрашивать в Azure тот же идентификатор привязки из другого сеанса приложения, и благодаря этому размещать привязанные голограммы в том же месте, как и в предыдущем сеансе этого приложения.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-117">This will allow you to query Azure for the same anchor ID between different app sessions, allowing the anchored holograms to be position at the same location as in the previous app session.</span></span>

<span data-ttu-id="c1c9d-118">В окне Hierarchy (Иерархия) разверните объект **ButtonParent_SaveAnchorId**, который содержит две кнопка: одну для сохранения идентификатора привязки Azure в хранилище HoloLens 2 и другую для извлечения идентификатора, сохраненного на диск:</span><span class="sxs-lookup"><span data-stu-id="c1c9d-118">In the Hierarchy window, expand the **ButtonParent_SaveAnchorId** object which contains two buttons, one button for saving the Azure Anchor ID to the HoloLens 2 storage and another for retrieving the saved ID from the disk:</span></span>

![mrlearning-asa](images/mrlearning-asa/tutorial2-section2-step1-1.png)

<span data-ttu-id="c1c9d-120">Выполните те же шаги, которые описаны в процедуре [настройки кнопок для управления сценой](mrlearning-asa-ch1.md#configuring-the-buttons-to-operate-the-scene) в предыдущем учебнике, чтобы настроить компоненты **Pressable Button Holo Lens 2 (Script)** (Нажимаемая кнопка Holo Lens 2 — скрипт) и **Interactable (Script)** (Доступный для взаимодействия — скрипт) для каждой из этих двух кнопок:</span><span class="sxs-lookup"><span data-stu-id="c1c9d-120">Follow the same steps as in the [configuring the buttons to operate the scene](mrlearning-asa-ch1.md#configuring-the-buttons-to-operate-the-scene) instructions from the previous tutorial to configure the **Pressable Button Holo Lens 2 (Script)** component and the **Interactable (Script)** component on each of the two buttons:</span></span>

* <span data-ttu-id="c1c9d-121">Для объекта **SaveAzureAnchorIdToDisk** назначьте функцию AnchorModuleScript > **SaveAzureAnchorIdToDisk ()** .</span><span class="sxs-lookup"><span data-stu-id="c1c9d-121">For the **SaveAzureAnchorIdToDisk** object, assign the AnchorModuleScript > **SaveAzureAnchorIdToDisk ()** function.</span></span>
* <span data-ttu-id="c1c9d-122">Для объекта **GetAzureAnchorIdFromDisk** назначьте функцию AnchorModuleScript > **GetAzureAnchorIdFromDisk ()** .</span><span class="sxs-lookup"><span data-stu-id="c1c9d-122">For the **GetAzureAnchorIdFromDisk** object, assign the AnchorModuleScript > **GetAzureAnchorIdFromDisk ()** function.</span></span>

<span data-ttu-id="c1c9d-123">После компиляции обновленного приложения в HoloLens вы сможете сохранять Пространственные привязки Azure между сеансами приложения, сохраняя соответствующие идентификаторы привязок Azure.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-123">If you build the updated application to your HoloLens, you can now persist Azure Spatial Anchors between app sessions by saving the Azure Anchor ID.</span></span> <span data-ttu-id="c1c9d-124">Чтобы проверить этот механизм, можно выполнить следующие действия.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-124">To test it out, you can follow these steps:</span></span>

1. <span data-ttu-id="c1c9d-125">Переместите взаимодействие Rocket Launcher в нужное расположение.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-125">Move the Rocket Launcher experience to desired location.</span></span>
2. <span data-ttu-id="c1c9d-126">Запустите сеанс Azure.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-126">Start Azure Session.</span></span>
3. <span data-ttu-id="c1c9d-127">Создайте привязку Azure (она создается в том расположении, где размещается взаимодействие Rocket Launcher).</span><span class="sxs-lookup"><span data-stu-id="c1c9d-127">Create Azure Anchor (creates anchors at the location of the Rocket Launcher experience).</span></span>
4. <span data-ttu-id="c1c9d-128">Сохраните идентификатор привязки Azure на диск.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-128">Save Azure Anchor ID to Disk.</span></span>
5. <span data-ttu-id="c1c9d-129">Перезапустите приложение.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-129">Restart the application.</span></span>
6. <span data-ttu-id="c1c9d-130">Получите с диска идентификатор привязки Azure (который вы только что сохранили).</span><span class="sxs-lookup"><span data-stu-id="c1c9d-130">Get Azure Anchor from Disk (loads the anchor ID you just saved).</span></span>
7. <span data-ttu-id="c1c9d-131">Запустите сеанс Azure.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-131">Start Azure Session.</span></span>
8. <span data-ttu-id="c1c9d-132">Найдите привязку Azure (она размещает взаимодействие Rocket Launcher в то расположение, которое мы настроили в шаге 3).</span><span class="sxs-lookup"><span data-stu-id="c1c9d-132">Find Azure Anchor (positions the Rocket Launcher experience at the location from step 3).</span></span>

> [!NOTE]
> <span data-ttu-id="c1c9d-133">Чтобы полностью перезапустить приложение после выхода из представления иммерсивного приложения, окно приложения в доме в смешанной реальности необходимо закрыть перед повторным запуском приложения из меню "Пуск".</span><span class="sxs-lookup"><span data-stu-id="c1c9d-133">To fully restart the application, after exiting the immersive app view, the app window in the mixed reality home needs to be closed before relaunching the application from the Start menu.</span></span> <span data-ttu-id="c1c9d-134">См. сведения об [использовании приложений в HoloLens](https://docs.microsoft.com/hololens/holographic-home#using-apps-on-hololens).</span><span class="sxs-lookup"><span data-stu-id="c1c9d-134">For additional details, you can refer to the [Using apps on HoloLens](https://docs.microsoft.com/hololens/holographic-home#using-apps-on-hololens) documentation.</span></span>

## <a name="share-azure-anchors-between-multiple-devices"></a><span data-ttu-id="c1c9d-135">Совместное использование привязок Azure на нескольких устройствах</span><span class="sxs-lookup"><span data-stu-id="c1c9d-135">Share Azure Anchors between multiple devices</span></span>

<span data-ttu-id="c1c9d-136">В этом разделе вы узнаете, как совместно использовать идентификатор привязки Azure на нескольких устройствах.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-136">In this section, you will learn how to share the Azure Anchor ID between multiple devices.</span></span> <span data-ttu-id="c1c9d-137">Это позволяет нескольким устройствам обращаться в Azure по одному идентификатору привязки, то есть поддерживать пространственное выравнивание привязанных голограмм.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-137">This will allow multiple devices to query Azure for the same anchor ID, allowing the anchored holograms to be spatially aligned.</span></span> <span data-ttu-id="c1c9d-138">Пространственное выравнивание, то есть размещение голограмм в одном физическом расположении на нескольких устройствах, является важнейшим элементом совместного использования взаимодействий в среде HoloLens 2.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-138">Spatial alignment, i.e. seeing the same holograms in the same physical location between multiple devices, is key to local shared experiences in the HoloLens 2.</span></span>

<span data-ttu-id="c1c9d-139">Есть много разных способов передавать идентификаторы привязок Azure между несколькими устройствами, часть из которых описана в серии [руководств по возможностям для нескольких пользователей](mrlearning-sharing(photon)-ch1.md).</span><span class="sxs-lookup"><span data-stu-id="c1c9d-139">There are many ways to transfer Azure Anchor IDs between devices, including methods outlined in the the [Multi-user capabilities tutorials](mrlearning-sharing(photon)-ch1.md) series.</span></span> <span data-ttu-id="c1c9d-140">В нашем примере применяется простая веб-служба для отправки и скачивания идентификаторов привязок с нескольких устройств.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-140">In this example, you will use a simple web service to upload and download anchor IDs between devices.</span></span>

<span data-ttu-id="c1c9d-141">В окне Hierarchy (Иерархия) разверните объект **ButtonParent_ShareAnchorId**, который содержит две кнопки: одну для отправки идентификатора привязки Azure на веб-сервер и другую для скачивания идентификатора с веб-сервера:</span><span class="sxs-lookup"><span data-stu-id="c1c9d-141">In the Hierarchy window, expand the **ButtonParent_ShareAnchorId** object which contains two buttons; one button for uploading the Azure Anchor ID to the web server, and another for downloading the ID from the web server:</span></span>

![mrlearning-asa](images/mrlearning-asa/tutorial2-section3-step1-1.png)

<span data-ttu-id="c1c9d-143">Выполните те же шаги, которые описаны в процедуре [настройки кнопок для управления сценой](mrlearning-asa-ch1.md#configuring-the-buttons-to-operate-the-scene) в предыдущем учебнике, чтобы настроить компоненты **Pressable Button Holo Lens 2 (Script)** (Нажимаемая кнопка Holo Lens 2 — скрипт) и **Interactable (Script)** (Доступный для взаимодействия — скрипт) для каждой из этих двух кнопок:</span><span class="sxs-lookup"><span data-stu-id="c1c9d-143">Follow the same steps as in the [configuring the buttons to operate the scene](mrlearning-asa-ch1.md#configuring-the-buttons-to-operate-the-scene) instructions from the previous tutorial to configure the **Pressable Button Holo Lens 2 (Script)** component and the **Interactable (Script)** component on each of the two buttons:</span></span>

* <span data-ttu-id="c1c9d-144">Для объекта **ShareAzureAnchorIdToNetwork** назначьте функцию AnchorModuleScript > **ShareAzureAnchorIdToNetwork ()** .</span><span class="sxs-lookup"><span data-stu-id="c1c9d-144">For the **ShareAzureAnchorIdToNetwork** object, assign the AnchorModuleScript > **ShareAzureAnchorIdToNetwork ()** function.</span></span>
* <span data-ttu-id="c1c9d-145">Для объекта **GetAzureAnchorIdFromNetwork** назначьте функцию AnchorModuleScript > **GetAzureAnchorIdFromNetwork ()** .</span><span class="sxs-lookup"><span data-stu-id="c1c9d-145">For the **GetAzureAnchorIdFromNetwork** object, assign the AnchorModuleScript > **GetAzureAnchorIdFromNetwork ()** function.</span></span>

<span data-ttu-id="c1c9d-146">После компиляции обновленного приложения на двух устройствах HoloLens вы сможете поддерживать пространственное выравнивание между ними, используя общий идентификатор привязки Azure.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-146">If you build the updated application to two HoloLens devices, you can now achieve spatial alignment between them by sharing the Azure Anchor ID.</span></span> <span data-ttu-id="c1c9d-147">Чтобы проверить этот механизм, можно выполнить следующие действия.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-147">To test it out, you can follow these steps:</span></span>

1. <span data-ttu-id="c1c9d-148">На устройстве HoloLens 1: переместите взаимодействие Rocket Launcher в нужное расположение.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-148">On HoloLens device 1: Move the Rocket Launcher experience to desired location.</span></span>
2. <span data-ttu-id="c1c9d-149">На устройстве HoloLens 1: запустите сеанс Azure.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-149">On HoloLens device 1: Start Azure Session.</span></span>
3. <span data-ttu-id="c1c9d-150">На устройстве HoloLens 1: создайте привязку Azure (она создается в том расположении, где размещается взаимодействие Rocket Launcher).</span><span class="sxs-lookup"><span data-stu-id="c1c9d-150">On HoloLens device 1: Create Azure Anchor (creates anchors at the location of the Rocket Launcher experience).</span></span>
4. <span data-ttu-id="c1c9d-151">На устройстве HoloLens 1: сохраните идентификатор привязки Azure в сетевое расположение.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-151">On HoloLens device 1: Share Azure Anchor ID to Network.</span></span>
5. <span data-ttu-id="c1c9d-152">На устройстве HoloLens 2: Запустите приложение.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-152">On HoloLens device 2: Start the application.</span></span>
6. <span data-ttu-id="c1c9d-153">На устройстве HoloLens 2: получите совместно используемый идентификатор привязки из сетевого расположения (тот же идентификатор привязки, который вы только что сохранили с устройства HoloLens 1).</span><span class="sxs-lookup"><span data-stu-id="c1c9d-153">On HoloLens device 2: Get Shared Anchor ID from Network (fetches the anchor ID just shared from HoloLens device 1).</span></span>
7. <span data-ttu-id="c1c9d-154">На устройстве HoloLens 2: запустите сеанс Azure.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-154">On HoloLens device 2: Start Azure Session.</span></span>
8. <span data-ttu-id="c1c9d-155">На устройстве HoloLens 2: Найдите привязку Azure (она размещает взаимодействие Rocket Launcher в то расположение, которое мы настроили в шаге 3).</span><span class="sxs-lookup"><span data-stu-id="c1c9d-155">On HoloLens device 2: Find Azure Anchor (positions the Rocket Launcher experience at the location from step 3).</span></span>

> [!TIP]
> <span data-ttu-id="c1c9d-156">Если у вас только одно устройство HoloLens, для проверки механизма вы можете перезапускать приложение вместо перехода на другое устройство HoloLens.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-156">If you only have one HoloLens, you can still test the functionality by restarting the application instead of using a second HoloLens device.</span></span>

## <a name="congratulations"></a><span data-ttu-id="c1c9d-157">Поздравляем!</span><span class="sxs-lookup"><span data-stu-id="c1c9d-157">Congratulations</span></span>

<span data-ttu-id="c1c9d-158">В этом учебнике вы узнали, как сохранять Пространственные привязки Azure межу сеансами приложения и перезапусками приложений, сохраняя идентификатор Пространственной привязки Azure на локальный диск HoloLens.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-158">In this tutorial you learned how to persist Azure Spatial Anchors between application sessions and application restarts by saving the Azure Spatial Anchor ID to the local disk on HoloLens.</span></span> <span data-ttu-id="c1c9d-159">Вы также узнали, как совместно использовать Пространственные привязки Azure на нескольких устройствах, применяя базовый статический механизм совместного использования голограмм.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-159">You also learned how to share Azure Spatial Anchors between multiple devices for a basic multi-user, static hologram shared experience.</span></span>

<span data-ttu-id="c1c9d-160">В следующем учебнике вы научитесь предоставлять пользователям обратную связь в режиме реального времени.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-160">In the next tutorial you will learn how to provide users with real-time feedback.</span></span> <span data-ttu-id="c1c9d-161">Эта обратная связь включает сведения о создании привязки, понимание качества среды и состояние сеанса Azure.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-161">This feedback will include information about Anchor creation, the quality of environment understanding, and the state of the Azure session.</span></span> <span data-ttu-id="c1c9d-162">Без такой обратной связи пользователи не смогут узнать, успешно ли отправлена привязка в Azure, обладает ли среда достаточным качеством среды для создания привязки и в каком состоянии сейчас находится система.</span><span class="sxs-lookup"><span data-stu-id="c1c9d-162">Without feedback, users may not know whether an anchor has successfully been uploaded to Azure, whether the quality of the environment is sufficient for anchor creation, or the current state.</span></span>

[<span data-ttu-id="c1c9d-163">Следующий урок. 3. Отображение отзывов по пространственным привязкам Azure</span><span class="sxs-lookup"><span data-stu-id="c1c9d-163">Next Lesson: 3. Displaying Azure Spatial Anchor feedback</span></span>](mrlearning-asa-ch3.md)
