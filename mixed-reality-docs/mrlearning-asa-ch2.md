---
title: Руководства по Пространственным привязкам Azure — часть 2. Сохранение, получение и совместное использование Пространственных привязок Azure
description: В рамках этого курса вы узнаете, как реализовать функцию распознавания лиц Azure в приложении смешанной реальности.
author: jessemcculloch
ms.author: jemccull
ms.date: 02/26/2019
ms.topic: article
keywords: mixed reality, unity, tutorial, hololens
ms.localizationpriority: high
ms.openlocfilehash: 36f25229469e848a3f0612a5971cc8e9381262f5
ms.sourcegitcommit: 9df82dba06a91a8d2cedbe38a4328f8b86bb2146
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/29/2020
ms.locfileid: "80362007"
---
# <a name="2-saving-retrieving-and-sharing-azure-spatial-anchors"></a>2. Сохранение, получение и совместное использование Пространственных привязок Azure

В этом учебнике вы узнаете, как сохранять Пространственные привязки Azure между сеансами приложения, сохраняя идентификатор привязки в хранилище HoloLens 2. Вы также узнаете, как передать этот идентификатор привязки другим устройствам для согласования привязок между несколькими устройствами.

## <a name="objectives"></a>Задачи

* Узнайте, как сохранять идентификаторы Пространственных привязок Azure на локальный диск HoloLens 2 и извлекать их с диска, чтобы поддерживать сохраняемость между сеансами приложения.
* Узнайте, как несколько пользователей могут совместно использовать идентификаторы Пространственных привязок Azure в сценарии с несколькими устройствами.

## <a name="preparing-the-scene"></a>Подготовка сцены

В окне проекта перейдите к папке **Assets** (Активы) > **MRTK.Tutorials.AzureSpatialAnchors** > **Prefabs** (Заготовки). Удерживая нажатой клавишу CTRL, щелкните **ButtonParent_SaveAnchorId** и **ButtonParent_ShareAnchorId**, чтобы выбрать две нужные заготовки, и перетащите их в окно Hierarchy (Иерархия), чтобы добавить в сцену:

![mrlearning-asa](images/mrlearning-asa/tutorial2-section1-step1-1.png)

## <a name="persist-azure-anchors-between-app-sessions---save-anchor-id-to-disk"></a>Сохранение привязок Azure между сеансами приложения — сохранение идентификатора привязки на диск
<!-- TODO: Consider renaming to 'Persist Azure Anchors between app sessions' -->

В этом разделе вы узнаете, как сохранять идентификаторы Пространственных привязок Azure на локальный диск HoloLens 2 и извлекать их с диска. Это позволит вам запрашивать в Azure тот же идентификатор привязки из другого сеанса приложения, и благодаря этому размещать привязанные голограммы в том же месте, как и в предыдущем сеансе этого приложения.

В окне Hierarchy (Иерархия) разверните объект **ButtonParent_SaveAnchorId**, который содержит две кнопка: одну для сохранения идентификатора привязки Azure в хранилище HoloLens 2 и другую для извлечения идентификатора, сохраненного на диск:

![mrlearning-asa](images/mrlearning-asa/tutorial2-section2-step1-1.png)

Выполните те же шаги, которые описаны в процедуре [настройки кнопок для управления сценой](mrlearning-asa-ch1.md#configuring-the-buttons-to-operate-the-scene) в предыдущем учебнике, чтобы настроить компоненты **Pressable Button Holo Lens 2 (Script)** (Нажимаемая кнопка Holo Lens 2 — скрипт) и **Interactable (Script)** (Доступный для взаимодействия — скрипт) для каждой из этих двух кнопок:

* Для объекта **SaveAzureAnchorIdToDisk** назначьте функцию AnchorModuleScript > **SaveAzureAnchorIdToDisk ()** .
* Для объекта **GetAzureAnchorIdFromDisk** назначьте функцию AnchorModuleScript > **GetAzureAnchorIdFromDisk ()** .

После компиляции обновленного приложения в HoloLens вы сможете сохранять Пространственные привязки Azure между сеансами приложения, сохраняя соответствующие идентификаторы привязок Azure. Чтобы проверить этот механизм, можно выполнить следующие действия.

1. Переместите взаимодействие Rocket Launcher в нужное расположение.
2. Запустите сеанс Azure.
3. Создайте привязку Azure (она создается в том расположении, где размещается взаимодействие Rocket Launcher).
4. Сохраните идентификатор привязки Azure на диск.
5. Перезапустите приложение.
6. Получите с диска идентификатор привязки Azure (который вы только что сохранили).
7. Запустите сеанс Azure.
8. Найдите привязку Azure (она размещает взаимодействие Rocket Launcher в то расположение, которое мы настроили в шаге 3).

> [!NOTE]
> Чтобы полностью перезапустить приложение после выхода из представления иммерсивного приложения, окно приложения в доме в смешанной реальности необходимо закрыть перед повторным запуском приложения из меню "Пуск". См. сведения об [использовании приложений в HoloLens](https://docs.microsoft.com/hololens/holographic-home#using-apps-on-hololens).

## <a name="share-azure-anchors-between-multiple-devices"></a>Совместное использование привязок Azure на нескольких устройствах

В этом разделе вы узнаете, как совместно использовать идентификатор привязки Azure на нескольких устройствах. Это позволяет нескольким устройствам обращаться в Azure по одному идентификатору привязки, то есть поддерживать пространственное выравнивание привязанных голограмм. Пространственное выравнивание, то есть размещение голограмм в одном физическом расположении на нескольких устройствах, является важнейшим элементом совместного использования взаимодействий в среде HoloLens 2.

Есть много разных способов передавать идентификаторы привязок Azure между несколькими устройствами, часть из которых описана в серии [руководств по возможностям для нескольких пользователей](mrlearning-sharing(photon)-ch1.md). В нашем примере применяется простая веб-служба для отправки и скачивания идентификаторов привязок с нескольких устройств.

В окне Hierarchy (Иерархия) разверните объект **ButtonParent_ShareAnchorId**, который содержит две кнопки: одну для отправки идентификатора привязки Azure на веб-сервер и другую для скачивания идентификатора с веб-сервера:

![mrlearning-asa](images/mrlearning-asa/tutorial2-section3-step1-1.png)

Выполните те же шаги, которые описаны в процедуре [настройки кнопок для управления сценой](mrlearning-asa-ch1.md#configuring-the-buttons-to-operate-the-scene) в предыдущем учебнике, чтобы настроить компоненты **Pressable Button Holo Lens 2 (Script)** (Нажимаемая кнопка Holo Lens 2 — скрипт) и **Interactable (Script)** (Доступный для взаимодействия — скрипт) для каждой из этих двух кнопок:

* Для объекта **ShareAzureAnchorIdToNetwork** назначьте функцию AnchorModuleScript > **ShareAzureAnchorIdToNetwork ()** .
* Для объекта **GetAzureAnchorIdFromNetwork** назначьте функцию AnchorModuleScript > **GetAzureAnchorIdFromNetwork ()** .

После компиляции обновленного приложения на двух устройствах HoloLens вы сможете поддерживать пространственное выравнивание между ними, используя общий идентификатор привязки Azure. Чтобы проверить этот механизм, можно выполнить следующие действия.

1. На устройстве HoloLens 1: переместите взаимодействие Rocket Launcher в нужное расположение.
2. На устройстве HoloLens 1: запустите сеанс Azure.
3. На устройстве HoloLens 1: создайте привязку Azure (она создается в том расположении, где размещается взаимодействие Rocket Launcher).
4. На устройстве HoloLens 1: сохраните идентификатор привязки Azure в сетевое расположение.
5. На устройстве HoloLens 2: Запустите приложение.
6. На устройстве HoloLens 2: получите совместно используемый идентификатор привязки из сетевого расположения (тот же идентификатор привязки, который вы только что сохранили с устройства HoloLens 1).
7. На устройстве HoloLens 2: запустите сеанс Azure.
8. На устройстве HoloLens 2: Найдите привязку Azure (она размещает взаимодействие Rocket Launcher в то расположение, которое мы настроили в шаге 3).

> [!TIP]
> Если у вас только одно устройство HoloLens, для проверки механизма вы можете перезапускать приложение вместо перехода на другое устройство HoloLens.

## <a name="congratulations"></a>Поздравляем!

В этом учебнике вы узнали, как сохранять Пространственные привязки Azure межу сеансами приложения и перезапусками приложений, сохраняя идентификатор Пространственной привязки Azure на локальный диск HoloLens. Вы также узнали, как совместно использовать Пространственные привязки Azure на нескольких устройствах, применяя базовый статический механизм совместного использования голограмм.

В следующем учебнике вы научитесь предоставлять пользователям обратную связь в режиме реального времени. Эта обратная связь включает сведения о создании привязки, понимание качества среды и состояние сеанса Azure. Без такой обратной связи пользователи не смогут узнать, успешно ли отправлена привязка в Azure, обладает ли среда достаточным качеством среды для создания привязки и в каком состоянии сейчас находится система.

[Следующий урок. 3. Отображение отзывов по пространственным привязкам Azure](mrlearning-asa-ch3.md)
