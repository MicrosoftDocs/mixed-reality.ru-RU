---
title: Голограмма, стабильность
description: HoloLens автоматически нарушить голограммы, но существуют шаги, которые могут потребоваться разработчикам для улучшения устойчивости к голограммам.
author: thetuvix
ms.author: alexturn
ms.date: 03/21/2018
ms.topic: article
keywords: голограммы, стабильность, hololens
ms.openlocfilehash: 65ea1c456ae6713e7718c3591cb3ba5759390735
ms.sourcegitcommit: 2cf3f19146d6a7ba71bbc4697a59064b4822b539
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/12/2019
ms.locfileid: "73926683"
---
# <a name="hologram-stability"></a>Голограмма, стабильность

Для достижения стабильных голограмм HoloLens имеет встроенный конвейер стабилизации Image. Конвейер стабилизации работает автоматически в фоновом режиме, поэтому никаких дополнительных действий по его включению не требуется. Тем не менее разработчики должны применять методики, повышающие устойчивость к голограммам, и избежать сценариев, снижающих стабильность.

## <a name="hologram-quality-terminology"></a>Терминология с голограммами

Качество голограмм является результатом хорошей среды и хорошей разработки приложений. Приложения, которые подпадают под постоянную 60 кадров (в секунду) в среде, где HoloLens может следить за окружающей средой, будут обеспечивать синхронизацию голограммы и соответствующей системы координат. С точки зрения пользователя голограммы, которые предназначены для стационарной работы, не перемещаются относительно среды.

При возникновении проблем с средой, несоответствия или низкой частоты отрисовки или других проблем с приложениями, приведенная ниже терминология полезна при определении проблемы.
* **Правильно.** Когда голограмма была заблокирована и помещается в реальный мир, она должна остаться там, где она была размещена, относительно окружающей среды, независимо от движения пользователя или небольших и разреженных изменений в среде. Если позже в неожиданном месте появляется голограмма, это значит, что проблема *точности* . Такие сценарии могут возникнуть, если две отдельные комнаты выглядят одинаковыми.
* **Синхронизации.** Пользователи используют эту встряхиванийную голограмму с высокой частотой. Это может произойти при отслеживании снижения среды. Для пользователей решение выполняет [настройку датчика](sensor-tuning.md).
* **Жуддер.** Низкие частоты отрисовки приводят к неравномерному перемещению и удвоенным изображениям голограмм. Это особенно заметно в голограммах с движением. Разработчикам необходимо поддерживать [постоянную 60 кадров в кадре/](hologram-stability.md#frame-rate)с.
* **Настройке.** Пользователи видят это как голограмму, чтобы переместиться из места первоначального размещения. Это происходит, когда голограммы размещаются далеко от [пространственных привязок](spatial-anchors.md), особенно в частях среды, которые не были полностью сопоставлены. Создание голограмм, близких к пространственным привязкам, снижает вероятность смещения.
* **Переход.** Время от времени, когда «POP» или «переходит» от ее расположения. Это может произойти, когда отслеживание корректирует голограммы так, чтобы они соответствовали обновленному пониманию среды.
* **Дорожки.** Когда в Sway отображается голограмма, соответствующая перемещению головного пользователя. Это происходит, когда приложение не полностью реализовало [репроекцию](hologram-stability.md#reprojection)и не [калибровка](calibration.md) HoloLens для текущего пользователя. Чтобы устранить эту проблему, пользователь может повторно запустить приложение [калибровки](calibration.md) . Разработчики могут обновить плоскость стабилизации, чтобы улучшить стабильность.
* **Разделение цветов.** В HoloLens отображаются цветовые последовательные дисплеи, в которых цветовые каналы Flash красный-зеленый-синий-зеленый при 60 Гц (отдельные поля цвета показаны в 240Hz). Каждый раз, когда пользователь отслеживает подвижную голограмму со своими глазами, его ведущие и конечные края помечаются отдельными цветами, что приводит к появлении эффектов «Радуга». Степень разделения зависит от скорости голограммы. В некоторых реже случаях быстро перемещаться по головному элементу при взгляде на стационарную голограмму также может привести к появлению эффектов «Радуга». Это называется *[разделением цветов](hologram-stability.md#color-separation)* .

## <a name="frame-rate"></a>Частота кадров

Частота кадров — первый основополагающий уровень стабильности. Для того чтобы голограммы были стабильными в мире, каждое изображение, представленное пользователю, должно иметь голограммы, нарисованные в правильном месте. На экране отображается обновление HoloLens 240 раз в секунду, в котором показаны четыре отдельных поля цвета для каждого вновь визуализированного изображения, что приводит к пользовательскому взаимочастоте 60 кадров в секунду. Чтобы обеспечить наилучшую производительность, разработчики приложений должны поддерживать 60 кадров/с, что преобразуется для согласованного предоставления нового образа операционной системе каждые 16 миллисекунд.

**60 кадров/** с Чтобы нарисовать голограммы так, как будто они находятся в реальной жизни, HoloLens должен визуализировать изображения из расположения пользователя. Так как отрисовка изображений занимает некоторое время, HoloLens прогнозирует место, где заголовком пользователя будет отображаться при отображении изображений на экране. Этот алгоритм прогнозирования является приближением. HoloLens оборудован оборудованием, которое корректирует подготовленный образ для учета расхождений между прогнозируемой позицией и фактической позицией заголовка. Это делает изображение, которое видит пользователь, отображается так, как если бы оно было визуализировано из правильного расположения, а голограммы оказались стабильными. Обновления образа лучше подходят для небольших изменений и не могут полностью исправить определенные вещи в отображаемом образе, например Motion-фокусировки.

При подготовке к просмотру в 60 кадров/с вы выполняете три вещи, которые помогут сделать стабильные голограммы:
1. Минимизация общей задержки между отрисовкой изображения и видимым пользователем изображением. В подсистеме, обрабатывающем игровой поток и выполняющийся в локкстеп потоке отрисовки, работающий в 30FPS, может добавить 33.3 МС дополнительной задержки. Уменьшая задержку, эта ошибка уменьшает прогноз и повышает стабильность.
2. Это делает так, чтобы каждое изображение достигло глаза пользователя в непротиворечивом размере задержки. При подготовке к просмотру в 30fps изображение по-прежнему отображает изображения в 60 кадров/с. Это означает, что один и тот же образ будет отображаться дважды в строке. Второй кадр будет иметь 16.6 MS больше времени задержки, чем первый кадр, и потребуется исправить более произносится ошибка. Такая несогласованность при ошибке может привести к нежелательному жуддер 60 Гц.
3. Уменьшение внешнего вида жуддер, который характеризуется нечетными движениями и двойными изображениями. Более быстрые показатели движения и снижения скорости рендеринга связаны с более произжуддером. Таким образом, при постоянном обслуживании 60 кадров/с вы сможете избежать жуддер для данной подвижной голограммы.

**Согласованность с частотой кадров** Согласованность частоты кадров очень важна для большого количества кадров в секунду. Иногда удаленные кадры неизбежны для любого приложения с большим количеством содержимого, а HoloLens реализует некоторые сложные алгоритмы для восстановления после редких сбоев. Однако постоянно изменяющаяся частота кадров гораздо более заметна для пользователя, чем выполнение согласованных с низкой частотой кадров. Например, приложение, которое визуализируется в течение 5 кадров (60 кадров/с в течение этих 5 кадров), а затем удаляет все остальные кадры для следующих 10 кадров (30 кадров/с в течение этих 10 кадров) будет отображаться более стабильно, чем приложение, которое постоянно отрисовывается 30 кадров/с.

В связанной заметке операционная система регулирует приложения до 30 кадров в сек при выполнении [записи смешанной реальности](mixed-reality-capture.md) .

**Анализ производительности** Существует множество средств, которые можно использовать для оценки частоты кадров приложений, например:
* GPUView
* Отладчик графики Visual Studio
* Профилировщики, встроенные в трехмерные механизмы, такие как Unity

## <a name="hologram-render-distances"></a>Расстояния, отображаемые на голограммах

>[!VIDEO https://www.youtube.com/embed/-606oZKLa_s]

Система человеческого визуального элемента интегрирует несколько сигналов, зависящих от расстояния, когда она фиксатес и фокусируется на объекте.
* [Проживание](https://en.wikipedia.org/wiki/Accommodation_%28eye%29) — Сосредоточьтесь на индивидуальном глазе.
* [Конвергенция](https://en.wikipedia.org/wiki/Convergence_(eye)) — два глаза перемещаются внутрь или наружу по центру объекта.
* [Представление с помощью бинокля](https://en.wikipedia.org/wiki/Stereopsis) — различия между изображениями левого и правого взгляда, которые зависят от расстояния объекта от точки с фиксацией.
* Заливка, относительный угловой размер и другие монокулар (один глаз).

Конвергенция и проживание являются уникальными, так как они являются дополнительными сетчатки подсказками, связанными с тем, как глаза меняются, чтобы воспринимать объекты на разных расстояниях. В естественном просмотре конвергенции и проживание связаны. Когда глаза просматривают нечто близкое (например, нос), глаза пересекается и помещается в ближайшем месте. Когда глаза просматривают что-то в бесконечности, глаза становятся параллельными, а глаз — бесконечностью. Пользователи людьми HoloLens всегда будут использовать 2.0 m для поддержания четкого образа, так как отображение HoloLens фиксировано на оптическом расстоянии приблизительно 2.0 – от пользователя. Разработчики приложений контролируют, где соходят глаза пользователей, размещая содержимое и голограммы с различной глубиной. Когда пользователи разрабатывают и сходятся на разные расстояния, естественная связь между двумя подсказками разбивается, и это может привести к визуальному дискомфорт или выносливости, особенно если масштаб конфликта большой. Дискомфорт из верженце-проживания можно избежать или свести к минимальному хранению содержимого, которое пользователи соходят в максимально близком к 2,0-м m (т. е. в сцене с большим количеством элементов, представляющих интерес около 2,0 m, когда это возможно). Если содержимое не может быть помещено рядом с 2.0 m дискомфорт из-за конфликта верженце, то при взгляде пользователя на разные расстояния происходит наибольшее расстояние. Иными словами, гораздо удобнее взглянуть на стационарную голограмму, которая остается 50cmой, чем взглянув на голограмму 50cm, которая перемещается в сторону и вдали от вас со временем.

Размещение содержимого в версии 2.0 m также выгодно, так как два дисплея предназначены для полного перекрытия на этом расстоянии. Для изображений, размещенных на этой плоскости, так как они выходят за пределы holographic, они исчезают с одного экрана, пока все еще отображаются на другом. Это может привести к нарушению глубины голограммы.

**Оптимальное расстояние для размещения голограмм от пользователя**

![Оптимальное расстояние для размещения голограмм от пользователя](images/distanceguiderendering-750px.png)

**Резкие плоскости** Для максимального удобства мы рекомендуем обрезать расстояние визуализации в 85cm с появлением содержимого, начиная с 1 МБ. В приложениях, где голограммы и пользователи являются «стационарными» голограммами, можно просмотреться близко к 50cm. В таких случаях приложения должны размещать плоскость обрезки не ближе, чем 30cm и исчезать, должна начинаться по крайней мере 10cm из плоскости обрезки. Каждый раз, когда содержимое будет ближе, чем 85cm, важно убедиться, что пользователи не переходят ближе или дальше от голограмм, или что самые популярные области не часто перемещаются ближе к пользователю или не находятся дальше от него, так как эти ситуации, скорее всего, приведут к дискомфорт из верженце — конфликт с проживанием. Содержимое должно быть спроектировано таким образом, чтобы не допустить необходимости взаимодействия, чем 85cm от пользователя, но когда содержимое должно быть визуализировано ближе, чем 85cm. хорошее правило для разработчиков заключается в проектировании сценариев, в которых пользователи и/или голограммы не перемещаются более чем на 25% времени.

**Рекомендации** Если не удается поместить голограммы в 2 МБ, а конфликты между конвергенцией и проживанием не могут быть устранены, оптимальная зона для размещения с голограммами находится между 1,25 м и 5 мин. В каждом случае разработчики должны структурировать содержимое, чтобы рекомендовать пользователям взаимодействовать с 1 + m (например, настроить размер содержимого и параметры размещения по умолчанию).

## <a name="reprojection"></a>Репроектное
HoloLens выполняет сложную технологию стабилизации с аппаратным обеспечением, именуемую репроецированием. Это учитывает движение и изменение точки зрения (Камерапосе) при анимации сцены, а пользователь перемещает его заголовок.  Приложения должны выполнять определенные действия для наиболее эффективного использования РЕПРОЕКЦИИ.


Существует четыре основных типа РЕПРОЕКЦИИ.
* **Репроектная глубина:**  Это дает лучшие результаты с наименьшим объемом усилий от приложения.  Все части визуализированной сцены изменяются независимо от их расстояния от пользователя.  Некоторые артефакты отрисовки могут быть видимыми, когда глубина глубины резко меняется.  Этот параметр доступен только для HoloLens и впечатляющих головных телефонов.
* **Плоское перепроецирование:**  Это позволяет приложению точно управлять стабилизации.  Плоскость задается приложением, и все на этой плоскости будет самой стабильной частью сцены.  Чем выше голограмма, тем менее стабильной она будет.  Этот параметр доступен на всех платформах Windows MR.
* **Автоматическое плоское перепроецирование:**  Система устанавливает плоскость стабилизации, используя сведения в буфере глубины.  Этот параметр доступен в колении HoloLens 1 и HoloLens 2.
* **Нет:** Если приложение ничего не делает, используется плоская репроектная шкала с стабилизации плоскостью, фиксированная на 2 метрах в направлении головного взгляда пользователя.  Как правило, это приводит к созданию подстандартных результатов.

Приложения должны предпринять определенные действия, чтобы включить различные типы РЕПРОЕКЦИИ
* **Репроектная глубина:** Приложение отправляет свой буфер глубины в систему для каждого отображаемого кадра.  В Unity это можно сделать с помощью параметра "включить совместное использование буфера глубины" в области параметров проигрывателя.  Приложения DirectX вызывают CommitDirect3D11DepthBuffer.  Приложение не должно вызывать Сетфокуспоинт.
* **Плоское перепроецирование:** В каждом кадре приложения сообщают системе, что расположение плоскости необходимо стабилизировать.  Приложения Unity вызывают Сетфокуспоинтфорфраме и должны отключить совместное использование буфера глубины.  Приложения DirectX вызывают Сетфокуспоинт и не должны вызывать CommitDirect3D11DepthBuffer.
* **Автоматическое плоское перепроецирование:** Чтобы сделать это, приложению необходимо отправить свой буфер глубины в систему, так как они потребуют более глубокого перепроекции.  В HoloLens 2 приложение должно Сетфокуспоинт с точкой 0, 0 для каждого кадра.  В случае создания HoloLens 1 приложение не должно вызывать Сетфокуспоинт.

### <a name="choosing-reprojection-technique"></a>Выбор метода РЕПРОЕКЦИИ

Тип стабилизации |    Впечатляющие гарнитуры |    Поколение HoloLens 1 | HoloLens 2
--- | --- | --- | ---
Репроектная глубина |    Рекомендуем |   Нет данных |   Рекомендуем<br/><br/>Приложения Unity должны использовать Unity 2018.4.12 или более поздней версии или Unity 2019,3 или более поздней версии. В противном случае используйте автоматическое плоское перепроецирование.
Автоматическое плоское перепроецирование | Нет данных |   Рекомендуется по умолчанию |   Рекомендуется, если перепроецирование глубины не дает наилучших результатов<br/><br/>Для приложений Unity рекомендуется использовать Unity 2018.4.12 или более поздней версии или Unity 2019,3 или более поздней версии.  Предыдущие версии Unity будут работать с слегка сниженными результатами РЕПРОЕКЦИИ.
Плоское перепроецирование |   Не рекомендуется |   Рекомендуется, если автоматическая плоская не дает наилучших результатов |    Используйте, если ни один из параметров глубины не дает нужных результатов    

### <a name="verifying-depth-is-set-correctly"></a>Проверка правильности задана глубина
            
Если в методе РЕПРОЕКЦИИ используется буфер глубины, важно убедиться, что содержимое буфера глубины представляет отображаемую сцену приложения.  Некоторые факторы могут вызвать проблемы.  Если есть другая камера, которая используется для визуализации, скажем, наложения пользовательского интерфейса, скорее всего, будет перезаписана вся информация о глубине из фактического представления.  Прозрачные объекты часто не задают глубину.  По умолчанию для какой бы то ни было отрисовки текста глубина не задана.  Если глубина не соответствует отображаемым голограммам, в отрисовке будут отображаться видимые сбои.
            
HoloLens 2 имеет визуализатор для отображения глубины и не устанавливается.  Включите это на портале устройств.  На вкладке стабильность на **представлениях** > **голограмма** установите флажок **Отображать визуализацию глубины на гарнитуре** .  Области, для которых правильно задана глубина, будут синими.  Готовые к просмотру элементы, для которых не задана глубина глубины, будут красными и, следовательно, требуют исправления.  Обратите внимание, что Визуализация глубины не будет отображаться в записи смешанной реальности.  Она видна только на устройстве.
            
Некоторые средства просмотра GPU позволяют визуализировать буфер глубины.  Разработчики приложений могут использовать эти средства, чтобы обеспечить правильную настройку глубины.  Обратитесь к документации по средствам приложения.

### <a name="using-planar-reprojection"></a>Использование плоской РЕПРОЕКЦИИ
> [!NOTE]
> Для настольных современных головных телефонов настройка плоскости стабилизации обычно является высокопроизводительной, так как она обеспечивает меньше визуального качества, чем предоставление в системе буфера глубины приложения для обеспечения РЕПРОЕКЦИИ на основе глубины в пикселях. Если не выполняется в HoloLens, следует, как правило, избегать настройки плоскости стабилизации.

![Стабилизации плоскость для трехмерных объектов](images/stab-plane-500px.jpg)

Устройство будет автоматически пытаться выбрать эту плоскость, но приложение должно помочь в этом процессе, выбрав точку фокусировки в сцене. Приложения Unity, работающие в HoloLens, должны выбрать наиболее подходящую точку на основе сцены и передать ее в [сетфокуспоинт ()](focus-point-in-unity.md). Пример настройки точки фокусировки в DirectX включен в шаблон куба по умолчанию.

Обратите внимание, что если приложение Unity работает на высокопроизводительном гарнитуре, подключенном к настольному ПК, Unity будет отправлять в Windows буфер глубины, чтобы обеспечить возможность РЕПРОЕКЦИИ на каждый пиксель, что, как правило, обеспечивает еще более высокое качество изображения без выполнения явной работы с приложением. Если вы указываете точку фокусировки, это переопределит перестройку каждого пикселя, поэтому это следует делать только в том случае, если приложение выполняется на HoloLens.




```cs
// SetFocusPoint informs the system about a specific point in your scene to
// prioritize for image stabilization. The focus point is set independently
// for each holographic camera.
// You should set the focus point near the content that the user is looking at.
// In this example, we put the focus point at the center of the sample hologram,
// since that is the only hologram available for the user to focus on.
// You can also set the relative velocity and facing of that content; the sample
// hologram is at a fixed point so we only need to indicate its position.
renderingParameters.SetFocusPoint(
    currentCoordinateSystem,
    spinningCubeRenderer.Position
    );
```

Размещение фокус-точки во многом зависит от голограммы, которую просматривает. Приложение имеет вектор взгляда на ссылку, и конструктор приложений знает, какое содержимое он хочет отслеживать.

Самое важное, что разработчик может сделать, чтобы стабилизировать голограммы, — это визуализация в 60 кадров/с. Удаление ниже 60 кадров/с значительно сокращает стабильность, независимо от оптимизации плоскости стабилизации.

**Рекомендации** Нет универсального способа настройки плоскости стабилизации, и она зависит от конкретного приложения, поэтому основная рекомендация заключается в эксперименте и о том, что лучше всего подходит для ваших сценариев. Однако попробуйте выстроить стабилизации плоскость с максимально возможной точностью содержимого, так как все содержимое этой плоскости полностью стабилизация.

Пример
* Если у вас есть только плоское содержимое (приложение для чтения и воспроизведения видео), совместите плоскость стабилизации с плоскостью, в которой находится ваше содержимое.
* Если имеется 3 небольшие шарик, которые заблокированы по всему миру, сделайте стабилизации плоскость "вырезать", хотя центры всех шарик, которые в настоящее время находятся в представлении пользователя.
* Если содержимое сцены существенно отличается, лучше поработать с другими объектами.
* Не забудьте настроить стабилизации каждую рамку так, чтобы она совпадала с голограммой, которую пользователь просматривает

Что **следует избегать** Плоскость стабилизации — это отличный инструмент для достижения стабильных голограмм, но при его использовании может привести к нестабильной работе образа.
* Не «срабатывают и не забудьте», так как вы можете присоединиться к стабилизации плоскости, которая находится за пользователем или присоединена к объекту, который больше не находится в представлении пользователя. Убедитесь, что нормальная плоскость стабилизации установлена на противоположную камеру (например,-камеру. Forward).
* Не изменяйте стабилизации плоскость в обратном направлении между крайней скоростью
* Не оставляйте для плоскости стабилизации фиксированное расстояние или ориентацию.
* Не позволяйте стабилизации плоскость по пользователю
* Не устанавливайте точку фокусировки при запуске на настольном компьютере, а не в HoloLens, а вместо этого используйте перестройку на основе глубины на уровне точек.

## <a name="color-separation"></a>Разделение цветов 

Из-за особенностей отображения HoloLens может быть восприниматься артефакт под названием «цветоделение». Он манифесты в виде изображения, отделенного отдельными базовыми цветами — красным, зеленым и синим. Артефакт может быть особенно видимым при отображении белых объектов, так как они имеют большой объем красного, зеленого и синего. Это наиболее произносится, когда пользователь визуально отслеживает голограмму, которая перемещается в holographic кадре с высокой скоростью. Другой способ, который может быть манифестом артефакта, — деформацию или деформировать объекты. Если объект имеет высокую контрастность и (или) чистые цвета (красный, зеленый, синий), разделение цветов будет рассматриваться как деформацию различных частей объекта.

**Пример того, как пользователь поворачивает свою головку на сторону, может выглядеть так, как цветовая разделяться белым скругленным курсором с заголовком.**

![Пример того, как пользователь поворачивает свою головку на сторону, может выглядеть так, как цветовая разделяться белым скругленным курсором с заголовком.](images/colorseparationofroundwhitecursor-300px.png)

Несмотря на то, что трудно избежать разделения цветов, существует несколько способов их устранения.

**Цветоделение можно увидеть на:**
* Объекты, которые быстро перемещаются, включая объекты, заблокированные в голову, например [курсор](cursors.md).
* Объекты, которые значительно далеко от [плоскости стабилизации](hologram-stability.md#reprojection).

**Для ослабления эффекта разделения цветов:**
* Сделайте объект задержкой пользователя. Он должен выглядеть так, как если бы он был в некоторой инерции и был прикреплен к взгляду «по пружины». Это замедлит работу курсора (уменьшая расстояние разделения) и помещает его за наиболее вероятную точку. Пока он быстро перехватывается, когда пользователь останавливает сдвиг своего взгляда, он выглядит довольно естественным.
* Если вы хотите переместить голограмму, постарайтесь, чтобы скорость перемещения была меньше 5 градусов в секунду, если предполагается, что пользователь будет следовать за ним.
* Для курсора используйте *светлое* вместо *Geometry* . Источник виртуального освещения, присоединенный к указателю, будет рассматриваться как интерактивный указатель, но не будет приводить к разделению цветов.
* Настройте плоскость стабилизации в соответствии с голограммами, на которых пользователь облаками.
* Сделайте объект красным, зеленым или синим.
* Переключиться на размытую версию содержимого. Например, круглый белый курсор может быть изменен на немного размытую линию, ориентированную на направление движения.

Как и раньше, отрисовка в 60 кадров/с и настройка плоскости стабилизации является наиболее важными методиками для повышения стабильности. При заметном разделении цветов сначала убедитесь, что частота кадров соответствует ожиданиям.

## <a name="see-also"></a>См. также
* [Основные сведения о производительности смешанной реальности](understanding-performance-for-mixed-reality.md)
* [Цвет, свет и материалы](color,-light-and-materials.md)
* [Инстинктивное взаимодействие](interaction-fundamentals.md)
* [МРТК голограмма стабилизации](https://microsoft.github.io/MixedRealityToolkit-Unity/Documentation/hologram-stabilization.html)
