---
title: 4. Настройка интерактивной сцены
description: Часть 4 руководства по созданию простого приложения для игры в шахматы с помощью Unreal Engine 4 и подключаемого модуля средств разработки пользовательского интерфейса (UX) из набора средств для смешанной реальности
author: sw5813
ms.author: suwu
ms.date: 5/5/2020
ms.topic: article
ms.localizationpriority: high
keywords: Unreal, Unreal Engine 4, UE4, HoloLens, HoloLens 2, смешанная реальность, учебник, начало работы, MRTK, UXT, средства разработки пользовательского интерфейса, средства UX, документация
ms.openlocfilehash: 2e4d26ed4e0b8199bfc629016aea688bd1c41ef8
ms.sourcegitcommit: 09d9fa153cd9072f60e33a5f83ced8167496fcd7
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/18/2020
ms.locfileid: "83520029"
---
# <a name="4-making-your-scene-interactive"></a>4. Настройка интерактивной сцены

В этом разделе вы познакомитесь с подключаемым модулем разработки пользовательского интерфейса (UX) из набора средств для смешанной реальности, который содержит набор средств с открытым кодом для удобного добавления в сцену интерактивных возможностей. Когда вы завершите работу с этим разделом, шахматные фигуры будут реагировать на действия пользователя. 

## <a name="objectives"></a>Задачи

* Включение в проект подключаемого модуля средств UX из набора средств для смешанной реальности.
* Добавление субъектов взаимодействия с руками, чтобы они реагировали на пальцы пользователя.
* Создание манипуляторов и подключение их к шахматным фигурам и доске. 
* Применение симуляции ввода для проверки проекта.

## <a name="download-the-mixed-reality-toolkit-ux-tools-plugin"></a>Скачивание подключаемого модуля средств UX из набора средств для смешанной реальности

1.  Клонируйте или скачайте из [репозитория средств UX на сайте GitHub](https://github.com/microsoft/MixedReality-UXTools-Unreal/releases), а затем распакуйте последний выпуск подключаемого модуля средств UX из набора средств для смешанной реальности.

2.  В главной папке проекта создайте в новую папку с именем Plugins. Скопируйте в эту папку распакованный подключаемый модуль средств UX. Перезапустите редактор Unreal. 

![Создание папки для подключаемых модулей в проекте](images/unreal-uxt/4-plugins.PNG)

3.  Если после перезапуска вы не увидите содержимое подключаемого модуля средств UX на панели источников, попробуйте включить параметр **View Options > Show Plugin Content** (Параметры просмотра > Показать содержимое подключаемого модуля). Вы увидите, что подключаемый модуль средств UX предоставляет папку Content с элементами Pointers (Указатели), Input Simulation (Симуляция ввода) и Simple Button (Простая кнопка), а также папку с классами C++, в которой каждая функция размещена в отдельной подпапке.  

![Отображение содержимого подключаемого модуля](images/unreal-uxt/4-showplugincontent.PNG)

## <a name="spawn-hand-interaction-actors"></a>Порождение субъектов взаимодействия с рукой

1.  Для начала мы создадим субъекты взаимодействия с рукой на основе MRPawn, чтобы получить следующие возможности: 1) визуализировать для MRPawn курсоры на кончиках указательных пальцев для элемента Pawn; 2) реализовать события ввода рукой (для прямой манипуляции субъектами) через Pawn; 3) реализовать события ввода через дальнее взаимодействие, чтобы поддерживать телекинез от ладоней пользователя. Откройте схему **MRPawn** и перейдите к разделу **Event Graph** (Граф событий). 

2.  Перетащите закрепление выполнения из события BeginPlay и отпустите его на свободном месте, чтобы создать новый узел. Выберите узел **Spawn Actor from Class** (Порождение субъекта из класса). Щелкните раскрывающийся список рядом с закреплением **Class** (Класс) и выполните поиск по строке **Uxt Hand Interaction Actor** (Субъект взаимодействия с рукой). Перетащите закрепление выполнения из узла SpawnActor Uxt Hand Interaction, отпустите его и выполните поиск функции **Set Hand** (Установка руки), которая содержится в классе субъекта взаимодействия с рукой. Подключите возвращаемое значение узла SpawnActor к закреплению Target (Целевой объект) узла Set Hand (Установка руки), чтобы задать значение **Left** (Левая) для субъекта взаимодействия с рукой. Создайте второй субъект **Uxt Hand Interaction Actor**, но теперь настройте для руки значение **Right** (Правая). Теперь при создании этого события для каждой руки будет создан отдельный субъект взаимодействия с рукой. 

![Порождение субъектов взаимодействия с рукой](images/unreal-uxt/4-spawnactor.PNG)

3.  Теперь нам нужно настроить для субъектов взаимодействия с рукой значения начального преобразования и владельца. Перетащите закрепление одного из элементов **Spawn Transform** (Порождение преобразования) и отпустите его, чтобы разместить новый узел. Найдите узел **Make Transform** (Выполнить преобразование). Первоначальное преобразование не имеет особого значения, так как субъекты взаимодействия с рукой будут перемещаться на руки пользователя сразу же после отображения (этот код уже реализован в подключаемом модуле средств UX), а без этого они просто не видны. Однако функция SpawnActor требует передать ей преобразование в качестве входных данных, и без него компилятор создает ошибку, поэтому мы просто сохраним для Make Transform значения по умолчанию. Перетащите **Return Value** (Возвращаемое значение) элемента Make Transform на элемент Interaction Actor Spawn Transform (Преобразование порождения субъекта взаимодействия) другой руки. 

4.  Щелкните **стрелку вниз** в нижней части обоих узлов SpawnActor, чтобы открыть закрепление **Owner** (Владелец). Перетащите закрепление одного из элементов **Owner** (Владелец) и отпустите его, чтобы разместить новый узел. Выполните поиск по слову "self" и выберите переменную **Get a reference to self** (Получить ссылку на себя). Создайте связь между узлом ссылки на объект Self и закреплением Owner (Владелец) другого элемента Hand Interaction Actor (Субъект взаимодействия с рукой). Вы можете перетащить узлы в схеме, как сочтете нужным, чтобы сделать ее более удобной для просмотра. **Скомпилируйте**, **сохраните** схему и вернитесь к главному окну. 

![Полная конфигурация субъектов взаимодействия с рукой](images/unreal-uxt/4-fingerptrs.PNG)

Дополнительные сведения о субъекте взаимодействия с рукой, который входит в подключаемый модуль средств UX из набора средств для смешанной реальности, можно изучить в [официальной документации](https://microsoft.github.io/MixedReality-UXTools-Unreal/version/public/0.8.x/Docs/HandInteraction.html).

## <a name="attach-manipulators"></a>Присоединение манипуляторов

1.  Теперь мы подключим манипуляторы к шахматной доске и субъектам королей. Манипулятором называется компонент, который реагирует на жесты рукой и поддерживает действия захвата, вращения и переноса. Применив преобразование манипулятора к преобразованию субъекта, мы сможем напрямую манипулировать субъектами. 

2.  Откройте схему Board. На панели **Components** (Компоненты) нажмите **Add Component** (Добавить компонент) и выполните поиск по строке **Uxt Generic Manipulator**. На панели Details (Сведения) можно найти раздел **Generic Manipulator** (Универсальный манипулятор) и настроить его параметры: манипуляция одной или двумя руками, режим вращения, сглаживание. Вы можете выбрать здесь любой удобный режим, а затем **скомпилировать** и **сохранить** схему Board. 

![Добавление универсального манипулятора](images/unreal-uxt/4-addmanip.PNG)

![Настройка режима](images/unreal-uxt/4-setrotmode.PNG)

3.  Повторите описанные выше действия для субъекта WhiteKing.

Дополнительные сведения о компонентах манипуляторов, которые входят в подключаемый модуль средств UX из набора средств для смешанной реальности, можно изучить в [официальной документации](https://microsoft.github.io/MixedReality-UXTools-Unreal/version/public/0.8.x/Docs/Manipulator.html).

## <a name="test-out-your-scene-with-simulated-hands"></a>Тестирование сцены с помощью симуляции рук

1.  В главном окне нажмите **Play** (Играть). Вы увидеть две сетки для рук, которые предоставляются подключаемым модулем средств UX из набора средств для смешанной реальности, и два луча, выходящие из ладоней этих рук. 

![Симуляция рук в окне просмотра](images/unreal-uxt/4-handsim.PNG)

2.  Чтобы управлять **правой рукой**, удерживайте нажатой **левую клавишу ALT**. Перемещайте мышь, чтобы двигать рукой. Прокрутка **колесика мыши** позволяет переместить руку **вперед** или **назад**. Щелкните левой кнопкой мыши, чтобы **сжать** ладонь, или среднюю кнопку мыши, чтобы **активировать** объект.

3.  Чтобы управлять **левой рукой**, удерживайте нажатой **левую клавишу SHIFT**. Для перемещения левой руки используются те же элементы управления, что и для правой руки. 

4.  Теперь попробуйте с помощью этой симуляции рук поднять, переместить и поставить на новое место белого короля. Вы даже можете перемещать доску! Потренируйтесь выполнять ближнее и дальнее взаимодействие. Вы заметите, что при приближении рук к доске и (или) к королю на расстоянии прямого захвата лучи телекинеза исчезают и заменяются курсором пальца на кончике указательного пальца. 

Дополнительные сведения о функции симуляции рук, которая входит в подключаемый модуль средств UX из набора средств для смешанной реальности, можно изучить в [официальной документации](https://microsoft.github.io/MixedReality-UXTools-Unreal/version/public/0.8.x/Docs/InputSimulation.html).

[Следующий раздел: 5. Добавление кнопки и сброс расположений фрагментов](unreal-uxt-ch5.md)
