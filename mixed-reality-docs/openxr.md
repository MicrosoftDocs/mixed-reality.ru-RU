---
title: опенкср
description: Создайте подсистему с помощью переносимого стандарта API Опенкср и разверните его на гарнитурах Windows Mixed Reality и HoloLens 2.
author: thetuvix
ms.author: alexturn
ms.date: 7/29/2019
ms.topic: article
keywords: Портал разработчика Опенкср, Кхронос, Басикксрапп, Mixed Reality Опенкср разработчик, DirectX, Native, собственная настраиваемая подсистема приложения, по промежуточного слоя
ms.openlocfilehash: 67d2ab42a40aa04eb9dcd6881a4392a81c0f3b8f
ms.sourcegitcommit: b6b76275fad90df6d9645dd2bc074b7b2168c7c8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/11/2019
ms.locfileid: "73914394"
---
# <a name="openxr"></a>опенкср

Опенкср — это открытый стандарт API из <a href="https://www.khronos.org/" target="_blank">кхронос</a> , который предоставляет механизмам собственный доступ к широкому спектру устройств от многих поставщиков, охватывающих спектр различных [типов](mixed-reality.md).

Вы можете разрабатывать приложения с помощью Опенкср на виртуальной головной гарнитуре HoloLens 2 или Windows Mixed Reality на рабочем столе.  Если у вас нет доступа к гарнитуре, можно использовать эмулятор HoloLens 2 или симулятор Windows Mixed Reality.

## <a name="why-openxr"></a>Зачем Опенкср?

С помощью Опенкср вы можете создавать обработчики, предназначенные как для holographic устройств (например, HoloLens 2), которые размещают цифровое содержимое в реальном мире, как если бы оно было на самом деле, а также как впечатляющие устройства (например, гарнитуры Windows Mixed Reality для настольных ПК), которые скрывают физические мир и замените его цифровой опытом.  Опенкср позволяет написать код, который затем будет переносимым на широком диапазоне аппаратных платформ.

API Опенкср использует загрузчик, который подключает ваше приложение непосредственно к поддержке собственной платформы вашей гарнитуры.  Это обеспечивает максимальную производительность и минимальную задержку конечных пользователей независимо от того, используете ли они гарнитуру Windows Mixed Reality или любую другую гарнитуру.

## <a name="what-is-openxr"></a>Что такое Опенкср?

Основной API-интерфейс Опенкср 1,0 предоставляет базовые функциональные возможности, необходимые для создания подсистемы, которая может нацелить как holographic-устройства, такие как HoloLens 2, так и иммерсивное устройство, например гарнитуры Windows Mixed Reality:
* Системы + сеансы
* Справочные пространства (Просмотр, локальный, этап)
* Просмотр конфигураций (моно, стерео)
* Цепочек переключений + время кадров
* Слои композиции
* Входные и хаптикс
* API графики и интеграция платформы

Чтобы узнать об API Опенкср, ознакомьтесь со <a href="https://www.khronos.org/registry/OpenXR/specs/1.0/html/xrspec.html" target="_blank">спецификацией</a>опенкср 1,0, <a href="https://www.khronos.org/registry/OpenXR/specs/1.0/man/html/openxr.html" target="_blank">справочником по API</a> и <a href="https://www.khronos.org/files/openxr-10-reference-guide.pdf" target="_blank">кратким справочником</a>.  Дополнительные сведения см. на <a href="https://www.khronos.org/openxr/" target="_blank">странице Кхронос опенкср</a>.

Чтобы ориентироваться на полный набор функций HoloLens 2, вы также будете использовать расширения Опенкср, относящиеся к поставщику и поставщику, которые предоставляют дополнительные функции за пределами ядра Опенкср 1,0, такие как отслеживание, отслеживание глаз, пространственное сопоставление и пространственные привязки.  Дополнительные сведения о расширениях, которые появятся позже в этом году, см. в разделе о [планах](openxr.md#roadmap) ниже.

Обратите внимание, что Опенкср не является механизмом смешанной реальности.  Вместо этого Опенкср позволяет использовать такие модули, как Unity и Нереал, для написания переносимого кода, который затем может получить доступ к функциям собственной платформы в holographic или иммерсивное устройство пользователя независимо от того, какой поставщик создал эту платформу.

## <a name="getting-started-with-openxr-for-hololens-2"></a>Начало работы с Опенкср для HoloLens 2

Чтобы приступить к разработке приложений Опенкср для HoloLens 2:

1. Настройте HoloLens 2 или следуйте инструкциям по [установке эмулятора hololens 2](using-the-hololens-emulator.md).
1. Запустите приложение магазина на устройстве или в эмуляторе и убедитесь, что все приложения обновлены.  Это обеспечит обновление среды выполнения Опенкср на HoloLens до Опенкср 1,0.  При использовании эмулятора необходимо изучить [входные инструкции эмулятора](using-the-hololens-emulator.md#basic-emulator-input) , которые помогут вам использовать приложение магазина в эмуляторе.

## <a name="getting-started-with-openxr-for-windows-mixed-reality-headsets"></a>Начало работы с Опенкср для головных телефонов Windows Mixed Reality

Чтобы приступить к разработке приложений Опенкср для впечатляющих головных телефонов Windows Mixed Reality:

1. Убедитесь, что вы используете Windows 10 с обновлением 2019 (1903), что является минимальным требованием для конечных пользователей Windows Mixed Reality запускать приложения Опенкср.  Если вы используете более раннюю версию Windows 10, вы можете выполнить обновление до 2019 с помощью <a href="https://www.microsoft.com//software-download/windows10" target="_blank">помощника по обновлению Windows 10</a>.  Если вы не можете обновить свой компьютер, можно также [разработать приложение опенкср с помощью Windows 10 октября 2018 с обновлением (1809)](openxr.md#developing-on-windows-10-october-2018-update), хотя производительность и другие проблемы могут быть снижены.
2. Настройте гарнитуру Windows Mixed Reality или следуйте инструкциям по [включению симулятора Windows Mixed Reality](using-the-windows-mixed-reality-simulator.md).  После настройки Windows Mixed Reality портал смешанной реальности автоматически установит среду выполнения Опенкср Windows Mixed Reality.  Microsoft Store будет синхронизировать среду выполнения в актуальном состоянии.
3. Чтобы активировать среду выполнения Опенкср в Windows Mixed Reality, запустите портал Mixed Reality из меню "Пуск", щелкнув... в левом нижнем углу и выбрав "настроить Опенкср".<br>
![настройке Опенкср на портале Mixed Reality](images/mixed-reality-portal-set-up-openxr.png)

Если вам когда-либо потребуется снова активировать среду выполнения Опенкср в Windows Mixed Reality, повторите шаг 3.

> [!NOTE]
> В ближайшее время среда выполнения Опенкср Windows Mixed Reality будет настроена автоматически для всех конечных пользователей Windows Mixed Reality.

## <a name="getting-the-mixed-reality-openxr-developer-portal"></a>Получение портала для разработчиков смешанной реальности Опенкср

Чтобы испытать среду выполнения Опенкср в Windows Mixed Reality, можно установить <a href="https://www.microsoft.com/store/productId/9n5cvvl23qbt" target="_blank">приложение портала разработчика для смешанной реальности опенкср</a>.  Это приложение содержит демонстрационную сцену, в которой реализованы различные функции Опенкср, а также страница состояния системы, которая содержит основные сведения об активной среде выполнения и текущей гарнитуре.

![Приложение портала для разработчиков смешанной реальности Опенкср](images/mixed-reality-openxr-developer-portal.png)

## <a name="building-a-sample-openxr-app"></a>Создание примера приложения Опенкср

Проект <a href="https://github.com/Microsoft/OpenXR-SDK-VisualStudio/tree/master/samples/BasicXrApp" target="_blank">басикксрапп</a> демонстрирует простой пример опенкср с двумя файлами проекта Visual Studio: один для классического приложения Win32 и один для приложения UWP HoloLens 2.  Так как решение содержит проект HoloLens UWP, для его полного открытия вам потребуется [Рабочая нагрузка "разработка универсальная платформа Windows](install-the-tools.md#installation-checklist) ", установленная в Visual Studio.

Обратите внимание, что хотя файлы проекта Win32 и UWP являются отдельными из-за различий в упаковке и развертывании, код приложения внутри каждого проекта составляет 100%.

## <a name="openxr-app-best-practices-for-hololens-2"></a>Рекомендации по приложениям Опенкср для HoloLens 2

Ниже приведены примеры лучших методов в файле [опенксрпрограм. cpp](https://github.com/microsoft/OpenXR-SDK-VisualStudio/blob/master/samples/BasicXrApp/OpenXrProgram.cpp) для басикксрапп. Функция Run () в начале фиксирует типичный поток кода приложения Опенкср из инициализации в цикле событий и отрисовки.

### <a name="select-a-pixel-format"></a>Выберите формат пикселей

Всегда перечислите Поддерживаемые форматы пикселей с помощью `xrEnumerateSwapchainFormats`и выберите первый цвет и формат пикселей глубины из среды выполнения, которую поддерживает приложение, поскольку это предпочтительно для среды выполнения. Обратите внимание, что в HoloLens 2 `DXGI_FORMAT_B8G8R8A8_UNORM_SRGB` и `DXGI_FORMAT_D16_UNORM`, как правило, являются первым выбором для достижения лучшей производительности отрисовки. Этот параметр может отличаться на гарнитурах VR, работающих на настольном ПК.  
  
**Предупреждение о производительности:** Использование формата, отличного от основного цвета имеющуюся цепочку буферов, приведет к последующей обработке во время выполнения, что приводит к значительному снижению производительности.

### <a name="gamma-correct-rendering"></a>Гамма-Правильная отрисовка

Хотя это применимо ко всем средам выполнения Опенкср, необходимо соблюдать осторожность, чтобы убедиться, что конвейер отрисовки является гамма-верным. При подготовке к просмотру в имеющуюся цепочку буферов формат представления "Визуализация-целевой объект" должен соответствовать формату имеющуюся цепочку буферов (например, DXGI_FORMAT_B8G8R8A8_UNORM_SRGB как для формата имеющуюся цепочку буферов, так и для представления целевого объекта визуализации).
Исключением является ситуация, когда конвейер отрисовки приложения выполняет ручное преобразование sRGB в коде шейдера. в этом случае приложение должно запрашивать формат имеющуюся цепочку буферов sRGB, но использовать линейный формат для представления целевого объекта визуализации (например, запрос DXGI_FORMAT_B8G8R8A8_UNORM_SRGB как имеющуюся цепочку буферов Format, но используйте DXGI_FORMAT_B8G8R8A8_UNORM в качестве представления целевого объекта, чтобы избежать повторной гаммы содержимого.

### <a name="use-a-single-projection-layer"></a>Использование одного слоя проекции

HoloLens 2 имеет ограниченную мощность GPU для приложений для отрисовки содержимого и аппаратного компоновщика, оптимизированного для одного уровня проекции.
Всегда использование одного уровня проекции может помочь снизить частоту работы приложения, голограмму и качество визуального элемента.  
  
**Предупреждение о производительности:** Передача любого, но одного уровня защиты приведет к последующей обработке во время выполнения, что значительно снижает производительность.

### <a name="render-with-texture-array-and-vprt"></a>Отрисовка с помощью массива текстур и ВПРТ

Создайте один `xrSwapchain` для левого и правого глаз, используя `arraySize=2` для цвета имеющуюся цепочку буферов и один для глубины.
Просматривайте левый глаз в срезе 0 и вправо на срез 1.
Используйте шейдер с ВПРТ и экземплярными вызовами Draw для отрисовки стереоскопик, чтобы избежать загрузки GPU.
Это также позволяет оптимизировать среду выполнения для достижения наилучшей производительности в HoloLens 2.
Альтернативы использованию массива текстур, такого как отрисовка на уровне Double или отдельная имеющуюся цепочку буферов на глаз, приводят к последующей обработке во время выполнения, что значительно снижает производительность.

### <a name="render-with-recommended-rendering-parameters-and-frame-timing"></a>Подготовка к просмотру с рекомендуемыми параметрами отрисовки и временем кадров

Всегда выводится с рекомендуемой шириной или высотой конфигурации представления (`recommendedImageRectWidth` и `recommendedImageRectHeight` из `XrViewConfigurationView`) и всегда используйте API `xrLocateViews`, чтобы запросить Рекомендуемые параметры представления, фов и другие для подготовки к просмотру.
Всегда используйте `XrFrameEndInfo.predictedDisplayTime` из последнего вызова `xrWaitFrame` при запросе представлений и объектов.
Это позволит HoloLens настроить визуализацию и оптимизировать визуальное качество для пользователя, людьми HoloLens.

### <a name="submit-depth-buffer-for-projection-layers"></a>Отправка буфера глубины для слоев проекции

Всегда используйте расширение `XR_KHR_composition_layer_depth` и отправьте буфер глубины вместе с слоем проекции при отправке кадра в `xrEndFrame`.
Это повышает устойчивость к голограммам за счет повышения глубины оборудования в HoloLens 2.

### <a name="choose-a-reasonable-depth-range"></a>Выберите приемлемый диапазон глубины

Предпочтительнее использовать более узкий диапазон глубины виртуального содержимого, чтобы повысить стабильность работы HoloLens.
Например, в примере Опенксрпрограм. cpp используется 0,1 – 20 метров.
Используйте [Обратный-Z](https://developer.nvidia.com/content/depth-precision-visualized) для более однородного разрешения глубины.
Обратите внимание, что в HoloLens 2 использование предпочтительного формата глубины `DXGI_FORMAT_D16_UNORM` поможет достичь лучшей частоты кадров и производительности, хотя буферы 16-разрядной глубины обеспечивают меньшее разрешение глубины по сравнению с 24-разрядными буферами глубины.
Поэтому следует выполнить эти рекомендации, чтобы лучше использовать разрешение глубины.

### <a name="prepare-for-different-environment-blend-modes"></a>Подготовка к различным режимам смешения среды

Если приложение также будет работать на впечатляющих наушниках, которые полностью блокируют мир, обязательно перечислите поддерживаемые режимы наложения среды с помощью `xrEnumerateEnvironmentBlendModes` API и подготовьте содержимое для подготовки к просмотру соответствующим образом.
Например, для системы с `XR_ENVIRONMENT_BLEND_MODE_ADDITIVE`, например HoloLens, приложение должно использовать прозрачный цвет в качестве четкого цвета, а для системы с `XR_ENVIRONMENT_BLEND_MODE_OPAQUE`приложение должно визуализировать некоторый непрозрачный цвет или некоторую виртуальную комнату в фоновом режиме.

### <a name="choose-unbounded-reference-space-as-applications-root-space"></a>Выбрать неограниченное пространство ссылок в качестве корневого пространства приложения

Приложения обычно устанавливают некоторое корневое пространство координат для подключения представлений, действий и голограмм.
Используйте `XR_REFERENCE_SPACE_TYPE_UNBOUNDED_MSFT`, если расширение поддерживается для установления [геометрической системы координат](coordinate-systems.md#building-a-world-scale-experience), что позволяет приложению избежать нежелательного уменьшения голограммы, когда пользователь перемещается (например, 5 метров) с места запуска приложения.
Используйте `XR_REFERENCE_SPACE_TYPE_LOCAL` в качестве резервной, если не существует расширения неограниченного пространства.

### <a name="associate-hologram-with-spatial-anchor"></a>Связать голограмму с пространственной привязкой

При использовании неограниченного пространства ссылок голограммы, размещенные непосредственно в этом справочном пространстве, [могут быть смещены по мере того, как пользователь переходит к удаленным комнатам, а затем](coordinate-systems.md#building-a-world-scale-experience)возвращается.
Для пользователей с голограммами, которые помещаются в дискретное место в мире, [Создайте пространственное привязку](spatial-anchors.md#best-practices) с помощью функции расширения `xrCreateSpatialAnchorSpaceMSFT` и поместите голограмму в ее начало.
Это обеспечит нестабильную голограмму в зависимости от времени.

### <a name="support-mixed-reality-capture"></a>Поддержка записи смешанной реальности

Несмотря на то, что основной дисплей HoloLens 2 использует Аддитивное смешение среды, когда пользователь инициирует [запись смешанной реальности](mixed-reality-capture-for-developers.md), содержимое отрисовки приложения будет иметь альфа-смешение с потоком видео среды.
Для достижения наилучшего визуального качества в видеороликах смешанной реальности лучше установить `XR_COMPOSITION_LAYER_BLEND_TEXTURE_SOURCE_ALPHA_BIT` на `layerFlags`слоя проекции.  

**Предупреждение о производительности:** Пропуск флага `XR_COMPOSITION_LAYER_BLEND_TEXTURE_SOURCE_ALPHA_BIT` на одном слое проекции приведет к последующей обработке во время выполнения, что приводит к значительному снижению производительности.

### <a name="avoid-quad-layers"></a>Избегайте использования четырех уровней

Вместо того чтобы отправлять четыре слоя в виде слоев композиции с `XrCompositionLayerQuad`, выводите это содержимое непосредственно в имеющуюся цепочку буферов проекции.

**Предупреждение о производительности:** Предоставление дополнительных слоев за пределами одного слоя проекции, например четырех слоев, приведет к последующей обработке во время выполнения, что значительно снижает производительность.

## <a name="openxr-app-performance-on-hololens-2"></a>Производительность приложений Опенкср в HoloLens 2

В HoloLens 2 существует несколько способов отправки данных композиции с помощью `xrEndFrame`, что приведет к заметному снижению производительности.
Чтобы избежать штрафов в производительности, [отправьте единое `XrCompositionProjectionLayer`](#use-a-single-projection-layer) со следующими характеристиками:
* [Использование имеющуюся цепочку буферов массива текстуры](#render-with-texture-array-and-vprt)
* [Использовать формат имеющуюся цепочку буферов основного цвета](#select-a-pixel-format)
* [Установка флага "текстура-источник-Альфа" Blend](#support-mixed-reality-capture)
* [Использование рекомендуемых измерений представления](#render-with-recommended-rendering-parameters-and-frame-timing)
* Не устанавливайте флаг `XR_COMPOSITION_LAYER_UNPREMULTIPLIED_ALPHA_BIT`
* Задайте для `XrCompositionLayerDepthInfoKHR` `minDepth` значение 0,0 f, а `maxDepth` — 1,0 f.

Дополнительные соображения приводят к лучшей производительности:
* [Использовать 16-разрядный формат глубины](#choose-a-reasonable-depth-range)
* [Сделать экземпляры вызовов Draw](#render-with-texture-array-and-vprt)

## <a name="roadmap"></a>Стратегия

Спецификация Опенкср определяет механизм расширения, позволяющий разработчикам среды выполнения предоставлять дополнительные функциональные возможности за пределами [основных функций](openxr.md#what-is-openxr) , определенных в <a href="https://www.khronos.org/registry/OpenXR/specs/1.0/html/xrspec.html" target="_blank">базовой спецификации опенкср 1,0</a>.

Существует три вида расширений Опенкср:
* **Расширения поставщика (например, MSFT):** Включает инновации каждого поставщика в функции оборудования или программного обеспечения.  Любой поставщик среды выполнения может в любое время внедрить и поставлять расширение поставщика.
* **Расширения Ext:** Расширения кросс-поставщика, которые определяются и реализуются несколькими компаниями.  Группы заинтересованных компаний могут в любое время внедрять расширения EXT.
* **Расширения КХР:** Официальные расширения Кхронос ратифицирован в рамках основной версии спецификации.  Расширения КХР охватываются той же лицензией, что и Основная спецификация.

К концу года среда выполнения Опенкср в Windows Mixed Reality будет поддерживать множество расширений MSFT и EXT, которые предоставляют полный набор функций HoloLens 2 для Опенкср приложений:
* [Несвязанное пространство ссылок (возможности мирового масштаба)](coordinate-systems.md#building-a-world-scale-experience)
* [Пространственные привязки + хранилище](spatial-anchors.md)
* [Сетка руки артикулатион +](hands-and-tools.md)
* [Отслеживание глаз](eye-tracking.md)
* [Конфигурации вторичного представления (запись смешанной реальности)](mixed-reality-capture-for-developers.md#render-from-the-pv-camera-opt-in)
* [Интерпретация сцены](scene-understanding.md)
* Взаимодействие с интерфейсами API Windows SDK

Хотя некоторые из этих расширений могут начаться как расширения MSFT, зависящие от поставщика, корпорация Майкрософт и другие поставщики среды выполнения Опенкср работают вместе для проектирования расширений EXT или КХР для различных функциональных областей.  Это обеспечит переносимость кода, который вы пишете для этих функций, между поставщиками среды выполнения, как и в случае с основной спецификацией.

## <a name="troubleshooting"></a>"Устранение неполадок"

Ниже приведены некоторые советы по устранению неполадок среды выполнения Опенкср в Windows Mixed Reality.  Если у вас есть другие вопросы о <a href="https://www.khronos.org/registry/OpenXR/specs/1.0/html/xrspec.html" target="_blank">спецификации опенкср 1,0</a>, посетите <a href="https://community.khronos.org/c/openxr" target="_blank">форумы Кхронос опенкср</a> или <a href="https://khr.io/slack" target="_blank">резервный #openxr канал</a>.

### <a name="developing-on-windows-10-october-2018-update"></a>Разработка на Windows 10 октября с обновлением 2018

Если вы не можете обновить [компьютер разработки до обновления 2019](https://www.microsoft.com//software-download/windows10), можно настроить компьютер с Windows 10 октября 2018 (1809) для разработки, выполнив еще один шаг:

1. Выполните описанные выше действия, чтобы приступить к работе с Опенкср на настольном ПК.
1. Чтобы установить среду выполнения Опенкср Windows Mixed Reality в качестве активной среды выполнения Опенкср в системе, установите [пакет обеспечения совместимости для Windows Mixed Reality опенкср](https://aka.ms/openxr-compat).

> [!NOTE]
> Хотя обновление Windows 10 октября 2018 (1809) можно использовать при разработке приложений Опенкср, в Windows 10 может 2019 обновление (1903) — это минимальное требование для конечных пользователей использовать Опенкср с Windows Mixed Reality.  Вы можете столкнуться с более низкой производительностью или другими проблемами при запуске приложения Опенкср в обновлении за Октябрь 2018 октября.  Настоятельно рекомендуется обновить компьютер разработчика до версии Windows 10 2019 (1903).

### <a name="openxr-app-not-starting-windows-mixed-reality"></a>Приложение Опенкср не запускает Windows Mixed Reality

Если приложение Опенкср не запускает Windows Mixed Reality при запуске, то среда выполнения Windows Mixed Reality Опенкср может быть не установлена в качестве активной среды выполнения.  Следуйте приведенным выше инструкциям по [началу работы с опенкср для головных телефонов Windows Mixed Reality](#getting-started-with-openxr-for-windows-mixed-reality-headsets) , чтобы активировать среду выполнения.

Вы также можете запустить [портал разработчика Mixed Reality опенкср](#getting-the-mixed-reality-openxr-developer-portal) для получения дополнительных сведений об устранении неполадок, связанных с состоянием среды выполнения Windows Mixed Reality опенкср в вашей системе.

### <a name="mixed-reality-portal-not-showing-set-up-openxr-menu-item"></a>На портале Mixed Reality не отображается пункт меню "Настройка Опенкср"

Убедитесь, что вы используете по крайней мере обновление Windows 10 октября 2018 (1809).  Если вы используете более раннюю версию Windows 10, можно выполнить обновление до 2019 обновления (1903) с помощью [помощника по обновлению Windows 10](https://www.microsoft.com//software-download/windows10).

Пункт меню "настроить Опенкср" может быть недоступен, если у вас более старая версия приложения портала смешанной реальности.  Проверьте наличие [обновления для приложения портала смешанной реальности](https://www.microsoft.com/p/mixed-reality-portal/9ng1h8b3zc7m) , чтобы убедиться, что у вас установлена последняя версия.

Обратите внимание, что пункт меню "настроить Опенкср" не отображается, если среда выполнения Windows Mixed Reality Опенкср уже установлена и активна.  Вы можете установить [портал разработчика Mixed Reality опенкср](#getting-the-mixed-reality-openxr-developer-portal) , чтобы определить текущее состояние среды выполнения опенкср в системе.

## <a name="see-also"></a>См. также

* <a href="https://www.khronos.org/openxr/" target="_blank">Дополнительные сведения о Опенкср</a>
* <a href="https://www.khronos.org/registry/OpenXR/specs/1.0/html/xrspec.html" target="_blank">Спецификация Опенкср 1,0</a>
* <a href="https://www.khronos.org/registry/OpenXR/specs/1.0/man/html/openxr.html" target="_blank">Справочник по API Опенкср 1,0</a>
* <a href="https://www.khronos.org/files/openxr-10-reference-guide.pdf" target="_blank">Краткое справочное руководство по Опенкср 1,0</a>
