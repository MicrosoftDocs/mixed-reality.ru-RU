---
title: Подготовка приложения для использования с HoloLens 2
description: Предназначено для разработчиков, которые используют существующее приложение для HoloLens (1-го поколения) и (или) устаревшей версии MRTK и хотят перейти на MRTK версии 2 и HoloLens 2.
author: grbury
ms.author: grbury
ms.date: 04/12/19
ms.topic: article
ms.localizationpriority: high
keywords: Windows Mixed Reality, test, MRTK, MRTK version 2, HoloLens 2
ms.openlocfilehash: 02dabd21b7a6add2ce53fe291a447e49057184d0
ms.sourcegitcommit: f20beea6a539d04e1d1fc98116f7601137eebebe
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/05/2019
ms.locfileid: "66270396"
---
# <a name="getting-your-existing-app-ready-for-hololens-2"></a>Подготовка существующего приложения для использования с HoloLens 2

Это руководство предназначено для разработчиков, которые используют существующее приложение Unity для HoloLens (1-го поколения) и хотят перенести его на новое устройство HoloLens 2. Процесс переноса приложения Unity для HoloLens (1-го поколения) на HoloLens 2 состоит из четырех основных шагов. Эти шаги подробно описаны в приведенных ниже разделах. 

| Шаг 1 | Шаг 2 | Шаг 3 | Шаг 4 |
|----------|-------------------|-------------------|-------------------|
| ![Логотип Visual Studio](images/visualstudio_logo.png) | ![Логотип Unity](images/unity_logo.png)| ![Значок Unity](images/hololens2_icon.jpg) | ![Логотип МРТК](images/MRTKIcon.jpg) |
| Скачивание новейших средств | Обновление проекта Unity | Компиляция для ARM | Миграция в MRTK версии 2

Прежде чем начать процесс переноса, разработчикам **настоятельно рекомендуется** сохранить моментальный снимок исходного состояния своего приложения с помощью системы управления версиями. Кроме того, мы рекомендуем *сохранить* данные состояния контрольных точек в разное время при выполнении процесса. Также полезно создать еще один экземпляр исходного приложения Unity, чтобы обеспечить сравнение версий приложения во время переноса. 

> [!NOTE]
> Перед переносом убедитесь, что установлены последние версии средств разработки для Windows Mixed Reality. Для большинства разработчиков HoloLens в основном это будет последняя версия Visual Studio 2017 и соответствующий пакет SDK для Windows. Подробное описание различных версий Unity и набора средств для смешанной реальности (MRTK) версии 2 представлено ниже.
>
> Дополнительные сведения см. в статье [Install the tools](install-the-tools.md) (Установка средств).

## <a name="migrate-project-to-latest-version-of-unity"></a>Перенос проекта в последнюю версию Unity

Если вы используете MRTK версии 2, Unity 2018 LTS будет наилучшим вариантом долгосрочной поддержки без критических изменений в Unity или MRTK.  Как указано в упомянутом выше руководстве по установке средств, рекомендуется использовать сборку Unity 2018.3, которая будет выпуском LTS для Unity 2018.  Кроме того, MRTK версии 2 всегда гарантирует поддержку Unity 2018 LTS. Но поддержка каждой итерации Unity 2019.x не гарантируется. 

Чтобы вы могли составить представление о дополнительных различиях между Unity 2018.3.x и Unity 2019.1.x, ниже описаны преимущества и недостатки этих двух версий. Основное и важное отличие Unity 2019 — возможность компиляции для ARM64. 

Разработчикам следует оценить все [зависимости подключаемого модуля](https://docs.unity3d.com/Manual/Plugins.html), которые сейчас есть в проекте, а также возможность выполнить сборку этих библиотек DLL для ARM64. Если подключаемый модуль с жесткой зависимостью не поддерживает сборку для ARM64, то следует использовать LTS Unity 2018.


| Unity 2018.3.x | Unity 2019.1 и более поздних версий |
|----------|-------------------|
| Поддержка сборки для ARM32 | Поддержка сборки для ARM32 и ARM64 |
| Стабильные выпуски сборок LTS | Стабильность бета-версии |
| [Серверная часть для работы со скриптами .NET](https://docs.unity3d.com/Manual/windowsstore-dotnet.html) отмечена как *нерекомендуемая* | [Серверная часть для работы со скриптами .NET](https://docs.unity3d.com/Manual/windowsstore-dotnet.html) *удалена* |
| Сетевая технология UNET отмечена как *нерекомендуемая* | Сетевая технология UNET *удалена* |

## <a name="update-sceneproject-settings-in-unity"></a>Обновление параметров сцены или проектов в Unity

После обновления до Unity 2018.3.x или Unity 2019 и более поздних версий рекомендуется изменить определенные параметры в Unity, чтобы получить оптимальные результаты на устройстве. Подробное описание этих параметров см. в статье **[Recommended settings for Unity](Recommended-settings-for-Unity.md)** (Рекомендуемые параметры для Unity).

Следует еще раз упомянуть, что [серверная часть для работы со скриптами .NET](https://docs.unity3d.com/Manual/windowsstore-dotnet.html) считается нерекомендуемой в Unity 2018 и *удалена* в Unity 2019. Таким образом, разработчики должны тщательно взвесить все за и против при переходе на [IL2CPP](https://docs.unity3d.com/Manual/IL2CPP.html). 

> [!NOTE]
> При использовании серверной части для работы со скриптами IL2CPP может увеличиться время сборки из Unity в Visual Studio. Поэтому разработчикам следует настроить свои компьютеры для разработки, чтобы [оптимизировать время сборки IL2CPP](https://docs.unity3d.com/Manual/IL2CPP-OptimizingBuildTimes.html).
> Кроме того, может быть полезно настроить [сервер кэширования](https://docs.unity3d.com/Manual/CacheServer.html), особенно для проектов Unity с большим объемом ресурсов (за исключением файлов сценариев) либо постоянно меняющимися сценами или ресурсами. Когда открывается проект, Unity сохраняет соответствующие ресурсы в формате для внутреннего кэша на компьютере разработчика. Измененные элементы нужно повторно импортировать и еще раз обработать. Этот процесс можно выполнить один раз и сохранить на сервере кэширования, а значит, и совместно использовать с другими разработчиками для экономии времени. При этом каждому разработчику не придется обрабатывать повторно импортированные измененные элементы локально.

Разобравшись с критическими изменениями после перехода на обновленную версию Unity, разработчикам следует выполнить сборку и тестирование текущих приложений на HoloLens (1-го поколения). Кроме того, это подходящий момент для создания и сохранения фиксации в системе управления версиями. 

## <a name="compile-dependenciesplugins-for-arm-processor"></a>Компиляция зависимостей или подключаемых модулей для процессора ARM

Приложения для HoloLens 1-го поколения выполнялись на 32-разрядных процессорах. Новое устройство HoloLens 2 использует процессор ARM. Поэтому существующие приложения нужно перевести на ARM. Как отмечалось ранее, Unity 2018 поддерживает компиляцию для приложений ARM32, а Unity 2019 и более поздних версий поддерживает компиляцию для приложений ARM64. Рекомендуется разрабатывать приложения ARM64, так производительность при этом существенно выше. Но в таком случае все [зависимости подключаемого модуля](https://docs.unity3d.com/Manual/Plugins.html) также должны быть созданы для ARM64. 

Просмотрите все зависимости от библиотеки DLL, которые сейчас есть в приложении. Если зависимость больше не используется, следует удалить ее из проекта. Для остальных необходимых подключаемых модулей примите соответствующие двоичные файлы ARM32 и ARM64 в проекте Unity. 

Когда будут приняты соответствующие библиотеки DLL, создайте решение Visual Studio в Unity и скомпилируйте приложение AppX для ARM в Visual Studio, чтобы проверить, можно ли создать его для процессоров ARM. На этом этапе мы также рекомендуем сохранить фиксацию в системе управления версиями. 

## <a name="update-to-mrtk-version-2"></a>Обновление до MRTK версии 2

MRTK версии 2 — это новый набор средств на основе Unity, который поддерживает HoloLens (1-го поколения) и HoloLens 2. Также в него добавлены все новые возможности HoloLens 2, такие как взаимодействие с помощью рук и отслеживание движения глаз.

### <a name="prepare-for-the-migration"></a>Подготовка к миграции

Перед приемом новых файлов [*.unitypackage для MRTK версии 2](https://github.com/Microsoft/MixedRealityToolkit-Unity/releases) рекомендуется провести инвентаризацию **1) любого пользовательского кода, который интегрируется с MRTK версии 1** и **2) любого пользовательского кода для взаимодействия с помощью ввода или для компонентов UX**. Наиболее распространенные конфликты при освоении возможностей MRTK версии 2 для разработчиков в сфере смешанной реальности будут касаться методов ввода и взаимодействия. Поэтому мы рекомендуем прочитать статью о [модели ввода MRTK версии 2](https://microsoft.github.io/MixedRealityToolkit-Unity/Documentation/Input/Overview.html).

Наконец, в новой MRTK версии 2 реализован переход с модели сценариев и объектов управления в сцене на архитектуру конфигурации и поставщика служб. В результате формируется более четкая иерархия и архитектурная модель. Но для этого нужно изучить новые профили конфигурации. Рекомендуем прочитать [руководство по настройке набора средств для смешанной реальности](https://microsoft.github.io/MixedRealityToolkit-Unity/Documentation/MixedRealityConfigurationGuide.html), чтобы приступить к ознакомлению с важными параметрами и профилями, которые нужно адаптировать к требованиям вашего приложения. 

### <a name="perform-the-migration"></a>Выполнение миграции

После импорта MRTK версии 2, скорее всего, в проекте Unity будет много ошибок компиляции. Как правило, это связано с новой структурой пространства имен и новыми именами компонентов. Перейдите к устранению этих ошибок и измените скрипты в соответствии с новыми пространствами имен и компонентами. 

Дополнительные сведения об определенных различиях API между HTK/MRTK и MRTK версии 2 см. в руководстве по переносу на [вики-сайте MRTK версии 2 ](https://microsoft.github.io/MixedRealityToolkit-Unity/Documentation/HTKToMRTKPortingGuide.html).

### <a name="best-practices"></a>Рекомендации

- Преимущество отдается стандартному построителю текстуры MRTK.
- Работайте с типами критических изменений поочередно (например, переход с IFocusable на IMixedRealityFocusHandler).
- Выполняйте проверку после каждого изменения и используйте систему управления версиями.
- По возможности используйте стандартные элементы взаимодействия с пользователем MRTK (кнопки, баннеры и т. д.).
- Постарайтесь не изменять файлы MRTK напрямую. Вместо этого создайте оболочки для компонентов MRTK.
    - Это обеспечит защиту во время дальнейшего приема данных и обновления MRTK.
- Просмотрите и изучите примеры сцен в MRTK (особенно *HandInteractionExamples.scene*).
- Модифицируйте структуру пользовательского интерфейса на основе холста, используя четырехугольники, коллайдеры и текст TextMeshPro в качестве замены.

### <a name="testing-your-application"></a>Тестирование приложения

Теперь, когда компоненты и возможности HoloLens 2 доступны в MRTK версии 2, (начиная с версии [RC1](https://github.com/Microsoft/MixedRealityToolkit-Unity/releases/tag/v2.0.0-RC1)), вы можете моделировать взаимодействие с помощью рук непосредственно в Unity и выполнять разработку с использованием новых интерфейсов API для реализации взаимодействия с помощью рук и отслеживания движения глаз.  Для обеспечения оптимального взаимодействия требуется устройство HoloLens 2. Но для этого также нужно изучить возможности средств и документацию. Кроме того, MRTK версии 2 поддерживает разработку для устройств HoloLens (1-го поколения). Таким образом, традиционные модели ввода (например, выбор элемента жестом касания) можно по-прежнему тестировать на устройствах HoloLens (1-го поколения). 

## <a name="updating-interaction-model-for-hololens-2"></a>Обновление модели взаимодействия для HoloLens 2

После переноса приложения и его подготовки для работы с HoloLens 2 можно приступить к обновлению модели взаимодействия и макетов или расположения голограммы.
В приложении, разработанном для HoloLens (1-го поколения), по всей вероятности, реализована модель взаимодействия с помощью направления взгляда с подтверждением. Она используется при взаимодействии с голограммами, расположенными на удалении, чтобы они могли поместиться в поле зрения.

Шаги по обновлению структуры приложения для максимальной адаптации к HoloLens 2:
1.  Компоненты MRTK. Если вы добавили MRTK версии 2, можно использовать различные компоненты и скрипты, которые разработаны и оптимизированы для HoloLens 2.

2.  Модель взаимодействия. Рекомендуется обновить модель взаимодействия.  В большинстве случаев мы рекомендуем перейти с модели взаимодействия с помощью взгляда с подтверждением на модель взаимодействия с помощью рук.  Например, для голограмм, которые обычно оказываются за пределами досягаемости, будут использоваться лучи, указывающие на предмет при дальнем взаимодействии, и жесты захвата.
Примечание. В некоторых сценариях требуется модель взаимодействия без использования рук (например, если работник держит в руках инструмент). Для таких случаев предусмотрены специальные инструкции по разработке. 

3.  Расположение голограммы. Когда перейдете на модель взаимодействия с помощью рук, переместите некоторые голограммы ближе, используя жесты захвата, чтобы непосредственно взаимодействовать с ними руками.  Мы рекомендуем переместить ближе такие типы голограмм: небольшие целевые меню, элементы управления, кнопки и небольшие голограммы, которые помещаются в поле зрения HoloLens 2 при захвате и рассмотрении голограммы.
<br>
Все приложения и сценарии разные. Мы будем продолжать совершенствовать и публиковать рекомендации по разработке на основе отзывов и полученных знаний.


## <a name="additional-learnings-from-moving-apps-from-x86-to-arm"></a>Дополнительные сведения о переходе приложений от 32-разрядных процессоров к ARM

- Традиционные приложения Unity очень просты. Можно создать пакет приложений ARM или развернуть их на устройстве, и они сразу же будут выполняться.
Сложности возникают, когда приложение Unity использует собственные подключаемые модули.  Все собственные подключаемые модули нужно обновить до Visual Studio 2017 и перестроить для ARM с помощью Unity 2019 (ARM64).

- Например, приложение использовало подключаемый модуль AudioKinetic Wwise для Unity, но в используемой версии не было подключаемого модуля ARM универсальной платформы Windows. Чтобы адаптировать звуковые файлы в приложении для работы в ARM, потребовалось несколько дней.

- В других случаях требуемых подключаемых модулей UWP или ARM для приложения может не быть вообще, из-за чего приложение нельзя будет перенести и запустить на HoloLens 2.  Возможно, потребуется обратиться к поставщику подключаемого модуля, чтобы устранить препятствия и обеспечить поддержку ARM.

- Элементы minfloat (и варианты, такие как min16float, minint и т. д.) построителей текстуры могут по-разному действовать на HoloLens 2 и HoloLens (1-го поколения). Но при этом гарантируется, что по крайней мере будет использоваться указанное количество битов. Графические процессоры Intel и Nvidia считаются 32-разрядными. В ARM будет использоваться фактическое количество битов. Это означает, что на практике эти показатели будут менее точными или диапазон на HoloLens 2 будет меньше, чем на HoloLens (1-го поколения).

- Инструкции _asm не будут работать в ARM. Поэтому потребуется переписать все строки кода, где используются инструкции _asm.

- Набор инструкций SIMD не поддерживается в ARM. Это означает, что различные заголовки, такие как xmmintrin.h, emmintrin.h, tmmintrin.h и immintrin.h, недоступны в ARM.

- Компилятор построителя текстуры запускается в ARM во время первого вызова метода рисования после загрузки построителя текстуры или при изменении объекта, от которого зависит построитель, не во время его загрузки. Частота кадров будет существенно зависеть от количества компилируемых построителей текстуры. Таким образом, способы обработки, упаковки и обновления построителей текстуры для HoloLens 2 и HoloLens (1-го поколения) будут разными.

## <a name="see-also"></a>См. также
* [Getting started with MRTK v2](mrtk-getting-started.md) (Начало работы с MRTK версии 2)
* [Практическое руководство по MRTK версии 2](https://microsoft.github.io/MixedRealityToolkit-Unity/External/HowTo/README.html)
* [Установка средств](install-the-tools.md)
* [Рекомендуемые параметры для Unity](recommended-settings-for-unity.md)
* [Understanding performance for Mixed Reality](understanding-performance-for-mixed-reality.md) (Основные сведения о производительности для Смешанной реальности)

